
/*
     /$$$$$$$            /$$
    | $$__  $$          | $$          /$$
    | $$  | $$ /$$   /$$| $$$$$$$    | $$
    | $$  | $$| $$  | $$| $$__  $$ /$$$$$$$$
    | $$  | $$| $$  | $$| $$  | $$|__  $$__/
    | $$  | $$| $$  | $$| $$  | $$   | $$
    | $$$$$$$/|  $$$$$$/| $$$$$$$/   |__/
    |_______/  ______/ |_______/


    https://github.com/DubPlus/DubPlus

    This source code is licensed under the MIT license
    found here: https://github.com/DubPlus/DubPlus/blob/master/LICENSE

    Copyright (c) 2017-present DubPlus

    more info at https://dub.plus
*/
var DubPlus=function(){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function a(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function r(e,t){return(r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?l(e):t}function h(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var m=function(){},p={},f=[],b=[];function g(e,t){var n,o,r,i,a=b;for(i=arguments.length;2<i--;)f.push(arguments[i]);for(t&&null!=t.children&&(f.length||f.push(t.children),delete t.children);f.length;)if((o=f.pop())&&void 0!==o.pop)for(i=o.length;i--;)f.push(o[i]);else"boolean"==typeof o&&(o=null),(r="function"!=typeof e)&&(null==o?o="":"number"==typeof o?o=String(o):"string"!=typeof o&&(r=!1)),r&&n?a[a.length-1]+=o:a===b?a=[o]:a.push(o),n=r;var s=new m;return s.nodeName=e,s.children=a,s.attributes=null==t?void 0:t,s.key=null==t?void 0:t.key,s}function O(e,t){for(var n in t)e[n]=t[n];return e}function v(e,t){null!=e&&("function"==typeof e?e(t):e.current=t)}var t="function"==typeof Promise?Promise.resolve().then.bind(Promise.resolve()):setTimeout,y=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,_=[];function w(e){!e._dirty&&(e._dirty=!0)&&1==_.push(e)&&t(k)}function k(){for(var e;e=_.pop();)e._dirty&&F(e)}function x(e,t){return e.normalizedNodeName===t||e.nodeName.toLowerCase()===t.toLowerCase()}function D(e){var t=O({},e.attributes);t.children=e.children;var n=e.nodeName.defaultProps;if(void 0!==n)for(var o in n)void 0===t[o]&&(t[o]=n[o]);return t}function N(e){var t=e.parentNode;t&&t.removeChild(e)}function S(e,t,n,o,r){if("className"===t&&(t="class"),"key"===t);else if("ref"===t)v(n,null),v(o,e);else if("class"!==t||r)if("style"===t){if(o&&"string"!=typeof o&&"string"!=typeof n||(e.style.cssText=o||""),o&&"object"==typeof o){if("string"!=typeof n)for(var i in n)i in o||(e.style[i]="");for(var i in o)e.style[i]="number"==typeof o[i]&&!1===y.test(i)?o[i]+"px":o[i]}}else if("dangerouslySetInnerHTML"===t)o&&(e.innerHTML=o.__html||"");else if("o"==t[0]&&"n"==t[1]){var a=t!==(t=t.replace(/Capture$/,""));t=t.toLowerCase().substring(2),o?n||e.addEventListener(t,C,a):e.removeEventListener(t,C,a),(e._listeners||(e._listeners={}))[t]=o}else if("list"!==t&&"type"!==t&&!r&&t in e){try{e[t]=null==o?"":o}catch(e){}null!=o&&!1!==o||"spellcheck"==t||e.removeAttribute(t)}else{var s=r&&t!==(t=t.replace(/^xlink:?/,""));null==o||!1===o?s?e.removeAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase()):e.removeAttribute(t):"function"!=typeof o&&(s?e.setAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase(),o):e.setAttribute(t,o))}else e.className=o||""}function C(e){return this._listeners[e.type](e)}var E=[],T=0,A=!1,M=!1;function I(){for(var e;e=E.shift();)e.componentDidMount&&e.componentDidMount()}function L(e,t,n,o,r,i){T++||(A=null!=r&&void 0!==r.ownerSVGElement,M=null!=e&&!("__preactattr_"in e));var a=q(e,t,n,o,i);return r&&a.parentNode!==r&&r.appendChild(a),--T||(M=!1,i||I()),a}function q(e,t,n,o,r){var i=e,a=A;if(null!=t&&"boolean"!=typeof t||(t=""),"string"==typeof t||"number"==typeof t)return e&&void 0!==e.splitText&&e.parentNode&&(!e._component||r)?e.nodeValue!=t&&(e.nodeValue=t):(i=document.createTextNode(t),e&&(e.parentNode&&e.parentNode.replaceChild(i,e),j(e,!0))),i.__preactattr_=!0,i;var s,u,c=t.nodeName;if("function"==typeof c)return function(e,t,n,o){var r=e&&e._component,i=r,a=e,s=r&&e._componentConstructor===t.nodeName,u=s,c=D(t);for(;r&&!u&&(r=r._parentComponent);)u=r.constructor===t.nodeName;r&&u&&(!o||r._component)?(R(r,c,3,n,o),e=r.base):(i&&!s&&(U(i),e=a=null),r=W(t.nodeName,c,n),e&&!r.nextBase&&(r.nextBase=e,a=null),R(r,c,1,n,o),e=r.base,a&&e!==a&&(a._component=null,j(a,!1)));return e}(e,t,n,o);if(A="svg"===c||"foreignObject"!==c&&A,c=String(c),(!e||!x(e,c))&&(s=c,(u=A?document.createElementNS("http://www.w3.org/2000/svg",s):document.createElement(s)).normalizedNodeName=s,i=u,e)){for(;e.firstChild;)i.appendChild(e.firstChild);e.parentNode&&e.parentNode.replaceChild(i,e),j(e,!0)}var l=i.firstChild,d=i.__preactattr_,h=t.children;if(null==d){d=i.__preactattr_={};for(var m=i.attributes,p=m.length;p--;)d[m[p].name]=m[p].value}return!M&&h&&1===h.length&&"string"==typeof h[0]&&null!=l&&void 0!==l.splitText&&null==l.nextSibling?l.nodeValue!=h[0]&&(l.nodeValue=h[0]):(h&&h.length||null!=l)&&function(e,t,n,o,r){var i,a,s,u,c,l=e.childNodes,d=[],h={},m=0,p=0,f=l.length,b=0,g=t?t.length:0;if(0!==f)for(var v=0;v<f;v++){var y=l[v],_=y.__preactattr_,w=g&&_?y._component?y._component.__key:_.key:null;null!=w?(m++,h[w]=y):(_||(void 0!==y.splitText?!r||y.nodeValue.trim():r))&&(d[b++]=y)}if(0!==g)for(var v=0;v<g;v++){u=t[v],c=null;var w=u.key;if(null!=w)m&&void 0!==h[w]&&(c=h[w],h[w]=void 0,m--);else if(p<b)for(i=p;i<b;i++)if(void 0!==d[i]&&(k=a=d[i],C=r,"string"==typeof(S=u)||"number"==typeof S?void 0!==k.splitText:"string"==typeof S.nodeName?!k._componentConstructor&&x(k,S.nodeName):C||k._componentConstructor===S.nodeName)){c=a,d[i]=void 0,i===b-1&&b--,i===p&&p++;break}c=q(c,u,n,o),s=l[v],c&&c!==e&&c!==s&&(null==s?e.appendChild(c):c===s.nextSibling?N(s):e.insertBefore(c,s))}var k,S,C;if(m)for(var v in h)void 0!==h[v]&&j(h[v],!1);for(;p<=b;)void 0!==(c=d[b--])&&j(c,!1)}(i,h,n,o,M||null!=d.dangerouslySetInnerHTML),function(e,t,n){var o;for(o in n)t&&null!=t[o]||null==n[o]||S(e,o,n[o],n[o]=void 0,A);for(o in t)"children"===o||"innerHTML"===o||o in n&&t[o]===("value"===o||"checked"===o?e[o]:n[o])||S(e,o,n[o],n[o]=t[o],A)}(i,t.attributes,d),A=a,i}function j(e,t){var n=e._component;n?U(n):(null!=e.__preactattr_&&v(e.__preactattr_.ref,null),!1!==t&&null!=e.__preactattr_||N(e),z(e))}function z(e){for(e=e.lastChild;e;){var t=e.previousSibling;j(e,!0),e=t}}var P=[];function W(e,t,n){var o,r=P.length;for(e.prototype&&e.prototype.render?(o=new e(t,n),K.call(o,t,n)):((o=new K(t,n)).constructor=e,o.render=B);r--;)if(P[r].constructor===e)return o.nextBase=P[r].nextBase,P.splice(r,1),o;return o}function B(e,t,n){return this.constructor(e,n)}function R(e,t,n,o,r){e._disable||(e._disable=!0,e.__ref=t.ref,e.__key=t.key,delete t.ref,delete t.key,void 0===e.constructor.getDerivedStateFromProps&&(!e.base||r?e.componentWillMount&&e.componentWillMount():e.componentWillReceiveProps&&e.componentWillReceiveProps(t,o)),o&&o!==e.context&&(e.prevContext||(e.prevContext=e.context),e.context=o),e.prevProps||(e.prevProps=e.props),e.props=t,e._disable=!1,0!==n&&(1!==n&&!1===p.syncComponentUpdates&&e.base?w(e):F(e,1,r)),v(e.__ref,e))}function F(e,t,n,o){if(!e._disable){var r,i,a,s=e.props,u=e.state,c=e.context,l=e.prevProps||s,d=e.prevState||u,h=e.prevContext||c,m=e.base,p=e.nextBase,f=m||p,b=e._component,g=!1,v=h;if(e.constructor.getDerivedStateFromProps&&(u=O(O({},u),e.constructor.getDerivedStateFromProps(s,u)),e.state=u),m&&(e.props=l,e.state=d,e.context=h,2!==t&&e.shouldComponentUpdate&&!1===e.shouldComponentUpdate(s,u,c)?g=!0:e.componentWillUpdate&&e.componentWillUpdate(s,u,c),e.props=s,e.state=u,e.context=c),e.prevProps=e.prevState=e.prevContext=e.nextBase=null,e._dirty=!1,!g){r=e.render(s,u,c),e.getChildContext&&(c=O(O({},c),e.getChildContext())),m&&e.getSnapshotBeforeUpdate&&(v=e.getSnapshotBeforeUpdate(l,d));var y,_,w=r&&r.nodeName;if("function"==typeof w){var k=D(r);(i=b)&&i.constructor===w&&k.key==i.__key?R(i,k,1,c,!1):(y=i,e._component=i=W(w,k,c),i.nextBase=i.nextBase||p,i._parentComponent=e,R(i,k,0,c,!1),F(i,1,n,!0)),_=i.base}else a=f,(y=b)&&(a=e._component=null),(f||1===t)&&(a&&(a._component=null),_=L(a,r,c,n||!m,f&&f.parentNode,!0));if(f&&_!==f&&i!==b){var S=f.parentNode;S&&_!==S&&(S.replaceChild(_,f),y||(f._component=null,j(f,!1)))}if(y&&U(y),(e.base=_)&&!o){for(var C=e,x=e;x=x._parentComponent;)(C=x).base=_;_._component=C,_._componentConstructor=C.constructor}}for(!m||n?E.push(e):g||e.componentDidUpdate&&e.componentDidUpdate(l,d,v);e._renderCallbacks.length;)e._renderCallbacks.pop().call(e);T||o||I()}}function U(e){var t=e.base;e._disable=!0,e.componentWillUnmount&&e.componentWillUnmount(),e.base=null;var n=e._component;n?U(n):t&&(null!=t.__preactattr_&&v(t.__preactattr_.ref,null),N(e.nextBase=t),P.push(e),z(t)),v(e.__ref,null)}function K(e,t){this._dirty=!0,this.context=t,this.props=e,this.state=this.state||{},this._renderCallbacks=[]}function G(e,t,n){return L(n,e,{},!1,t,!1)}O(K.prototype,{setState:function(e,t){this.prevState||(this.prevState=this.state),this.state=O(O({},this.state),"function"==typeof e?e(this.state,this.props):e),t&&this._renderCallbacks.push(t),w(this)},forceUpdate:function(e){e&&this._renderCallbacks.push(e),F(this,2)},render:function(){}});var V={currentVol:50,snoozed:!1},e=function(e){if(e.startTime<2)return V.snoozed&&(Dubtrack.room.player.setVolume(V.currentVol),V.snoozed=!1),!0},H=function(){!V.snoozed&&!Dubtrack.room.player.muted_player&&2<Dubtrack.playerController.volume?(V.currentVol=Dubtrack.playerController.volume,Dubtrack.room.player.mutePlayer(),V.snoozed=!0,Dubtrack.Events.bind("realtime:room_playlist-update",e)):V.snoozed&&(Dubtrack.room.player.setVolume(V.currentVol),Dubtrack.room.player.updateVolumeBar(),V.snoozed=!1)},Y={position:"absolute",font:"1rem/1.5 proxima-nova,sans-serif",display:"block",left:"-33px",cursor:"pointer",borderRadius:"1.5rem",padding:"8px 16px",background:"#fff",fontWeight:"700",fontSize:"13.6px",textTransform:"uppercase",color:"#000",opacity:"0.8",textAlign:"center",zIndex:"9"},J=function(e){function i(){var e,t;s(this,i);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return u(l(l(t=d(this,(e=c(i)).call.apply(e,[this].concat(o))))),"state",{show:!1}),u(l(l(t)),"showTooltip",function(){t.setState({show:!0})}),u(l(l(t)),"hideTooltip",function(){t.setState({show:!1})}),t}return n(i,K),a(i,[{key:"render",value:function(e,t){return g("span",{className:"icon-mute snooze_btn",onClick:H,onMouseOver:this.showTooltip,onMouseOut:this.hideTooltip},t.show&&g("div",{className:"snooze_tooltip",style:Y},"Mute current song"))}}]),i}();var X={position:"absolute",font:"1rem/1.5 proxima-nova,sans-serif",display:"block",left:"-33px",cursor:"pointer",borderRadius:"1.5rem",padding:"8px 16px",background:"#fff",fontWeight:"700",fontSize:"13.6px",textTransform:"uppercase",color:"#000",opacity:"0.8",textAlign:"center",zIndex:"9"},$=function(e){function i(){var e,t;s(this,i);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return u(l(l(t=d(this,(e=c(i)).call.apply(e,[this].concat(o))))),"state",{show:!1,booth_time:""}),u(l(l(t)),"showTooltip",function(){var e=t.getEta();t.setState({show:!0,booth_time:e})}),u(l(l(t)),"hideTooltip",function(){t.setState({show:!1})}),t}return n(i,K),a(i,[{key:"getEta",value:function(){var e=parseInt(document.querySelector("#player-controller div.left ul li.infoContainer.display-block div.currentTime span.min").textContent),t=4*parseInt(document.querySelector(".queue-position").textContent)-4+e;return 0<=t?t:"You're not in the queue"}},{key:"render",value:function(e,t){return g("span",{className:"icon-history eta_tooltip_t",onMouseOver:this.showTooltip,onMouseOut:this.hideTooltip},this.state.show&&g("span",{className:"eta_tooltip",style:X},this.state.booth_time))}}]),i}();var Q={template:function(e){return emojify.defaultConfig.img_dir+"/"+encodeURI(e)+".png"},find:function(t){var n=this;return emojify.emojiNames.filter(function(e){return 0===e.indexOf(t)}).map(function(e){return{type:"emojify",src:n.template(e),name:e}})}},Z=[":bowtie:",":smile:",":laughing:",":blush:",":smiley:",":relaxed:",":smirk:",":heart_eyes:",":kissing_heart:",":kissing_closed_eyes:",":flushed:",":relieved:",":satisfied:",":grin:",":wink:",":stuck_out_tongue_winking_eye:",":stuck_out_tongue_closed_eyes:",":grinning:",":kissing:",":kissing_smiling_eyes:",":stuck_out_tongue:",":sleeping:",":worried:",":frowning:",":anguished:",":open_mouth:",":grimacing:",":confused:",":hushed:",":expressionless:",":unamused:",":sweat_smile:",":sweat:",":disappointed_relieved:",":weary:",":pensive:",":disappointed:",":confounded:",":fearful:",":cold_sweat:",":persevere:",":cry:",":sob:",":joy:",":astonished:",":scream:",":neckbeard:",":tired_face:",":angry:",":rage:",":triumph:",":sleepy:",":yum:",":mask:",":sunglasses:",":dizzy_face:",":imp:",":smiling_imp:",":neutral_face:",":no_mouth:",":innocent:",":alien:",":yellow_heart:",":blue_heart:",":purple_heart:",":heart:",":green_heart:",":broken_heart:",":heartbeat:",":heartpulse:",":two_hearts:",":revolving_hearts:",":cupid:",":sparkling_heart:",":sparkles:",":star:",":star2:",":dizzy:",":boom:",":collision:",":anger:",":exclamation:",":question:",":grey_exclamation:",":grey_question:",":zzz:",":dash:",":sweat_drops:",":notes:",":musical_note:",":fire:",":hankey:",":poop:",":shit:",":thumbsup:",":-1:",":thumbsdown:",":ok_hand:",":punch:",":facepunch:",":fist:",":v:",":wave:",":hand:",":raised_hand:",":open_hands:",":point_up:",":point_down:",":point_left:",":point_right:",":raised_hands:",":pray:",":point_up_2:",":clap:",":muscle:",":metal:",":fu:",":runner:",":running:",":couple:",":family:",":two_men_holding_hands:",":two_women_holding_hands:",":dancer:",":dancers:",":ok_woman:",":no_good:",":information_desk_person:",":raising_hand:",":bride_with_veil:",":person_with_pouting_face:",":person_frowning:",":bow:",":couplekiss:",":couple_with_heart:",":massage:",":haircut:",":nail_care:",":boy:",":girl:",":woman:",":man:",":baby:",":older_woman:",":older_man:",":person_with_blond_hair:",":man_with_gua_pi_mao:",":man_with_turban:",":construction_worker:",":cop:",":angel:",":princess:",":smiley_cat:",":smile_cat:",":heart_eyes_cat:",":kissing_cat:",":smirk_cat:",":scream_cat:",":crying_cat_face:",":joy_cat:",":pouting_cat:",":japanese_ogre:",":japanese_goblin:",":see_no_evil:",":hear_no_evil:",":speak_no_evil:",":guardsman:",":skull:",":feet:",":lips:",":kiss:",":droplet:",":ear:",":eyes:",":nose:",":tongue:",":love_letter:",":bust_in_silhouette:",":busts_in_silhouette:",":speech_balloon:",":thought_balloon:",":feelsgood:",":finnadie:",":goberserk:",":godmode:",":hurtrealbad:",":rage1:",":rage2:",":rage3:",":rage4:",":suspect:",":trollface:",":sunny:",":umbrella:",":cloud:",":snowflake:",":snowman:",":zap:",":cyclone:",":foggy:",":ocean:",":cat:",":dog:",":mouse:",":hamster:",":rabbit:",":wolf:",":frog:",":tiger:",":koala:",":bear:",":pig:",":pig_nose:",":cow:",":boar:",":monkey_face:",":monkey:",":horse:",":racehorse:",":camel:",":sheep:",":elephant:",":panda_face:",":snake:",":bird:",":baby_chick:",":hatched_chick:",":hatching_chick:",":chicken:",":penguin:",":turtle:",":bug:",":honeybee:",":ant:",":beetle:",":snail:",":octopus:",":tropical_fish:",":fish:",":whale:",":whale2:",":dolphin:",":cow2:",":ram:",":rat:",":water_buffalo:",":tiger2:",":rabbit2:",":dragon:",":goat:",":rooster:",":dog2:",":pig2:",":mouse2:",":ox:",":dragon_face:",":blowfish:",":crocodile:",":dromedary_camel:",":leopard:",":cat2:",":poodle:",":paw_prints:",":bouquet:",":cherry_blossom:",":tulip:",":four_leaf_clover:",":rose:",":sunflower:",":hibiscus:",":maple_leaf:",":leaves:",":fallen_leaf:",":herb:",":mushroom:",":cactus:",":palm_tree:",":evergreen_tree:",":deciduous_tree:",":chestnut:",":seedling:",":blossom:",":ear_of_rice:",":shell:",":globe_with_meridians:",":sun_with_face:",":full_moon_with_face:",":new_moon_with_face:",":new_moon:",":waxing_crescent_moon:",":first_quarter_moon:",":waxing_gibbous_moon:",":full_moon:",":waning_gibbous_moon:",":last_quarter_moon:",":waning_crescent_moon:",":last_quarter_moon_with_face:",":first_quarter_moon_with_face:",":crescent_moon:",":earth_africa:",":earth_americas:",":earth_asia:",":volcano:",":milky_way:",":partly_sunny:",":octocat:",":squirrel:",":bamboo:",":gift_heart:",":dolls:",":school_satchel:",":mortar_board:",":flags:",":fireworks:",":sparkler:",":wind_chime:",":rice_scene:",":jack_o_lantern:",":ghost:",":santa:",":christmas_tree:",":gift:",":bell:",":no_bell:",":tanabata_tree:",":tada:",":confetti_ball:",":balloon:",":crystal_ball:",":cd:",":dvd:",":floppy_disk:",":camera:",":video_camera:",":movie_camera:",":computer:",":tv:",":iphone:",":phone:",":telephone:",":telephone_receiver:",":pager:",":fax:",":minidisc:",":vhs:",":sound:",":speaker:",":mute:",":loudspeaker:",":mega:",":hourglass:",":hourglass_flowing_sand:",":alarm_clock:",":watch:",":radio:",":satellite:",":loop:",":mag:",":mag_right:",":unlock:",":lock:",":lock_with_ink_pen:",":closed_lock_with_key:",":key:",":bulb:",":flashlight:",":high_brightness:",":low_brightness:",":electric_plug:",":battery:",":calling:",":email:",":mailbox:",":postbox:",":bath:",":bathtub:",":shower:",":toilet:",":wrench:",":nut_and_bolt:",":hammer:",":seat:",":moneybag:",":yen:",":dollar:",":pound:",":euro:",":credit_card:",":money_with_wings:",":e-mail:",":inbox_tray:",":outbox_tray:",":envelope:",":incoming_envelope:",":postal_horn:",":mailbox_closed:",":mailbox_with_mail:",":mailbox_with_no_mail:",":package:",":door:",":smoking:",":bomb:",":gun:",":hocho:",":pill:",":syringe:",":page_facing_up:",":page_with_curl:",":bookmark_tabs:",":bar_chart:",":chart_with_upwards_trend:",":chart_with_downwards_trend:",":scroll:",":clipboard:",":calendar:",":date:",":card_index:",":file_folder:",":open_file_folder:",":scissors:",":pushpin:",":paperclip:",":black_nib:",":pencil2:",":straight_ruler:",":triangular_ruler:",":closed_book:",":green_book:",":blue_book:",":orange_book:",":notebook:",":notebook_with_decorative_cover:",":ledger:",":books:",":bookmark:",":name_badge:",":microscope:",":telescope:",":newspaper:",":football:",":basketball:",":soccer:",":baseball:",":tennis:",":8ball:",":rugby_football:",":bowling:",":golf:",":mountain_bicyclist:",":bicyclist:",":horse_racing:",":snowboarder:",":swimmer:",":surfer:",":ski:",":spades:",":hearts:",":clubs:",":diamonds:",":gem:",":ring:",":trophy:",":musical_score:",":musical_keyboard:",":violin:",":space_invader:",":video_game:",":black_joker:",":flower_playing_cards:",":game_die:",":dart:",":mahjong:",":clapper:",":memo:",":pencil:",":book:",":art:",":microphone:",":headphones:",":trumpet:",":saxophone:",":guitar:",":shoe:",":sandal:",":high_heel:",":lipstick:",":boot:",":shirt:",":tshirt:",":necktie:",":womans_clothes:",":dress:",":running_shirt_with_sash:",":jeans:",":kimono:",":bikini:",":ribbon:",":tophat:",":crown:",":womans_hat:",":mans_shoe:",":closed_umbrella:",":briefcase:",":handbag:",":pouch:",":purse:",":eyeglasses:",":fishing_pole_and_fish:",":coffee:",":tea:",":sake:",":baby_bottle:",":beer:",":beers:",":cocktail:",":tropical_drink:",":wine_glass:",":fork_and_knife:",":pizza:",":hamburger:",":fries:",":poultry_leg:",":meat_on_bone:",":spaghetti:",":curry:",":fried_shrimp:",":bento:",":sushi:",":fish_cake:",":rice_ball:",":rice_cracker:",":rice:",":ramen:",":stew:",":oden:",":dango:",":egg:",":bread:",":doughnut:",":custard:",":icecream:",":ice_cream:",":shaved_ice:",":birthday:",":cake:",":cookie:",":chocolate_bar:",":candy:",":lollipop:",":honey_pot:",":apple:",":green_apple:",":tangerine:",":lemon:",":cherries:",":grapes:",":watermelon:",":strawberry:",":peach:",":melon:",":banana:",":pear:",":pineapple:",":sweet_potato:",":eggplant:",":tomato:",":corn:",":house:",":house_with_garden:",":school:",":office:",":post_office:",":hospital:",":bank:",":convenience_store:",":love_hotel:",":hotel:",":wedding:",":church:",":department_store:",":european_post_office:",":city_sunrise:",":city_sunset:",":japanese_castle:",":european_castle:",":tent:",":factory:",":tokyo_tower:",":japan:",":mount_fuji:",":sunrise_over_mountains:",":sunrise:",":stars:",":statue_of_liberty:",":bridge_at_night:",":carousel_horse:",":rainbow:",":ferris_wheel:",":fountain:",":roller_coaster:",":ship:",":speedboat:",":boat:",":sailboat:",":rowboat:",":anchor:",":rocket:",":airplane:",":helicopter:",":steam_locomotive:",":tram:",":mountain_railway:",":bike:",":aerial_tramway:",":suspension_railway:",":mountain_cableway:",":tractor:",":blue_car:",":oncoming_automobile:",":car:",":red_car:",":taxi:",":oncoming_taxi:",":articulated_lorry:",":bus:",":oncoming_bus:",":rotating_light:",":police_car:",":oncoming_police_car:",":fire_engine:",":ambulance:",":minibus:",":truck:",":train:",":station:",":train2:",":bullettrain_front:",":bullettrain_side:",":light_rail:",":monorail:",":railway_car:",":trolleybus:",":ticket:",":fuelpump:",":vertical_traffic_light:",":traffic_light:",":warning:",":construction:",":beginner:",":atm:",":slot_machine:",":busstop:",":barber:",":hotsprings:",":checkered_flag:",":crossed_flags:",":izakaya_lantern:",":moyai:",":circus_tent:",":performing_arts:",":round_pushpin:",":triangular_flag_on_post:",":jp:",":kr:",":cn:",":us:",":fr:",":es:",":it:",":ru:",":gb:",":uk:",":de:",":one:",":two:",":three:",":four:",":five:",":six:",":seven:",":eight:",":nine:",":keycap_ten:",":1234:",":zero:",":hash:",":symbols:",":arrow_backward:",":arrow_down:",":arrow_forward:",":arrow_left:",":capital_abcd:",":abcd:",":abc:",":arrow_lower_left:",":arrow_lower_right:",":arrow_right:",":arrow_up:",":arrow_upper_left:",":arrow_upper_right:",":arrow_double_down:",":arrow_double_up:",":arrow_down_small:",":arrow_heading_down:",":arrow_heading_up:",":leftwards_arrow_with_hook:",":arrow_right_hook:",":left_right_arrow:",":arrow_up_down:",":arrow_up_small:",":arrows_clockwise:",":arrows_counterclockwise:",":rewind:",":fast_forward:",":information_source:",":ok:",":twisted_rightwards_arrows:",":repeat:",":repeat_one:",":new:",":top:",":up:",":cool:",":free:",":ng:",":cinema:",":koko:",":signal_strength:",":u5272:",":u5408:",":u55b6:",":u6307:",":u6708:",":u6709:",":u6e80:",":u7121:",":u7533:",":u7a7a:",":u7981:",":sa:",":restroom:",":mens:",":womens:",":baby_symbol:",":no_smoking:",":parking:",":wheelchair:",":metro:",":baggage_claim:",":accept:",":wc:",":potable_water:",":put_litter_in_its_place:",":secret:",":congratulations:",":m:",":passport_control:",":left_luggage:",":customs:",":ideograph_advantage:",":cl:",":sos:",":id:",":no_entry_sign:",":underage:",":no_mobile_phones:",":do_not_litter:",":non-potable_water:",":no_bicycles:",":no_pedestrians:",":children_crossing:",":no_entry:",":eight_spoked_asterisk:",":sparkle:",":eight_pointed_black_star:",":heart_decoration:",":vs:",":vibration_mode:",":mobile_phone_off:",":chart:",":currency_exchange:",":aries:",":taurus:",":gemini:",":cancer:",":leo:",":virgo:",":libra:",":scorpius:",":sagittarius:",":capricorn:",":aquarius:",":pisces:",":ophiuchus:",":six_pointed_star:",":negative_squared_cross_mark:",":a:",":b:",":ab:",":o2:",":diamond_shape_with_a_dot_inside:",":recycle:",":end:",":back:",":on:",":soon:",":clock1:",":clock130:",":clock10:",":clock1030:",":clock11:",":clock1130:",":clock12:",":clock1230:",":clock2:",":clock230:",":clock3:",":clock330:",":clock4:",":clock430:",":clock5:",":clock530:",":clock6:",":clock630:",":clock7:",":clock730:",":clock8:",":clock830:",":clock9:",":clock930:",":heavy_dollar_sign:",":copyright:",":registered:",":tm:",":x:",":heavy_exclamation_mark:",":bangbang:",":interrobang:",":o:",":heavy_multiplication_x:",":heavy_plus_sign:",":heavy_minus_sign:",":heavy_division_sign:",":white_flower:",":100:",":heavy_check_mark:",":ballot_box_with_check:",":radio_button:",":link:",":curly_loop:",":wavy_dash:",":part_alternation_mark:",":trident:",":black_small_square:",":white_small_square:",":black_medium_small_square:",":white_medium_small_square:",":black_medium_square:",":white_medium_square:",":white_large_square:",":white_check_mark:",":black_square_button:",":white_square_button:",":black_circle:",":white_circle:",":red_circle:",":large_blue_circle:",":large_blue_diamond:",":large_orange_diamond:",":small_blue_diamond:",":small_orange_diamond:",":small_red_triangle:",":small_red_triangle_down:",":shipit:"],ee=function(e){function t(){return s(this,t),d(this,c(t).apply(this,arguments))}return n(t,K),a(t,[{key:"componentDidUpdate",value:function(e){for(var t in e)if(e[t]!==this.props[t])return setTimeout(this.renderLayer)}},{key:"componentDidMount",value:function(){this.isMounted=!0,this.renderLayer=this.renderLayer.bind(this),this.renderLayer()}},{key:"componentWillUnmount",value:function(){this.renderLayer(!1),this.isMounted=!1,this.remote&&this.remote.parentNode.removeChild(this.remote)}},{key:"findNode",value:function(e){return"string"==typeof e?document.querySelector(e):e}},{key:"renderLayer",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];this.isMounted&&(this.props.into!==this.intoPointer&&(this.intoPointer=this.props.into,this.into&&this.remote&&(this.remote=G(g(te,null),this.into,this.remote)),this.into=this.findNode(this.props.into)),this.remote=G(g(te,{context:this.context},e&&this.props.children||null),this.into,this.remote))}},{key:"render",value:function(){return null}}]),t}(),te=function(e){function t(){return s(this,t),d(this,c(t).apply(this,arguments))}return n(t,K),a(t,[{key:"getChildContext",value:function(){return this.props.context}},{key:"render",value:function(e){var t=e.children;return t&&t[0]||null}}]),t}(),ne=function(e){function i(){var e,n;s(this,i);for(var t=arguments.length,o=new Array(t),r=0;r<t;r++)o[r]=arguments[r];return u(l(l(n=d(this,(e=c(i)).call.apply(e,[this].concat(o))))),"state",{show:!1,emojiLoad:70}),u(l(l(n)),"isLoading",!1),u(l(l(n)),"toggle",function(){n.setState(function(e){return{show:!e.show}})}),u(l(l(n)),"onScroll",function(e){var t=e.target;t.scrollTop+t.clientHeight>t.scrollHeight-25&&!n.isLoading&&(n.isLoading=!0,n.setState(function(e){var t=e.emojiLoad+70;return t>=Z.length&&(t=Z.length,document.querySelector(".dp-emoji-picker").removeEventListener("scroll",n.onScroll)),{emojiLoad:t}},function(){n.isLoading=!1}))}),n}return n(i,K),a(i,[{key:"fillChat",value:function(e){document.getElementById("chat-txt-message").value+=" "+e}},{key:"componentDidMount",value:function(){var n=this;document.addEventListener("keyup",function(e){var t="which"in e?e.which:e.keyCode;n.state.show&&27===t&&n.setState({show:!1})})}},{key:"componentDidMount",value:function(){document.querySelector(".dp-emoji-picker").addEventListener("scroll",this.onScroll)}},{key:"render",value:function(e,t){var n=this,o=t.show,r=t.emojiLoad,i=Z.slice(0,r).map(function(e){var t=e.replace(/^:|:$/g,"");return g("span",{key:"emoji-".concat(t),onClick:function(){return n.fillChat(e)}},g("img",{title:e,src:Q.template(t)}))});return g("span",{className:"dp-emoji-picker-icon fa fa-smile-o",onClick:this.toggle},g(ee,{into:".pusher-chat-widget-input"},g("div",{className:"dp-emoji-picker ".concat(o?"show":"")},i)))}}]),i}();var oe={menu:{general:"open","user-interface":"open",settings:"open",customize:"open",contact:"open"},options:{"dubplus-autovote":!1,"dubplus-emotes":!1,"dubplus-autocomplete":!1,mention_notifications:!1,dubplus_pm_notifications:!1,"dj-notification":!1,"dubplus-dubs-hover":!1,"dubplus-downdubs":!1,"dubplus-grabschat":!1,"dubplus-split-chat":!1,"dubplus-show-timestamp":!1,"dubplus-hide-bg":!1,"dubplus-hide-avatars":!1,"dubplus-chat-only":!1,"dubplus-video-only":!1,warn_redirect:!1,"dubplus-comm-theme":!1,"dubplus-afk":!1,"dubplus-snow":!1,"dubplus-custom-css":!1},custom:{customAfkMessage:"",dj_notification:1,css:"",bg:"",notificationSound:""}},re=new(function(){function n(){s(this,n),u(this,"srcRoot","https://cdn.jsdelivr.net/gh/FranciscoG/DubPlus@preact-version");var e=localStorage.getItem("dubplusUserSettings");if(e)try{var t=JSON.parse(e);this.stored=Object.assign({},oe,t)}catch(e){this.stored=oe}else this.stored=oe}return a(n,[{key:"save",value:function(e,t,n){this.stored[e][t]=n;try{localStorage.setItem("dubplusUserSettings",JSON.stringify(this.stored))}catch(e){console.error("an error occured saving dubplus to localStorage",e)}}}]),n}());function ie(e){var t="open"===e.open?"down":"right";return g("div",{id:e.id,onClick:e.onClick,className:"dubplus-menu-section-header"},g("span",{className:"fa fa-angle-".concat(t)}),g("p",null,e.category))}var ae=function(e){function i(){var e,t;s(this,i);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return u(l(l(t=d(this,(e=c(i)).call.apply(e,[this].concat(o))))),"keyUpHandler",function(e){13===e.keyCode&&(t.props.onConfirm(t.textarea.value),t.props.onClose()),27===e.keyCode&&t.props.onClose()}),u(l(l(t)),"confirmClick",function(){t.props.onConfirm(t.textarea.value),t.props.onClose()}),t}return n(i,K),a(i,[{key:"componentWillUnmount",value:function(){document.removeEventListener("keyup",this.keyUpHandler)}},{key:"componentDidUpdate",value:function(){this.props.open?document.addEventListener("keyup",this.keyUpHandler):document.removeEventListener("keyup",this.keyUpHandler)}},{key:"render",value:function(e){var t=this,n=e.onConfirm?"cancel":"close";return e.open?g(ee,{into:"body"},g("div",{className:"dp-modal"},g("aside",{className:"container"},g("div",{className:"title"},g("h1",null," ",e.title||"Dub+")),g("div",{className:"content"},g("p",null,e.content||""),e.placeholder&&g("textarea",{ref:function(e){return t.textarea=e},placeholder:e.placeholder,maxlength:e.maxlength||999},e.value||"")),g("div",{className:"dp-modal-buttons"},g("button",{id:"dp-modal-cancel",onClick:e.onClose},n),e.onConfirm&&g("button",{id:"dp-modal-confirm",onClick:this.confirmClick},"okay"))))):null}}]),i}(),se=window.ga||function(){},ue=new(function(){function t(e){s(this,t),se("create",e,"auto","dubplusTracker")}return a(t,[{key:"event",value:function(e,t,n,o){se("dubplusTracker.send","event",e,t,n,o)}},{key:"menuClick",value:function(e,t,n){this.event(e,"click",t,n)}}]),t}())("UA-116652541-1"),ce=function(e){function i(){var e,n;s(this,i);for(var t=arguments.length,o=new Array(t),r=0;r<t;r++)o[r]=arguments[r];return u(l(l(n=d(this,(e=c(i)).call.apply(e,[this].concat(o))))),"state",{section:re.stored.menu[n.props.settingsKey]||"open"}),u(l(l(n)),"toggleSection",function(e){n.setState(function(e){var t="open"===e.section?"closed":"open";return re.save("menu",n.props.settingsKey,t),{section:t}})}),n}return n(i,K),a(i,[{key:"render",value:function(e,t){var n=["dubplus-menu-section"];return"closed"===t.section&&n.push("dubplus-menu-section-closed"),g("span",null,g(ie,{onClick:this.toggleSection,id:e.id,category:e.title,open:t.section}),g("ul",{className:n.join(" ")},e.children))}}]),i}();function le(e){var t=["dubplus-menu-icon"];return e.className&&t.push(e.className),g("li",{id:e.id,title:e.desc,className:t.join(" "),onClick:e.onClick},g("span",{className:"fa fa-".concat(e.icon)}),g("span",{className:"dubplus-menu-label"},e.menuTitle))}var de=function(e){function i(){var e,t;s(this,i);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return u(l(l(t=d(this,(e=c(i)).call.apply(e,[this].concat(o))))),"state",{open:!1}),u(l(l(t)),"loadModal",function(){t.setState({open:!0}),ue.menuClick(t.props.section+" section",t.props.id+" edit")}),u(l(l(t)),"closeModal",function(){console.log("closing dub+ modal"),t.setState({open:!1}),"function"==typeof t.props.onCancel&&t.props.onCancel()}),t}return n(i,K),a(i,[{key:"render",value:function(e,t){return g("span",{onClick:this.loadModal,className:"fa fa-pencil extra-icon"},g(ae,{open:t.open||e.showModal||!1,title:e.title||"Dub+ option",content:e.content||"Please enter a value",placeholder:e.placeholder||"in here",value:e.value,onConfirm:e.onConfirm,onClose:this.closeModal}))}}]),i}(),he=function(e){function i(){var e,t;s(this,i);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return u(l(l(t=d(this,(e=c(i)).call.apply(e,[this].concat(o))))),"state",{on:re.stored.options[t.props.id]||!1}),u(l(l(t)),"switchOn",function(){t.props.turnOn(),re.save("options",t.props.id,!0),t.setState({on:!0}),ue.menuClick(t.props.section+" section",t.props.id+" on")}),u(l(l(t)),"switchOff",function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];t.props.turnOff(),re.save("options",t.props.id,!1),t.setState({on:!1}),e||ue.menuClick(t.props.section+" section",t.props.id+" off")}),u(l(l(t)),"toggleSwitch",function(){t.state.on?t.switchOff():t.switchOn()}),t}return n(i,K),a(i,[{key:"componentDidMount",value:function(){this.state.on&&this.props.turnOn()}},{key:"render",value:function(e,t){var n=["dubplus-switch"];return t.on&&n.push("dubplus-switch-on"),e.className&&n.push(e.className),g("li",{id:e.id,title:e.desc,className:n.join(" ")},e.children||null,g("div",{onClick:this.toggleSwitch,className:"dubplus-form-control"},g("div",{className:"dubplus-switch-bg"},g("div",{className:"dubplus-switcher"})),g("span",{className:"dubplus-menu-label"},e.menuTitle)))}}]),i}(),me=function(e){function i(){var e,r;s(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return u(l(l(r=d(this,(e=c(i)).call.apply(e,[this].concat(n))))),"state",{canSend:!0}),u(l(l(r)),"afk_chat_respond",function(e){if(r.state.canSend){var t=e.message,n=Dubtrack.session.get("username");if(-1<t.indexOf("@"+n)&&Dubtrack.session.id!==e.user.userInfo.userid){var o=document.getElementById("chat-txt-message");re.stored.custom.customAfkMessage?o.value="[AFK] "+re.stored.custom.customAfkMessage:o.value="[AFK] I'm not here right now.",Dubtrack.room.chat.sendMessage(),r.setState({canSend:!1}),setTimeout(function(){r.setState({canSend:!0})},3e4)}}}),r}return n(i,K),a(i,[{key:"turnOn",value:function(){Dubtrack.Events.bind("realtime:chat-message",this.afk_chat_respond)}},{key:"turnOff",value:function(){Dubtrack.Events.unbind("realtime:chat-message",this.afk_chat_respond)}},{key:"saveAFKmessage",value:function(e){re.save("custom","customAfkMessage",e)}},{key:"render",value:function(e,t){return g(he,{id:"dubplus-afk",section:"General",menuTitle:"AFK Auto-respond",desc:"Toggle Away from Keyboard and customize AFK message.",turnOn:this.turnOn,turnOff:this.turnOff},g(de,{title:"Custom AFK Message",section:"General",content:"Enter a custom Away From Keyboard [AFK] message here",value:re.stored.custom.customAfkMessage||"",placeholder:"Be right back!",maxlength:"255",onConfirm:this.saveAFKmessage}))}}]),i}(),pe=function(e){function t(){var r;return s(this,t),u(l(l(r=d(this,c(t).call(this)))),"advance_vote",function(){var e=document.createEvent("HTMLEvents");e.initEvent("click",!0,!1),r.dubup.dispatchEvent(e)}),u(l(l(r)),"voteCheck",function(e){e.startTime<2&&r.advance_vote()}),u(l(l(r)),"turnOn",function(e){var t=Dubtrack.room.player.activeSong.get("song"),n=Dubtrack.helpers.cookie.get("dub-"+Dubtrack.room.model.get("_id")),o=Dubtrack.helpers.cookie.get("dub-song");Dubtrack.room&&t&&t.songid===o||(n=!1),r.dubup.classList.contains("voted")||r.dubdown.classList.contains("voted")||n||r.advance_vote(),Dubtrack.Events.bind("realtime:room_playlist-update",r.voteCheck)}),u(l(l(r)),"turnOff",function(e){Dubtrack.Events.unbind("realtime:room_playlist-update",r.voteCheck)}),r.dubup=document.querySelector(".dubup"),r.dubdown=document.querySelector(".dubdown"),r}return n(t,K),a(t,[{key:"render",value:function(e,t){return g(he,{id:"dubplus-autovote",section:"General",menuTitle:"Autovote",desc:"Toggles auto upvoting for every song",turnOn:this.turnOn,turnOff:this.turnOff})}}]),t}(),fe=function(e){var t=e.data,n=e.onSelect;return t.header?g("li",{className:"preview-item-header ".concat(t.header.toLowerCase(),"-preview-header")},g("span",null,t.header)):g("li",{className:"preview-item ".concat(t.type,"-previews"),onClick:function(){n(t.name)},"data-name":t.name},g("div",{className:"ac-image"},g("img",{src:t.src,alt:t.name,title:t.name})),g("span",{className:"ac-text"},t.name))},be=function(e){var t=e.matches,n=e.onSelect;return 0===t.length?g("ul",{id:"autocomplete-preview"}):g("ul",{id:"autocomplete-preview",className:"ac-show"},t.map(function(e,t){return g(fe,{data:e,key:e.header?"header-row-".concat(e.header):"".concat(e.type,"-").concat(e.name),onSelect:n})}))};function ge(r){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(t,n){var o=new XMLHttpRequest;for(var e in i)i.hasOwnProperty(e)&&o.setRequestHeader(e,i[e]);o.onload=function(){try{var e=JSON.parse(o.responseText);t(e)}catch(e){n(e)}},o.onerror=function(){n()},o.open("GET",r),o.send()})}var ve=new function(){var r,e=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;if(!e)return console.error("indexDB not supported");var i=50,t=e.open("d2",1);return t.onsuccess=function(e){r=this.result},t.onerror=function(e){console.error("indexedDB request error",e)},t.onupgradeneeded=function(e){(r=this.result).createObjectStore("s",{keyPath:"k"}),r.transaction.oncomplete=function(e){r=e.target.db}},{get:function e(t,n){return!r&&0<=i?(setTimeout(function(){e(t,n)},100),void i--):(i=30,r.transaction("s").objectStore("s").get(t).onsuccess=function(e){var t=e.target.result&&e.target.result.v||null;n(t)})},set:function e(t,n){if(!r&&0<=i)return setTimeout(function(){e(t,n)},100),void i--;i=30;var o={k:t,v:n};r.transaction("s","readwrite").objectStore("s").put(o)}}};function ye(r){return new Promise(function(o,e){ve.get(r+"_api",function(e){if(e)try{void 0!==JSON.parse(e).error&&o(!0)}catch(e){o(!0)}else o(!0);var t=Date.now(),n=parseInt(localStorage.getItem(r+"_api_timestamp"));o(isNaN(n)||6048e5<t-n)})})}var _e=new(function(){function e(){var n=this;s(this,e),u(this,"specialEmotes",[]),u(this,"emotes",{}),u(this,"sortedKeys",{nonAlpha:[]}),u(this,"loaded",!1),u(this,"addKeyToSorted",function(e){var t=e.charAt(0);/[a-z]/i.test(t)?n.sortedKeys[t]?n.sortedKeys[t].push(e):n.sortedKeys[t]=[e]:n.sortedKeys.nonAlpha.push(e)})}return a(e,[{key:"load",value:function(){var t=this;return ye("twitch").then(function(e){return e?t.updateFromApi():t.grabFromDb()}).catch(function(e){return console.error(e.message)})}},{key:"done",value:function(e){this.doneCB=e}},{key:"grabFromDb",value:function(){var o=this;return new Promise(function(n,t){try{ve.get("twitch_api",function(e){console.log("dub+","twitch","loading from IndexedDB");var t=JSON.parse(e);o.processViaWebWorker(t),o.loaded="from db",t=null,n()})}catch(e){t(e)}})}},{key:"updateFromApi",value:function(){var n=this;console.log("dub+","twitch","loading from api");return ge("".concat("https://cors-escape.herokuapp.com","/https://api.twitch.tv/kraken/chat/emoticon_images")).then(function(e){var t={};e.emoticons.forEach(function(e){t[e.code]&&null!==e.emoticon_set||(t[e.code]=e.id)}),localStorage.setItem("twitch_api_timestamp",Date.now().toString()),ve.set("twitch_api",JSON.stringify(t)),n.processViaWebWorker(t),n.loaded="from api"})}},{key:"template",value:function(e){return"//static-cdn.jtvnw.net/emoticons/v1/".concat(e,"/3.0")}},{key:"find",value:function(t){var n=this,e=t.charAt(0);return(/[a-z]/i.test(e)?this.sortedKeys[e]||[]:this.sortedKeys.nonAlpha).filter(function(e){return 0===e.indexOf(t)}).map(function(e){return{type:"twitch",src:n.template(n.emotes[e]),name:e}})}},{key:"processEmotes",value:function(e){for(var t in e)if(e.hasOwnProperty(t)){var n=t.toLowerCase();if(0<=t.indexOf("\\")){this.specialEmotes.push([t,e[t]]);continue}if(0<=emojify.emojiNames.indexOf(n))continue;this.emotes[n]||(this.emotes[n]=e[t],this.addKeyToSorted(n))}this.loaded=!0,this.doneCB()}},{key:"processViaWebWorker",value:function(e){var t=this;window.URL=window.URL||window.webkitURL;var n,o="\n      var emotes = {};\n      var sortedKeys = {\n        'nonAlpha' : []\n      };\n\n      function addKeyToSorted(key) {\n        let first = key.charAt(0);\n    \n        // all numbers and symbols get stored in one 'nonAlpha' array\n        if (!/[a-z]/i.test(first)) {\n          sortedKeys.nonAlpha.push(key);\n          return;\n        }\n    \n        if (!sortedKeys[first]) {\n          sortedKeys[first] = [key];\n          return\n        }\n    \n        sortedKeys[first].push(key);\n      }\n\n      self.addEventListener('message', function(e) {\n        var emojiNames = e.data.emojiNames;\n        var data = e.data.data;\n\n        for (var code in data) {\n          if (data.hasOwnProperty(code)) {\n            var _key = code.toLowerCase();\n      \n            // not doing anything with non-named emojis\n            if (/\\\\/g.test(code)) {\n              continue;\n            }\n      \n            if (emojiNames.indexOf(_key) >= 0) {\n              continue; // don't override regular emojis handled by emojify\n            }\n      \n            if (!emotes[_key]) {\n              // if emote doesn't exist, add it\n              emotes[_key] = data[code];\n              addKeyToSorted(_key);\n            }\n          }\n        }\n\n        self.postMessage({\n          emotes: emotes,\n          sortedKeys: sortedKeys\n        });\n        close();\n      }, false);\n    ";try{n=new Blob([o],{type:"application/javascript"})}catch(e){window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,(n=new BlobBuilder).append(o),n=n.getBlob()}var r=new Worker(URL.createObjectURL(n));r.addEventListener("message",function(e){t.emotes=e.data.emotes,t.sortedKeys=e.data.sortedKeys,t.loaded=!0,t.doneCB()}),r.postMessage({data:e,emojiNames:emojify.emojiNames})}}]),e}()),we=new(function(){function e(){var n=this;s(this,e),u(this,"emotes",{}),u(this,"sortedKeys",{nonAlpha:[]}),u(this,"loaded",!1),u(this,"headers",{}),u(this,"addKeyToSorted",function(e){var t=e.charAt(0);/[a-z]/i.test(t)?(n.sortedKeys[t]||(n.sortedKeys[t]=[]),n.sortedKeys[t].push(e)):n.sortedKeys.nonAlpha.push(e)})}return a(e,[{key:"optionalSetHeaders",value:function(e){this.headers=e}},{key:"load",value:function(){var t=this;return ye("bttv").then(function(e){return e?t.updateFromAPI():t.loadFromDB()})}},{key:"loadFromDB",value:function(){var o=this;return new Promise(function(n,t){try{ve.get("bttv_api",function(e){console.log("dub+","bttv","loading from IndexedDB");var t=JSON.parse(e);o.processEmotes(t),t=null,n()})}catch(e){t(e)}})}},{key:"updateFromAPI",value:function(){var n=this;return console.log("dub+","bttv","loading from api"),ge("https://api.betterttv.net/2/emotes",this.headers).then(function(e){var t={};e.emotes.forEach(function(e){t[e.code]||(t[e.code]=e.id)}),localStorage.setItem("bttv_api_timestamp",Date.now().toString()),ve.set("bttv_api",JSON.stringify(t)),n.processEmotes(t)})}},{key:"template",value:function(e){return"//cdn.betterttv.net/emote/".concat(e,"/3x")}},{key:"find",value:function(t){var n=this,e=t.charAt(0);return(/[a-z]/i.test(e)?this.sortedKeys[e]||[]:this.sortedKeys.nonAlpha).filter(function(e){return 0===e.indexOf(t)}).map(function(e){return{type:"bttv",src:n.template(n.emotes[e]),name:e}})}},{key:"processEmotes",value:function(e){for(var t in e)if(e.hasOwnProperty(t)){var n=t.toLowerCase();if(0<=t.indexOf(":"))continue;if(0<=emojify.emojiNames.indexOf(n))continue;0<=t.indexOf("(")&&(n=n.replace(/([()])/g,"")),this.emotes[n]=e[t],this.addKeyToSorted(n)}this.loaded=!0}}]),e}()),ke=38,Se=40,Ce=13,xe=27,Oe=9,De=[ke,Se,37,39,xe,Ce],Ne=function(e){function r(){var e,a;s(this,r);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return u(l(l(a=d(this,(e=c(r)).call.apply(e,[this].concat(n))))),"state",{isOn:!1,matches:[]}),u(l(l(a)),"renderTo",document.querySelector(".pusher-chat-widget-input")),u(l(l(a)),"chatInput",document.getElementById("chat-txt-message")),u(l(l(a)),"selectedItem",null),u(l(l(a)),"checkInput",function(e){var t="which"in e?e.which:e.keyCode;if(!(0<=De.indexOf(t))){var n=e.target.value.split(" ");if(0!==n.length){var o=n[n.length-1],r=o.charAt(o.length-1);if(":"===o.charAt(0)&&3<o.length&&":"!==r){var i=a.getMatches(o);a.chunkLoadMatches(i)}else 0!==a.state.matches.length&&a.closePreview()}}}),u(l(l(a)),"updateChatInput",function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=a.chatInput.value.split(" ");n.pop(),n.push(":".concat(e,":")),a.chatInput.value=n.join(" "),t&&(a.chatInput.focus(),a.closePreview())}),u(l(l(a)),"keyboardNav",function(e){if(0===a.state.matches.length)return!0;switch("which"in e?e.which:e.keyCode){case Se:case Oe:e.preventDefault(),e.stopImmediatePropagation(),a.navDown();break;case ke:e.preventDefault(),e.stopImmediatePropagation(),a.navUp();break;case xe:a.closePreview(),a.chatInput.focus();break;case Ce:a.closePreview();break;default:return!0}}),u(l(l(a)),"turnOn",function(e){a.setState({isOn:!0}),a.debouncedCheckInput=window._.debounce(a.checkInput,100),a.debouncedNav=window._.debounce(a.keyboardNav,100),a.chatInput.addEventListener("keydown",a.debouncedNav),a.chatInput.addEventListener("keyup",a.debouncedCheckInput)}),u(l(l(a)),"turnOff",function(e){a.setState({isOn:!1}),a.chatInput.removeEventListener("keydown",a.debouncedNav),a.chatInput.removeEventListener("keyup",a.debouncedCheckInput)}),a}return n(r,K),a(r,[{key:"chunkLoadMatches",value:function(e){var t=this;if(e.length<51)this.setState({matches:e});else{var n=e.slice(0,50);this.setState({matches:n}),setTimeout(function(){t.setState({matches:e})},250)}}},{key:"getMatches",value:function(e){e=e.replace(/^:/,"");var t=Q.find(e);0<t.length&&t.unshift({header:"Emoji"});var n=we.find(e);0<n.length&&n.unshift({header:"BetterTTV"});var o=_e.find(e);return 0<o.length&&o.unshift({header:"Twitch"}),t.concat(n,o)}},{key:"closePreview",value:function(){this.setState({matches:[]}),this.selectedItem=null}},{key:"isElementInView",value:function(e){var t=document.querySelector("#autocomplete-preview"),n=e.getBoundingClientRect(),o=t.getBoundingClientRect();return n.top>=o.top&&n.bottom<=o.bottom}},{key:"navDown",value:function(){var e;this.selectedItem&&(this.selectedItem.classList.remove("selected"),e=this.selectedItem.nextSibling),e||(e=document.querySelector(".preview-item")),e.classList.contains("preview-item-header")&&(e=e.nextSibling),e.classList.add("selected"),this.isElementInView(e)||e.scrollIntoView(!1),this.selectedItem=e,this.updateChatInput(e.dataset.name,!1)}},{key:"navUp",value:function(){var e;this.selectedItem&&(this.selectedItem.classList.remove("selected"),e=this.selectedItem.previousSibling),e||(e=[].slice.call(document.querySelectorAll(".preview-item")).pop()),e.classList.contains("preview-item-header")&&(e=e.previousSibling),e||(e=[].slice.call(document.querySelectorAll(".preview-item")).pop()),e.classList.add("selected"),this.isElementInView(e)||e.scrollIntoView(!0),this.selectedItem=e,this.updateChatInput(e.dataset.name,!1)}},{key:"render",value:function(e,t){var n=t.isOn,o=t.matches;return g(he,{id:"dubplus-emotes",section:"General",menuTitle:"Autocomplete Emoji",desc:"Quick find and insert emojis and emotes while typing in the chat input",turnOn:this.turnOn,turnOff:this.turnOff},n?g(ee,{into:this.renderTo},g(be,{onSelect:this.updateChatInput,matches:o})):null)}}]),r}();function Ee(e,t){var n=e.parentNode,r=e.nodeValue.trim(),l=document.createDocumentFragment(),i="-0wrap__emote0-";t.forEach(function(e){var t,n=(t=e.replace(/^:|:$/g,""),_e.emotes[t]?{type:"twitch",src:_e.template(_e.emotes[t]),name:t}:!!we.emotes[t]&&{type:"bttv",src:we.template(we.emotes[t]),name:t});if(n){var o=JSON.stringify(n);r=r.replace(e,"".concat(i).concat(o).concat(i))}}),r.split(i).forEach(function(t){try{var e=JSON.parse(t),n=(r=(o=e).type,i=o.src,a=o.name,s=o.w,u=o.h,c=document.createElement("img"),s&&(c.width=s),u&&(c.height=u),c.className="emoji ".concat(r,"-emote"),c.title=a,c.alt=a,c.src=i,c);l.appendChild(n)}catch(e){l.appendChild(document.createTextNode(t))}var o,r,i,a,s,u,c}),n.replaceChild(l,e)}function Te(e){var t;(e.nodeType||(e=0<(t=document.querySelectorAll(".chat-main .text")).length?t[t.length-1]:null),e)&&function(e){for(var t,n=[],o=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null,!1);t=o.nextNode();)n.push(t);return n}(e).forEach(function(e){var t=e.nodeValue.trim();if(""!==t){var n=function(e){var t=[],n="",o=!1,r=0;function i(){n="",o=!1}function a(e){n+=e}for(;r<e.length;){var s=e.charAt(r);if(o||":"!==s){if(o){if(":"===s){a(s),"::"!==n&&t.push(n),i(),r++;continue}if(" "===s){i(),r++;continue}a(s)}r++}else o=!0,a(s),r++}return t}(t);0!==n.length&&Ee(e,n)}})}var Ae=function(e){function i(){var e,t;s(this,i);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return u(l(l(t=d(this,(e=c(i)).call.apply(e,[this].concat(o))))),"turnOn",function(){if(!_e.loaded)return document.body.classList.add("dubplus-icon-spinning"),we.load(),_e.done(t.begin),void _e.load();t.begin()}),u(l(l(t)),"turnOff",function(e){Dubtrack.Events.unbind("realtime:chat-message",Te)}),t}return n(i,K),a(i,[{key:"begin",value:function(){document.body.classList.remove("dubplus-icon-spinning"),Te(document.querySelector(".chat-main")),Dubtrack.Events.bind("realtime:chat-message",Te)}},{key:"render",value:function(e,t){return g(he,{id:"dubplus-emotes",section:"General",menuTitle:"Emotes",desc:"Adds twitch and bttv emotes in chat.",turnOn:this.turnOn,turnOff:this.turnOff})}}]),i}(),Me=function(e){function i(){var e,t;s(this,i);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return u(l(l(t=d(this,(e=c(i)).call.apply(e,[this].concat(o))))),"customMentionCheck",function(e){var t=e.message;if(re.custom.custom_mentions){var n=re.custom.custom_mentions.split(",").some(function(e){return new RegExp("\\b"+e.trim()+"\\b","i").test(t)});Dubtrack.session.id!==e.user.userInfo.userid&&n&&Dubtrack.room.chat.mentionChatSound.play()}}),u(l(l(t)),"saveCustomMentions",function(e){re.save("custom","custom_mentions",e)}),t}return n(i,K),a(i,[{key:"turnOn",value:function(){Dubtrack.Events.bind("realtime:chat-message",this.customMentionCheck)}},{key:"turnOff",value:function(){Dubtrack.Events.unbind("realtime:chat-message",this.customMentionCheck)}},{key:"render",value:function(e,t){return g(he,{id:"custom_mentions",section:"General",menuTitle:"Custom Mentions",desc:"Toggle using custom mentions to trigger sounds in chat",turnOn:this.turnOn,turnOff:this.turnOff},g(de,{title:"Custom AFK Message",section:"General",content:"Add your custom mention triggers here (separate by comma)",value:re.stored.custom.custom_mentions||"",placeholder:"separate, custom triggers, by, comma, :heart:",maxlength:"255",onConfirm:this.saveCustomMentions}))}}]),i}(),Ie=function(e){function i(){var e,t;s(this,i);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return u(l(l(t=d(this,(e=c(i)).call.apply(e,[this].concat(o))))),"chatCleanerCheck",function(e){var t=Array.from(document.querySelectorAll("ul.chat-main > li")),n=parseInt(re.stored.custom.chat_cleaner,10);if(!(isNaN(t.length)||isNaN(n)||!t.length||t.length<n)){var o=t[0].parentElement,r=t.length-n;0<r&&t.splice(0,r).forEach(function(e){o.removeChild(e)})}}),u(l(l(t)),"saveAmount",function(e){var t=parseInt(e,10),n=isNaN(t)?500:t;re.save("custom","chat_cleaner",n)}),u(l(l(t)),"turnOn",function(){Dubtrack.Events.bind("realtime:chat-message",t.chatCleanerCheck)}),u(l(l(t)),"turnOff",function(){Dubtrack.Events.unbind("realtime:chat-message",t.chatCleanerCheck)}),t}return n(i,K),a(i,[{key:"render",value:function(){return g(he,{id:"chat-cleaner",section:"General",menuTitle:"Chat Cleaner",desc:"Automatically only keep a designated chatItems of chat items while clearing older ones, keeping CPU stress down",turnOn:this.turnOn,turnOff:this.turnOff},g(de,{title:"Chat Cleaner",section:"General",content:"Please specify the number of most recent chat items that will remain in your chat history",value:re.stored.custom.chat_cleaner||"",placeholder:"500",maxlength:"5",onConfirm:this.saveAmount}))}}]),i}(),Le=!0,qe={denyDismiss:{title:"Desktop Notifications",content:"You have dismissed or chosen to deny the request to allow desktop notifications. Reset this choice by clearing your cache for the site."},noSupport:{title:"Desktop Notifications",content:"Sorry this browser does not support desktop notifications.  Please use the latest version of Chrome or FireFox"}};function je(e){var t="function"==typeof e?e:function(){};return"Notification"in window?"granted"===Notification.permission?t(!0,"granted"):"denied"===Notification.permission?t(!1,qe.denyDismiss):void Notification.requestPermission().then(function(e){if("denied"!==e&&"default"!==e)return t(!0,"granted");t(!1,qe.denyDismiss)}):t(!1,qe.noSupport)}function ze(e){var t=Object.assign({},{title:"New Message",content:"",ignoreActiveTab:!1,callback:null,wait:5e3},e);if(!0!==Le||t.ignoreActiveTab){var n={body:t.content,icon:"https://res.cloudinary.com/hhberclba/image/upload/c_lpad,h_100,w_100/v1400351432/dubtrack_new_logo_fvpxa6.png"},o=new Notification(t.title,n);o.onclick=function(){window.focus(),"function"==typeof t.callback&&t.callback(),o.close()},setTimeout(o.close.bind(o),t.wait)}}window.onfocus=function(){Le=!0},window.onblur=function(){Le=!1};var Pe=function(e){function i(){var e,n;s(this,i);for(var t=arguments.length,o=new Array(t),r=0;r<t;r++)o[r]=arguments[r];return u(l(l(n=d(this,(e=c(i)).call.apply(e,[this].concat(o))))),"state",{showWarning:!1,warnTitle:"",warnContent:""}),u(l(l(n)),"turnOn",function(){je(function(e,t){!0===e?Dubtrack.Events.bind("realtime:chat-message",n.notifyOnMention):(n.switchRef.switchOff(!0),n.setState({showWarning:!0,warnTitle:t.title,warnContent:t.content}))})}),u(l(l(n)),"closeModal",function(){n.setState({showWarning:!1})}),u(l(l(n)),"turnOff",function(){Dubtrack.Events.unbind("realtime:chat-message",n.notifyOnMention)}),n}return n(i,K),a(i,[{key:"notifyOnMention",value:function(e){var t=e.message,n=["@"+Dubtrack.session.get("username").toLowerCase()];re.stored.options.custom_mentions&&re.stored.custom.custom_mentions&&(n=n.concat(re.stored.custom.custom_mentions.split(","))),n.some(function(e){return new RegExp("\\b"+e.trim()+"\\b","i").test(t)})&&!this.isActiveTab&&Dubtrack.session.id!==e.user.userInfo.userid&&ze({title:"Message from ".concat(e.user.username),content:t})}},{key:"render",value:function(e,t){var n=this;return g(he,{ref:function(e){return n.switchRef=e},id:"mention_notifications",section:"General",menuTitle:"Notification on Mentions",desc:"Enable desktop notifications when a user mentions you in chat",turnOn:this.turnOn,turnOff:this.turnOff},g(ae,{open:t.showWarning,title:t.warnTitle,content:t.warnContent,onClose:this.closeModal}))}}]),i}(),We=function(e){function i(){var e,n;s(this,i);for(var t=arguments.length,o=new Array(t),r=0;r<t;r++)o[r]=arguments[r];return u(l(l(n=d(this,(e=c(i)).call.apply(e,[this].concat(o))))),"state",{showWarning:!1,warnTitle:"",warnContent:""}),u(l(l(n)),"turnOn",function(){je(function(e,t){!0===e?Dubtrack.Events.bind("realtime:new-message",n.notify):(n.switchRef.switchOff(!0),n.setState({showWarning:!0,warnTitle:t.title,warnContent:t.content}))})}),u(l(l(n)),"closeModal",function(){n.setState({showWarning:!1})}),u(l(l(n)),"turnOff",function(){Dubtrack.Events.unbind("realtime:new-message",n.notify)}),n}return n(i,K),a(i,[{key:"notify",value:function(e){Dubtrack.session.get("_id")!==e.userid&&ze({title:"You have a new PM",ignoreActiveTab:!0,callback:function(){document.querySelector(".user-messages").click(),setTimeout(function(){document.querySelector('.message-item[data-messageid="'.concat(e.messageid,'"]')).click()},500)},wait:1e4})}},{key:"render",value:function(e,t){var n=this;return g(he,{ref:function(e){return n.switchRef=e},id:"dubplus_pm_notifications",section:"General",menuTitle:"Notification on PM",desc:"Enable desktop notifications when a user receives a private message",turnOn:this.turnOn,turnOff:this.turnOff},g(ae,{open:t.showWarning,title:t.warnTitle,content:t.warnContent,onClose:this.closeModal}))}}]),i}(),Be=function(e){function i(){var e,r;s(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return u(l(l(r=d(this,(e=c(i)).call.apply(e,[this].concat(n))))),"state",{canNotify:!1}),u(l(l(r)),"savePosition",function(e){var t=parseInt(e,10),n=isNaN(t)?2:t;re.save("custom","dj_notification",n)}),u(l(l(r)),"djNotificationCheck",function(e){if(!(2<e.startTime)){var t=document.querySelector(".queue-position").textContent,n=parseInt(t,10),o=e.startTime<0&&!isNaN(n)?n-1:n;isNaN(n)||o!==re.stored.custom.dj_notification||(r.canNotify&&ze({title:"DJ Alert!",content:"You will be DJing shortly! Make sure your song is set!",ignoreActiveTab:!0,wait:1e4}),Dubtrack.room.chat.mentionChatSound.play())}}),u(l(l(r)),"turnOn",function(){je(function(e,t){!0===e&&r.setState({canNotify:!0})}),Dubtrack.Events.bind("realtime:room_playlist-update",r.djNotificationCheck)}),u(l(l(r)),"turnOff",function(){Dubtrack.Events.unbind("realtime:room_playlist-update",r.djNotificationCheck)}),r}return n(i,K),a(i,[{key:"render",value:function(e,t){var n=this;return g(he,{ref:function(e){return n.switchRef=e},id:"dj-notification",section:"General",menuTitle:"DJ Notification",desc:"Notification when you are coming up to be the DJ",turnOn:this.turnOn,turnOff:this.turnOff},g(de,{title:"DJ Notification",section:"General",content:"Please specify the position in queue you want to be notified at",value:re.stored.custom.dj_notification||"",placeholder:"2",maxlength:"2",onConfirm:this.savePosition}))}}]),i}();Date.now||(Date.now=function(){return(new Date).getTime()}),function(){for(var e=["webkit","moz"],t=0;t<e.length&&!window.requestAnimationFrame;++t){var n=e[t];window.requestAnimationFrame=window[n+"RequestAnimationFrame"],window.cancelAnimationFrame=window[n+"CancelAnimationFrame"]||window[n+"CancelRequestAnimationFrame"]}if(/iP(ad|hone|od).*OS 6/.test(window.navigator.userAgent)||!window.requestAnimationFrame||!window.cancelAnimationFrame){var o=0;window.requestAnimationFrame=function(e){var t=Date.now(),n=Math.max(o+16,t);return setTimeout(function(){e(o=n)},n-t)},window.cancelAnimationFrame=clearTimeout}}();var Re=function(){function o(){var r={flakeCount:35,flakeColor:"#ffffff",flakeIndex:999999,flakePosition:"absolute",minSize:1,maxSize:2,minSpeed:1,maxSpeed:5,round:!1,shadow:!1,collection:!1,image:!1,collectionHeight:40},n=[],o={},a=0,s=0,u=0,c=0,l=function(e,t){return Math.round(e+Math.random()*(t-e))},d=function(e,t){for(var n in t)e.style[n]=t[n]+("width"==n||"height"==n?"px":"")},h=function(e,t,n){this.x=l(u,s-u),this.y=l(0,a),this.size=t,this.speed=n,this.step=0,this.stepSize=l(1,10)/100,r.collection&&(this.target=canvasCollection[l(0,canvasCollection.length-1)]);var o=null;r.image?(o=new Image).src=r.image:(o=document.createElement("div"),d(o,{background:r.flakeColor})),o.className="snowfall-flakes",d(o,{width:this.size,height:this.size,position:r.flakePosition,top:0,left:0,"will-change":"transform",fontSize:0,zIndex:r.flakeIndex}),r.round&&d(o,{"-moz-border-radius":~~r.maxSize+"px","-webkit-border-radius":~~r.maxSize+"px",borderRadius:~~r.maxSize+"px"}),r.shadow&&d(o,{"-moz-box-shadow":"1px 1px 1px #555","-webkit-box-shadow":"1px 1px 1px #555",boxShadow:"1px 1px 1px #555"}),e.tagName===document.body.tagName?document.body.appendChild(o):e.appendChild(o),this.element=o,this.update=function(){var e,t;this.y+=this.speed,this.y>a-(this.size+6)&&this.reset(),e=this.element,t="translateY("+this.y+"px) translateX("+this.x+"px)",e.style.webkitTransform=t,e.style.MozTransform=t,e.style.msTransform=t,e.style.OTransform=t,e.style.transform=t,this.step+=this.stepSize,this.x+=Math.cos(this.step),(this.x+this.size>s-u||this.x<u)&&this.reset()},this.reset=function(){this.y=0,this.x=l(u,s-u),this.stepSize=l(1,10)/100,this.size=l(100*r.minSize,100*r.maxSize)/100,this.element.style.width=this.size+"px",this.element.style.height=this.size+"px",this.speed=l(r.minSpeed,r.maxSpeed)}};return{snow:function(e,t){for(function(e,t){for(var n in t)e.hasOwnProperty(n)&&(e[n]=t[n])}(r,t),a=(o=e).offsetHeight,s=o.offsetWidth,o.snow=this,"body"===o.tagName.toLowerCase()&&(u=25),window.addEventListener("resize",function(){a=o.clientHeight,s=o.offsetWidth},!0),i=0;i<r.flakeCount;i+=1)n.push(new h(o,l(100*r.minSize,100*r.maxSize)/100,l(r.minSpeed,r.maxSpeed)));!function e(){for(var t=0;t<n.length;t+=1)n[t].update();c=requestAnimationFrame(function(){e()})}()},clear:function(){for(var e=null,t=(e=o.getElementsByClassName?o.getElementsByClassName("snowfall-flakes"):o.querySelectorAll(".snowfall-flakes")).length;t--;)e[t].parentNode===o&&o.removeChild(e[t]);cancelAnimationFrame(c)}}}return{snow:function(e,t){if("string"==typeof t)if(0<e.length)for(var n=0;n<e.length;n++)e[n].snow&&e[n].snow.clear();else e.snow.clear();else if(0<e.length)for(n=0;n<e.length;n++)(new o).snow(e[n],t);else(new o).snow(e,t)}}}(),Fe={round:!0,shadow:!0,flakeCount:50,minSize:1,maxSize:5,minSpeed:5,maxSpeed:5},Ue=function(e){function i(){var e,t;s(this,i);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return u(l(l(t=d(this,(e=c(i)).call.apply(e,[this].concat(o))))),"turnOn",function(){var e=document.getElementById("snow-container");e||t.makeContainer(),Re.snow(e,Fe)}),u(l(l(t)),"turnOff",function(){var e=document.getElementById("snow-container");e&&e.remove()}),t}return n(i,K),a(i,[{key:"makeContainer",value:function(){var e=document.createElement("div");e.id="snow-container",e.style.cssText="\n      position:absolute;\n      top:0;\n      left:0;\n      width: 100%;\n      height: 100%;\n    ",document.body.appendChild(e)}},{key:"render",value:function(){var t=this;return g(he,{ref:function(e){return t.switchRef=e},id:"dubplus-snow",section:"General",menuTitle:"Snow",desc:"Make it snow!",turnOn:this.turnOn,turnOff:this.turnOff})}}]),i}(),Ke={particles:[],drops:[],numbase:5,numb:2,height:0,controls:{rain:2,alpha:1,color:200,opacity:1,saturation:100,lightness:50,back:0,multi:!1,speed:1},init:function(){var e=document.createElement("canvas");e.id="dubPlusRainCanvas",e.style.cssText="position : fixed; top : 0px; left : 0px; z-index: 100; pointer-events:none;",document.body.insertBefore(e,document.body.childNodes[0]),this.bindCanvas()},destroy:function(){document.body.removeChild(document.getElementById("dubPlusRainCanvas")),this.unbindCanvas()},bindCanvas:function(){this.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)};var e=document.getElementById("dubPlusRainCanvas");if(e){var t=e.getContext("2d");this.width,this.height=0,window.onresize=function(){this.width=e.width=window.innerWidth,this.height=e.height=window.innerHeight},window.onresize(),this.particles,this.drops=[],this.numbase=5,this.numb=2;var n=this;!function e(){n.requestAnimFrame(e),n.update(),n.rendu(t)}()}},buildRainParticle:function(e,t,n){for(n||(n=this.numb);n--;)this.particles.push({speedX:.25*Math.random(),speedY:9*Math.random()+1,X:e,Y:t,alpha:1,color:"hsla("+this.controls.color+","+this.controls.saturation+"%, "+this.controls.lightness+"%,"+this.controls.opacity+")"})},explosion:function(e,t,n,o){for(o||(o=this.numbase);o--;)this.drops.push({speedX:4*Math.random()-2,speedY:-4*Math.random(),X:e,Y:t,radius:.65+Math.floor(1.6*Math.random()),alpha:1,color:n})},rendu:function(e){1==this.controls.multi&&(this.controls.color=360*Math.random()),e.save(),e.clearRect(0,0,width,height);for(var t,n=this.particles,o=this.drops,r=2*Math.PI,i=0;t=n[i];i++)e.globalAlpha=t.alpha,e.fillStyle=t.color,e.fillRect(t.X,t.Y,t.speedY/4,t.speedY);var a;for(i=0;a=o[i];i++)e.globalAlpha=a.alpha,e.fillStyle=a.color,e.beginPath(),e.arc(a.X,a.Y,a.radius,0,r),e.fill();e.strokeStyle="white",e.lineWidth=2,e.restore()},update:function(){for(var e,t=this.particles,n=this.drops,o=0;e=t[o];o++)e.X+=e.speedX,e.Y+=e.speedY+5,e.Y>height-15&&(t.splice(o--,1),this.explosion(e.X,e.Y,e.color));var r;for(o=0;r=n[o];o++)r.X+=r.speedX,r.Y+=r.speedY,r.radius-=.075,0<r.alpha?r.alpha-=.005:r.alpha=0,r.radius<0&&n.splice(o--,1);for(o=this.controls.rain;o--;)this.buildRainParticle(Math.floor(Math.random()*width),-15)},unbindCanvas:function(){this.requestAnimFrame=function(){}}},Ge=function(e){function t(){return s(this,t),d(this,c(t).apply(this,arguments))}return n(t,K),a(t,[{key:"turnOn",value:function(){Ke.init()}},{key:"turnOff",value:function(){Ke.destroy()}},{key:"render",value:function(e,t){return g(he,{id:"dubplus-rain",section:"General",menuTitle:"Rain",desc:"Make it rain!",turnOn:this.turnOn,turnOff:this.turnOff})}}]),t}();function Ve(e){return Dubtrack.helpers.isDubtrackAdmin(e)||Dubtrack.room.users.getIfOwner(e)||Dubtrack.room.users.getIfManager(e)||Dubtrack.room.users.getIfMod(e)}var He=function(e){var t=e.data,n=e.click;return g("li",{onClick:function(){return n("@"+t.username+" ")},className:"dubinfo-preview-item"},g("div",{className:"dubinfo-image"},g("img",{src:"https://api.dubtrack.fm/user/".concat(t.userid,"/image")})),g("span",{className:"dubinfo-text"},"@",t.username))},Ye=function(e){function t(){return s(this,t),d(this,c(t).apply(this,arguments))}return n(t,K),a(t,[{key:"getBgColor",value:function(){var e,t=this.props.type.replace("dubs","");if("up"===t)e=document.querySelector(".dubup");else{if("down"!==t)return;e=document.querySelector(".dubdown")}return e.classList.contains("voted")?window.getComputedStyle(e).backgroundColor:window.getComputedStyle(e.querySelector(".icon-".concat(t,"vote"))).color}},{key:"updateChat",value:function(e){var t=document.getElementById("chat-txt-message");t.value=e,t.focus()}},{key:"makeList",value:function(){var n=this;return this.props.dubs.map(function(e,t){return g(He,{data:e,click:n.updateChat,key:"info-".concat(n.props.type,"-").concat(t)})})}},{key:"render",value:function(e){var t=e.type,n=e.isMod,o="No ".concat(t," have been casted yet!");"grabs"===t&&(o="This song hasn't been grabbed yet!");var r=this.makeList(),i=["dubinfo-preview","dubinfo-".concat(t)];return 0===r.length&&(r=g("li",{className:"dubinfo-preview-none"},o),i.push("dubinfo-no-dubs")),"downdubs"!==t||n||i.push("dubinfo-unauthorized"),g("ul",{style:{borderColor:this.getBgColor()},className:i.join(" ")},r)}}]),t}(),Je=function(e){function r(){var e,i;s(this,r);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return u(l(l(i=d(this,(e=c(r)).call.apply(e,[this].concat(n))))),"state",{isOn:!1,showWarning:!1,upDubs:[],downDubs:[],grabs:[]}),u(l(l(i)),"userIsMod",Ve(Dubtrack.session.id)),u(l(l(i)),"turnOn",function(){i.setState({isOn:!0},i.resetDubs),Dubtrack.Events.bind("realtime:room_playlist-dub",i.dubWatcher),Dubtrack.Events.bind("realtime:room_playlist-queue-update-grabs",i.grabWatcher),Dubtrack.Events.bind("realtime:user-leave",i.dubUserLeaveWatcher),Dubtrack.Events.bind("realtime:room_playlist-update",i.resetDubs),Dubtrack.Events.bind("realtime:room_playlist-update",i.resetGrabs)}),u(l(l(i)),"turnOff",function(){i.setState({isOn:!1}),Dubtrack.Events.unbind("realtime:room_playlist-dub",i.dubWatcher),Dubtrack.Events.unbind("realtime:room_playlist-queue-update-grabs",i.grabWatcher),Dubtrack.Events.unbind("realtime:user-leave",i.dubUserLeaveWatcher),Dubtrack.Events.unbind("realtime:room_playlist-update",i.resetDubs),Dubtrack.Events.unbind("realtime:room_playlist-update",i.resetGrabs)}),u(l(l(i)),"closeModal",function(){i.setState({showWarning:!1})}),u(l(l(i)),"dubWatcher",function(t){var e=i.state,n=e.upDubs,o=e.downDubs,r={userid:t.user._id,username:t.user.username};"updub"===t.dubtype&&(0===n.filter(function(e){return e.userid===t.user._id}).length&&i.setState(function(e){return{upDubs:[].concat(h(e.upDubs),[r])}}),0<o.filter(function(e){return e.userid===t.user._id}).length&&i.setState(function(e){return{downDubs:e.downDubs.filter(function(e){return e.userid!==t.user._id})}}));"downdub"===t.dubtype&&(0===o.filter(function(e){return e.userid===t.user._id}).length&&i.userIsMod&&i.setState(function(e){return{downDubs:[].concat(h(e.downDubs),[r])}}),0<n.filter(function(e){return e.userid===t.user._id}).length&&i.setState(function(e){return{upDubs:e.upDubs.filter(function(e){return e.userid!==t.user._id})}}))}),u(l(l(i)),"grabWatcher",function(t){if(i.state.grabs.filter(function(e){return e.userid===t.user._id}).length<=0){var n={userid:t.user._id,username:t.user.username};i.setState(function(e){return{grabs:[].concat(h(e.grabs),[n])}})}}),u(l(l(i)),"dubUserLeaveWatcher",function(t){var e=i.state.upDubs.filter(function(e){return e.userid!==t.user._id}),n=i.state.downDubs.filter(function(e){return e.userid!==t.user._id}),o=i.state.grabs.filter(function(e){return e.userid!==t.user._id});i.setState({upDubs:e,downDubs:n,grabs:o})}),u(l(l(i)),"resetDubs",function(){i.setState({upDubs:[],downDubs:[]},i.handleReset)}),u(l(l(i)),"resetGrabs",function(){i.setState({grabs:[]})}),i}return n(r,K),a(r,[{key:"handleReset",value:function(){var r=this;ge("https://api.dubtrack.fm/room/".concat(Dubtrack.room.model.id,"/playlist/active/dubs")).then(function(e){e.data&&e.data.upDubs&&e.data.upDubs.forEach(function(o){if(!(0<r.state.upDubs.filter(function(e){return e.userid===o.userid}).length)){var e=Dubtrack.room.users.collection.findWhere({userid:o.userid});if(e&&e.attributes){if(e.attributes._user.username){var t={userid:o.userid,username:e.attributes._user.username};r.setState(function(e){return{upDubs:[].concat(h(e.upDubs),[t])}})}}else ge("https://api.dubtrack.fm/user/"+o.userid).then(function(e){var t=e.data;if(t&&t.userinfo&&t.userinfo.username){var n={userid:o.userid,username:t.userinfo.username};r.setState(function(e){return{upDubs:[].concat(h(e.upDubs),[n])}})}})}}),e.data&&e.data.downDubs&&r.userIsMod&&e.data.downDubs.forEach(function(o){if(!(0<r.state.downDubs.filter(function(e){return e.userid===o.userid}).length)){var e=Dubtrack.room.users.collection.findWhere({userid:o.userid});if(e&&e.attributes){if(e.attributes._user.username){var t={userid:o.userid,username:e.attributes._user.username};r.setState(function(e){return{downDubs:[].concat(h(e.downDubs),[t])}})}}else ge("https://api.dubtrack.fm/user/"+o.userid).then(function(e){var t=e.data;if(t&&t.userinfo&&t.userinfo.username){var n={userid:o.userid,username:t.userinfo.username};r.setState(function(e){return{downDubs:[].concat(h(e.downDubs),[n])}})}})}})})}},{key:"componentWillMount",value:function(){this.upElem=document.querySelector(".dubup").parentElement,this.upElem.classList.add("dubplus-updub-btn"),this.downElem=document.querySelector(".dubdown").parentElement,this.downElem.classList.add("dubplus-downdub-btn"),this.grabElem=document.querySelector(".add-to-playlist-button").parentElement,this.grabElem.classList.add("dubplus-grab-btn")}},{key:"render",value:function(e,t){return g(he,{id:"dubplus-dubs-hover",section:"General",menuTitle:"Show Dub info on Hover",desc:"Show Dub info on Hover.",turnOn:this.turnOn,turnOff:this.turnOff},g(ae,{open:t.showWarning,title:"Vote & Grab Info",content:"Please note that this feature is currently still in development. We are waiting on the ability to pull grab vote information from Dubtrack on load. Until then the only grabs you will be able to see are those you are present in the room for.",onClose:this.closeModal}),t.isOn?g("span",null,g(ee,{into:this.upElem},g(Ye,{type:"updubs",dubs:t.upDubs})),g(ee,{into:this.downElem},g(Ye,{type:"downdubs",isMod:this.userIsMod,dubs:t.downDubs})),g(ee,{into:this.grabElem},g(Ye,{type:"grabs",dubs:t.grabs}))):null)}}]),r}();var Xe=function(e){function t(){return s(this,t),d(this,c(t).apply(this,arguments))}return n(t,K),a(t,[{key:"turnOn",value:function(){Ve(Dubtrack.session.id)&&Dubtrack.Events.bind("realtime:room_playlist-dub",this.downdubWatcher)}},{key:"turnOff",value:function(){Dubtrack.Events.unbind("realtime:room_playlist-dub",this.downdubWatcher)}},{key:"downdubWatcher",value:function(e){if(Dubtrack.session.get("username")===Dubtrack.room.users.collection.findWhere({userid:Dubtrack.room.player.activeSong.attributes.song.userid}).attributes._user.username&&"downdub"===e.dubtype){var t=function(e,t){var n=document.createElement("li");n.className="dubplus-chat-system dubplus-chat-system-downdub";var o=document.createElement("div");o.className="chatDelete",o.onclick=function(e){return e.currentTarget.parentElement.remove()};var r=document.createElement("span");r.className="icon-close";var i=document.createElement("div");return i.className="text",i.textContent="@".concat(e," has downdubbed your song ").concat(t),o.appendChild(r),n.appendChild(o),n.appendChild(i),n}(e.user.username,Dubtrack.room.player.activeSong.attributes.songInfo.name);document.querySelector("ul.chat-main").appendChild(t)}}},{key:"render",value:function(){return g(he,{id:"dubplus-downdubs",section:"General",menuTitle:"Downdubs in Chat (mods only)",desc:"Toggle showing downdubs in the chat box (mods only)",turnOn:this.turnOn,turnOff:this.turnOff})}}]),t}();var $e=function(e){function t(){return s(this,t),d(this,c(t).apply(this,arguments))}return n(t,K),a(t,[{key:"turnOn",value:function(){Dubtrack.Events.bind("realtime:room_playlist-dub",this.updubWatcher)}},{key:"turnOff",value:function(){Dubtrack.Events.unbind("realtime:room_playlist-dub",this.updubWatcher)}},{key:"updubWatcher",value:function(e){if(Dubtrack.session.get("username")===Dubtrack.room.users.collection.findWhere({userid:Dubtrack.room.player.activeSong.attributes.song.userid}).attributes._user.username&&"updub"===e.dubtype){var t=function(e,t){var n=document.createElement("li");n.className="dubplus-chat-system dubplus-chat-system-updub";var o=document.createElement("div");o.className="chatDelete",o.onclick=function(e){return e.currentTarget.parentElement.remove()};var r=document.createElement("span");r.className="icon-close";var i=document.createElement("div");return i.className="text",i.textContent="@".concat(e," has updubbed your song ").concat(t),o.appendChild(r),n.appendChild(o),n.appendChild(i),n}(e.user.username,Dubtrack.room.player.activeSong.attributes.songInfo.name);document.querySelector("ul.chat-main").appendChild(t)}}},{key:"render",value:function(){return g(he,{id:"dubplus-updubs",section:"General",menuTitle:"Updubs in Chat",desc:"Toggle showing updubs in the chat box",turnOn:this.turnOn,turnOff:this.turnOff})}}]),t}();var Qe=function(e){function t(){return s(this,t),d(this,c(t).apply(this,arguments))}return n(t,K),a(t,[{key:"turnOn",value:function(){Dubtrack.Events.bind("realtime:room_playlist-queue-update-grabs",this.grabChatWatcher)}},{key:"turnOff",value:function(){Dubtrack.Events.unbind("realtime:room_playlist-queue-update-grabs",this.grabChatWatcher)}},{key:"grabChatWatcher",value:function(e){if(Dubtrack.session.get("username")===Dubtrack.room.users.collection.findWhere({userid:Dubtrack.room.player.activeSong.attributes.song.userid}).attributes._user.username&&!Dubtrack.room.model.get("displayUserGrab")){var t=function(e,t){var n=document.createElement("li");n.className="dubplus-chat-system dubplus-chat-system-grab";var o=document.createElement("div");o.className="chatDelete",o.onclick=function(e){return e.currentTarget.parentElement.remove()};var r=document.createElement("span");r.className="icon-close";var i=document.createElement("div");return i.className="text",i.textContent="@".concat(e," has grabbed your song ").concat(t),o.appendChild(r),n.appendChild(o),n.appendChild(i),n}(e.user.username,Dubtrack.room.player.activeSong.attributes.songInfo.name);document.querySelector("ul.chat-main").appendChild(t)}}},{key:"render",value:function(){return g(he,{id:"dubplus-grabschat",section:"General",menuTitle:"Grabs in Chat",desc:"Toggle showing grabs in the chat box",turnOn:this.turnOn,turnOff:this.turnOff})}}]),t}(),Ze=function(){return g(ce,{id:"dubplus-general",title:"General",settingsKey:"general"},g(pe,null),g(me,null),g(Ne,null),g(Ae,null),g(Me,null),g(Ie,null),g(Pe,null),g(We,null),g(Be,null),g(Je,null),g(Xe,null),g($e,null),g(Qe,null),g(Ue,null),g(Ge,null))};function et(){var e=document.querySelector("#room-main-player-container");e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()}var tt=function(){return g(le,{id:"dubplus-fullscreen",section:"User Interface",menuTitle:"Fullscreen Video",desc:"Toggle fullscreen video mode",icon:"arrows-alt",onClick:et})};function nt(){document.body.classList.add("dubplus-split-chat")}function ot(){document.body.classList.remove("dubplus-split-chat")}var rt=function(){return g(he,{id:"dubplus-split-chat",section:"User Interface",menuTitle:"Split Chat",desc:"Toggle Split Chat UI enhancement",turnOn:nt,turnOff:ot})};function it(){document.body.classList.add("dubplus-video-only")}function at(){document.body.classList.remove("dubplus-video-only")}var st=function(){return g(he,{id:"dubplus-video-only",section:"User Interface",menuTitle:"Hide Chat",desc:"Toggles hiding the chat box",turnOn:it,turnOff:at})};function ut(){document.body.classList.add("dubplus-chat-only")}function ct(){document.body.classList.remove("dubplus-chat-only")}var lt=function(){return g(he,{id:"dubplus-chat-only",section:"User Interface",menuTitle:"Hide Video",desc:"Toggles hiding the video box",turnOn:ut,turnOff:ct})};function dt(){document.body.classList.add("dubplus-hide-avatars")}function ht(){document.body.classList.remove("dubplus-hide-avatars")}var mt=function(){return g(he,{id:"dubplus-hide-avatars",section:"User Interface",menuTitle:"Hide Avatars",desc:"Toggle hiding user avatars in the chat box.",turnOn:dt,turnOff:ht})};function pt(){document.body.classList.add("dubplus-hide-bg")}function ft(){document.body.classList.remove("dubplus-hide-bg")}var bt=function(){return g(he,{id:"dubplus-hide-bg",section:"User Interface",menuTitle:"Hide Background",desc:"Toggle hiding background image.",turnOn:pt,turnOff:ft})};function gt(){document.body.classList.add("dubplus-show-timestamp")}function vt(){document.body.classList.remove("dubplus-show-timestamp")}var yt=function(){return g(he,{id:"dubplus-show-timestamp",section:"User Interface",menuTitle:"Show Timestamps",desc:"Toggle always showing chat message timestamps.",turnOn:gt,turnOff:vt})},_t=function(){return g(ce,{id:"dubplus-ui",title:"UI",settingsKey:"user-interface"},g(tt,null),g(rt,null),g(st,null),g(lt,null),g(mt,null),g(bt,null),g(yt,null))};function wt(e){if(32===(e.keyCode||e.which)){var t=event.target.tagName.toLowerCase();"input"!==t&&"textarea"!==t&&Dubtrack.room.player.mutePlayer()}}function kt(){document.addEventListener("keyup",wt)}function St(){document.removeEventListener("keyup",wt)}var Ct=function(){return g(he,{id:"dubplus-spacebar-mute",section:"Settings",menuTitle:"Spacebar Mute",desc:"Turn on/off the ability to mute current song with the spacebar.",turnOn:kt,turnOff:St})};function xt(e){return e.returnValue=""}function Ot(){window.addEventListener("beforeunload",xt)}function Dt(){window.removeEventListener("beforeunload",xt)}var Nt=function(){return g(he,{id:"warn_redirect",section:"Settings",menuTitle:"Warn On Navigation",desc:"Warns you when accidentally clicking on a link that takes you out of dubtrack.",turnOn:Ot,turnOff:Dt})},Et=function(){return g(ce,{id:"dubplus-settings",title:"Settings",settingsKey:"settings"},g(Ct,null),g(Nt,null))},Tt=function(e,t){var n=document.createElement("link");return n.rel="stylesheet",n.type="text/css",n.className=e||"",n.href=t,n};var At={load:function(e,t){if(e){var n=Tt(t,re.srcRoot+e+"?1549212698341");document.head.appendChild(n)}},loadExternal:function(e,t){if(e){var n=Tt(t,e);document.head.appendChild(n)}}};function Mt(){ge("https://api.dubtrack.fm/room/"+Dubtrack.room.model.get("roomUrl")).then(function(e){var t=e.data.description,n=new RegExp(/(@dub(x|plus|\+)=)((https?:\/\/)?[\w-]+(\.[\w-]+)+\.?(:\d+)?(\/\S*)?)/,"i"),r=null;t.replace(n,function(e,t,n,o){console.log("loading community css theme:",o),r=o}),r&&At.loadExternal(r,"dubplus-comm-theme")})}function It(){var e=document.querySelector(".dubplus-comm-theme");e&&e.remove()}var Lt=function(){return g(he,{id:"dubplus-comm-theme",section:"Customize",menuTitle:"Community Theme",desc:"Toggle Community CSS theme.",turnOn:Mt,turnOff:It})},qt=function(e){function i(){var e,t;s(this,i);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return u(l(l(t=d(this,(e=c(i)).call.apply(e,[this].concat(o))))),"isOn",!1),u(l(l(t)),"state",{showModal:!1}),u(l(l(t)),"turnOn",function(){t.isOn=!0,re.stored.custom.css?At.loadExternal(re.stored.custom.css,"dubplus-custom-css"):t.setState({showModal:!0})}),u(l(l(t)),"turnOff",function(){t.isOn=!1,document.querySelector(".dubplus-custom-css").remove()}),u(l(l(t)),"save",function(e){re.save("custom","css",e),t.isOn&&""!==e&&At.loadExternal(re.stored.custom.css,"dubplus-custom-css"),t.setState({showModal:!1})}),t}return n(i,K),a(i,[{key:"render",value:function(e,t){return g(he,{id:"dubplus-custom-css",section:"Customize",menuTitle:"Custom CSS",desc:"Add your own custom CSS.",turnOn:this.turnOn,turnOff:this.turnOff},g(de,{showModal:t.showModal,title:"Custom CSS",section:"Customize",content:"Enter a url location for your custom css",value:re.stored.custom.css||"",placeholder:"https://example.com/example.css",maxlength:"500",onConfirm:this.save}))}}]),i}(),jt=function(e){function i(){var e,t;s(this,i);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return u(l(l(t=d(this,(e=c(i)).call.apply(e,[this].concat(o))))),"isOn",!1),u(l(l(t)),"state",{showModal:!1}),u(l(l(t)),"turnOn",function(){t.isOn=!0,re.stored.custom.bg?t.addCustomBG(re.stored.custom.bg):t.setState({showModal:!0})}),u(l(l(t)),"turnOff",function(){t.isOn=!1,t.revertBG()}),u(l(l(t)),"save",function(e){re.save("custom","bg",e),t.isOn&&""!==e&&t.addCustomBG(e),t.setState({showModal:!1})}),t}return n(i,K),a(i,[{key:"addCustomBG",value:function(e){var t=document.querySelector(".backstretch-item img");this.saveSrc=t.src,t.src=e}},{key:"revertBG",value:function(){document.querySelector(".backstretch-item img").src=this.saveSrc}},{key:"render",value:function(e,t){return g(he,{id:"dubplus-custom-bg",section:"Customize",menuTitle:"Custom Background Image",desc:"Add your own custom Background.",turnOn:this.turnOn,turnOff:this.turnOff},g(de,{showModal:t.showModal,title:"Custom Background Image",section:"Customize",content:"Enter the full URL of an image. We recommend using a .jpg file. Leave blank to remove the current background image",value:re.stored.custom.bg||"",placeholder:"https://example.com/big-image.jpg",maxlength:"500",onConfirm:this.save}))}}]),i}(),zt="Enter the full URL of a sound file. We recommend using an .mp3 file. Leave blank to go back to Dubtrack's default sound",Pt=function(e){function i(){var e,t;s(this,i);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return u(l(l(t=d(this,(e=c(i)).call.apply(e,[this].concat(o))))),"isOn",!1),u(l(l(t)),"state",{showModal:!1,modalMessage:zt}),u(l(l(t)),"turnOn",function(){t.isOn=!0,re.stored.custom.notificationSound?Dubtrack.room.chat.mentionChatSound.url=re.stored.custom.notificationSound:t.setState({showModal:!0,modalMessage:zt})}),u(l(l(t)),"turnOff",function(){t.isOn=!1,Dubtrack.room.chat.mentionChatSound.url="/assets/music/user_ping.mp3",t.setState({showModal:!1})}),u(l(l(t)),"save",function(e){soundManager.canPlayURL(e)?(re.save("custom","notificationSound",e),t.isOn&&(Dubtrack.room.chat.mentionChatSound.url=e),t.setState({showModal:!1})):t.setState({modalMessage:"You've entered an invalid sound url! Please make sure you are entering the full, direct url to the file. IE: https://example.com/sweet-sound.mp3",showModal:!0})}),u(l(l(t)),"onCancel",function(){re.stored.custom.notificationSound||t.turnOff()}),t}return n(i,K),a(i,[{key:"render",value:function(e,t){return g(he,{id:"dubplus-custom-notification-sound",section:"Customize",menuTitle:"Custom Notification Sound",desc:"Change the notification sound to a custom one.",turnOn:this.turnOn,turnOff:this.turnOff},g(de,{showModal:t.showModal,title:"Custom Notification Sound",section:"Customize",content:t.modalMessage,value:re.stored.custom.notificationSound||"",placeholder:"https://example.com/sweet-sound.mp3",maxlength:"500",onConfirm:this.save,onCancel:this.onCancel}))}}]),i}(),Wt=function(){return g(ce,{id:"dubplus-customize",title:"Customize",settingsKey:"customize"},g(Lt,null),g(qt,null),g(jt,null),g(Pt,null))},Bt=function(){return setTimeout(function(){G(g(J,null),document.querySelector(".player_sharing")),G(g($,null),document.querySelector(".player_sharing")),G(g(ne,null),document.querySelector(".chat-text-box-icons"))},10),g("section",{className:"dubplus-menu"},g("p",{className:"dubplus-menu-header"},"Dub+ Options"),g(Ze,null),g(_t,null),g(Et,null),g(Wt,null),g(ce,{id:"dubplus-contacts",title:"Contacts",settingsKey:"contact"},g("li",{class:"dubplus-menu-icon"},g("span",{class:"fa fa-bug"}),g("a",{href:"https://discord.gg/XUkG3Qy",class:"dubplus-menu-label",target:"_blank"},"Report bugs on Discord")),g("li",{class:"dubplus-menu-icon"},g("span",{class:"fa fa-reddit-alien"}),g("a",{href:"https://www.reddit.com/r/DubPlus/",class:"dubplus-menu-label",target:"_blank"},"Reddit")),g("li",{class:"dubplus-menu-icon"},g("span",{class:"fa fa-facebook"}),g("a",{href:"https://facebook.com/DubPlusScript",class:"dubplus-menu-label",target:"_blank"},"Facebook")),g("li",{class:"dubplus-menu-icon"},g("span",{class:"fa fa-twitter"}),g("a",{href:"https://twitter.com/DubPlusScript",class:"dubplus-menu-label",target:"_blank"},"Twitter"))))};function Rt(e,t){for(var n=e.split("."),o=n.length,r=t||window,i=0;i<o;i++){if(void 0===r[n[i]])return!1;r=r[n[i]]}return!0}function Ft(e,t){for(var n=e.length,o=t||window,r=0;r<n;r++)if(!Rt(e[r],o))return console.log(e[r],"is not found yet"),!1;return!0}function Ut(t,e){if("string"==typeof t||Array.isArray(t)){var n=function(){},o=function(){},r=Object.assign({},{interval:500,seconds:15,isNode:!1},e),i=Array.isArray(t)?Ft:Rt;r.isNode&&(i=function(e){return null!==typeof document.querySelector(e)});var a=0,s=1e3*r.seconds/r.interval,u=function e(){return a++,i(t)?n():a<s?void window.setTimeout(e,r.interval):o()};return{then:function(e){return"function"==typeof e&&(n=e),window.setTimeout(u,r.interval),this},fail:function(e){return"function"==typeof e&&(o=e),this}}}console.warn("WaitFor: invalid first argument")}var Kt,Gt,Vt,Ht,Yt={fontFamily:"'Trebuchet MS', Helvetica, sans-serif",zIndex:"2147483647",color:"white",position:"fixed",top:"69px",right:"-250px",background:"#222",padding:"10px",lineHeight:1,boxShadow:"0px 0px 5px 0px rgba(0,0,0,0.75)",borderRadius:"5px",overflow:"hidden",width:"230px",transition:"right 200ms",cursor:"pointer"},Jt={float:"left",width:"26px",marginRight:"5px"},Xt={display:"table-cell",width:"10000px",paddingTop:"5px"},$t=function(e){function i(){var e,t;s(this,i);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return u(l(l(t=d(this,(e=c(i)).call.apply(e,[this].concat(o))))),"state",{mainStyles:Yt}),u(l(l(t)),"dismiss",function(){t.setState(function(e,t){return{mainStyles:Object.assign({},e.mainStyles,{right:"-250px"})}})}),t}return n(i,K),a(i,[{key:"componentDidMount",value:function(){var e=this;setTimeout(function(){e.setState(function(e,t){return{mainStyles:Object.assign({},e.mainStyles,{right:"13px"})}})},200)}},{key:"componentWillUnmount",value:function(){this.dismiss()}},{key:"render",value:function(e,t){return g("div",{style:t.mainStyles,onClick:this.dismiss},g("div",{style:Jt},g("img",{src:re.srcRoot+"/images/dubplus.svg",alt:"DubPlus icon"})),g("span",{style:Xt},e.text||"Waiting for Dubtrack..."))}}]),i}(),Qt=function(e){function i(){var e,t;s(this,i);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return u(l(l(t=d(this,(e=c(i)).call.apply(e,[this].concat(o))))),"state",{open:!1}),u(l(l(t)),"toggle",function(){var e=document.querySelector(".dubplus-menu");t.state.open?(e.classList.remove("dubplus-menu-open"),t.setState({open:!1})):(e.classList.add("dubplus-menu-open"),t.setState({open:!0}))}),t}return n(i,K),a(i,[{key:"render",value:function(e,t){return g("div",{className:"dubplus-icon",onClick:this.toggle},g("img",{src:"".concat(re.srcRoot,"/images/dubplus.svg"),alt:"DubPlus Icon"}))}}]),i}();[Element.prototype,CharacterData.prototype,DocumentType.prototype].forEach(function(e){e.hasOwnProperty("remove")||Object.defineProperty(e,"remove",{configurable:!0,enumerable:!0,writable:!0,value:function(){null!==this.parentNode&&this.parentNode.removeChild(this)}})}),"undefined"==typeof Promise&&(Kt="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.auto.min.js",Vt=document.createElement("script"),Ht=document.getElementsByTagName("script")[0],Vt.async=1,Vt.onload=Vt.onreadystatechange=function(e,t){(t||!Vt.readyState||/loaded|complete/.test(Vt.readyState))&&(Vt.onload=Vt.onreadystatechange=null,Vt=void 0,t||Gt&&Gt())},Vt.onerror=function(e){Gt&&Gt(e)},Vt.src=Kt,Ht.parentNode.insertBefore(Vt,Ht)),window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach),document.getElementById("dubplus-script-ext")||setTimeout(function(){At.loadExternal("https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"),At.load("/css/dubplus.css")},1),G(g(function(e){function i(){var e,t;s(this,i);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return u(l(l(t=d(this,(e=c(i)).call.apply(e,[this].concat(o))))),"state",{loading:!0,error:!1,errorMsg:"",failed:!1}),t}return n(i,K),a(i,[{key:"componentDidMount",value:function(){var e=this;if(window.DubPlus)Dubtrack.session.id?this.showError("Dub+ is already loaded"):this.showError("You're not logged in. Please login to use Dub+.");else{new Ut(["Dubtrack.session.id","Dubtrack.room.chat","Dubtrack.Events","Dubtrack.room.player","Dubtrack.helpers.cookie","Dubtrack.room.model","Dubtrack.room.users"],{seconds:120}).then(function(){e.setState({loading:!1,error:!1})}).fail(function(){Dubtrack.session.id?(e.showError("Something happed, refresh and try again"),ue.event("Dub+ lib","load","failed")):e.showError("You're not logged in. Please login to use Dub+.")})}}},{key:"showError",value:function(e){this.setState({loading:!1,error:!0,errorMsg:e})}},{key:"render",value:function(e,t){var n=this;return t.loading?g($t,null):t.error?g(ae,{title:"Dub+ Error",onClose:function(){n.setState({failed:!0,error:!1})},content:t.errorMsg}):t.failed?null:(document.querySelector("html").classList.add("dubplus"),g(Bt,null))}}]),i}(),null),document.body),new Ut(".header-right-navigation .user-messages",{seconds:60,isNode:!0}).then(function(){G(g(Qt,null),document.querySelector(".header-right-navigation"))});return{version:"2.0.0",description:"Dub+ - A simple script/extension for Dubtrack.fm",license:"MIT",bugs:"https://github.com/DubPlus/DubPlus/issues"}}();
