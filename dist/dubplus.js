
/*
     /$$$$$$$            /$$                
    | $$__  $$          | $$          /$$   
    | $$  | $$ /$$   /$$| $$$$$$$    | $$   
    | $$  | $$| $$  | $$| $$__  $$ /$$$$$$$$
    | $$  | $$| $$  | $$| $$  | $$|__  $$__/
    | $$  | $$| $$  | $$| $$  | $$   | $$   
    | $$$$$$$/|  $$$$$$/| $$$$$$$/   |__/   
    |_______/  ______/ |_______/           
                                            
                                            
    https://github.com/DubPlus/DubPlus

    This source code is licensed under the MIT license 
    found here: https://github.com/DubPlus/DubPlus/blob/master/LICENSE

    Copyright (c) 2017-present DubPlus

    more info at https://dub.plus
*/
var DubPlus=function(){"use strict";var e=function(){},t={},n=[],o=[];function r(t,r){var i,s,a,u,c=o;for(u=arguments.length;u-- >2;)n.push(arguments[u]);for(r&&null!=r.children&&(n.length||n.push(r.children),delete r.children);n.length;)if((s=n.pop())&&void 0!==s.pop)for(u=s.length;u--;)n.push(s[u]);else"boolean"==typeof s&&(s=null),(a="function"!=typeof t)&&(null==s?s="":"number"==typeof s?s=String(s):"string"!=typeof s&&(a=!1)),a&&i?c[c.length-1]+=s:c===o?c=[s]:c.push(s),i=a;var l=new e;return l.nodeName=t,l.children=c,l.attributes=null==r?void 0:r,l.key=null==r?void 0:r.key,l}function i(e,t){for(var n in t)e[n]=t[n];return e}var s="function"==typeof Promise?Promise.resolve().then.bind(Promise.resolve()):setTimeout,a=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,u=[];function c(e){!e._dirty&&(e._dirty=!0)&&1==u.push(e)&&s(l)}function l(){var e,t=u;for(u=[];e=t.pop();)e._dirty&&E(e)}function d(e,t){return e.normalizedNodeName===t||e.nodeName.toLowerCase()===t.toLowerCase()}function p(e){var t=i({},e.attributes);t.children=e.children;var n=e.nodeName.defaultProps;if(void 0!==n)for(var o in n)void 0===t[o]&&(t[o]=n[o]);return t}function f(e){var t=e.parentNode;t&&t.removeChild(e)}function h(e,t,n,o,r){if("className"===t&&(t="class"),"key"===t);else if("ref"===t)n&&n(null),o&&o(e);else if("class"!==t||r)if("style"===t){if(o&&"string"!=typeof o&&"string"!=typeof n||(e.style.cssText=o||""),o&&"object"==typeof o){if("string"!=typeof n)for(var i in n)i in o||(e.style[i]="");for(var i in o)e.style[i]="number"==typeof o[i]&&!1===a.test(i)?o[i]+"px":o[i]}}else if("dangerouslySetInnerHTML"===t)o&&(e.innerHTML=o.__html||"");else if("o"==t[0]&&"n"==t[1]){var s=t!==(t=t.replace(/Capture$/,""));t=t.toLowerCase().substring(2),o?n||e.addEventListener(t,m,s):e.removeEventListener(t,m,s),(e._listeners||(e._listeners={}))[t]=o}else if("list"!==t&&"type"!==t&&!r&&t in e){try{e[t]=null==o?"":o}catch(e){}null!=o&&!1!==o||"spellcheck"==t||e.removeAttribute(t)}else{var u=r&&t!==(t=t.replace(/^xlink:?/,""));null==o||!1===o?u?e.removeAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase()):e.removeAttribute(t):"function"!=typeof o&&(u?e.setAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase(),o):e.setAttribute(t,o))}else e.className=o||""}function m(e){return this._listeners[e.type](e)}var b=[],v=0,y=!1,g=!1;function _(){for(var e;e=b.pop();)e.componentDidMount&&e.componentDidMount()}function k(e,t,n,o,r,i){v++||(y=null!=r&&void 0!==r.ownerSVGElement,g=null!=e&&!("__preactattr_"in e));var s=w(e,t,n,o,i);return r&&s.parentNode!==r&&r.appendChild(s),--v||(g=!1,i||_()),s}function w(e,t,n,o,r){var i=e,s=y;if(null!=t&&"boolean"!=typeof t||(t=""),"string"==typeof t||"number"==typeof t)return e&&void 0!==e.splitText&&e.parentNode&&(!e._component||r)?e.nodeValue!=t&&(e.nodeValue=t):(i=document.createTextNode(t),e&&(e.parentNode&&e.parentNode.replaceChild(i,e),O(e,!0))),i.__preactattr_=!0,i;var a,u,c=t.nodeName;if("function"==typeof c)return function(e,t,n,o){var r=e&&e._component,i=r,s=e,a=r&&e._componentConstructor===t.nodeName,u=a,c=p(t);for(;r&&!u&&(r=r._parentComponent);)u=r.constructor===t.nodeName;r&&u&&(!o||r._component)?(N(r,c,3,n,o),e=r.base):(i&&!a&&(T(i),e=s=null),r=S(t.nodeName,c,n),e&&!r.nextBase&&(r.nextBase=e,s=null),N(r,c,1,n,o),e=r.base,s&&e!==s&&(s._component=null,O(s,!1)));return e}(e,t,n,o);if(y="svg"===c||"foreignObject"!==c&&y,c=String(c),(!e||!d(e,c))&&(a=c,(u=y?document.createElementNS("http://www.w3.org/2000/svg",a):document.createElement(a)).normalizedNodeName=a,i=u,e)){for(;e.firstChild;)i.appendChild(e.firstChild);e.parentNode&&e.parentNode.replaceChild(i,e),O(e,!0)}var l=i.firstChild,m=i.__preactattr_,b=t.children;if(null==m){m=i.__preactattr_={};for(var v=i.attributes,_=v.length;_--;)m[v[_].name]=v[_].value}return!g&&b&&1===b.length&&"string"==typeof b[0]&&null!=l&&void 0!==l.splitText&&null==l.nextSibling?l.nodeValue!=b[0]&&(l.nodeValue=b[0]):(b&&b.length||null!=l)&&function(e,t,n,o,r){var i,s,a,u,c,l=e.childNodes,p=[],h={},m=0,b=0,v=l.length,y=0,g=t?t.length:0;if(0!==v)for(var _=0;_<v;_++){var k=l[_],D=k.__preactattr_,C=g&&D?k._component?k._component.__key:D.key:null;null!=C?(m++,h[C]=k):(D||(void 0!==k.splitText?!r||k.nodeValue.trim():r))&&(p[y++]=k)}if(0!==g)for(var _=0;_<g;_++){u=t[_],c=null;var C=u.key;if(null!=C)m&&void 0!==h[C]&&(c=h[C],h[C]=void 0,m--);else if(b<y)for(i=b;i<y;i++)if(void 0!==p[i]&&(S=s=p[i],N=r,"string"==typeof(x=u)||"number"==typeof x?void 0!==S.splitText:"string"==typeof x.nodeName?!S._componentConstructor&&d(S,x.nodeName):N||S._componentConstructor===x.nodeName)){c=s,p[i]=void 0,i===y-1&&y--,i===b&&b++;break}c=w(c,u,n,o),a=l[_],c&&c!==e&&c!==a&&(null==a?e.appendChild(c):c===a.nextSibling?f(a):e.insertBefore(c,a))}var S,x,N;if(m)for(var _ in h)void 0!==h[_]&&O(h[_],!1);for(;b<=y;)void 0!==(c=p[y--])&&O(c,!1)}(i,b,n,o,g||null!=m.dangerouslySetInnerHTML),function(e,t,n){var o;for(o in n)t&&null!=t[o]||null==n[o]||h(e,o,n[o],n[o]=void 0,y);for(o in t)"children"===o||"innerHTML"===o||o in n&&t[o]===("value"===o||"checked"===o?e[o]:n[o])||h(e,o,n[o],n[o]=t[o],y)}(i,t.attributes,m),y=s,i}function O(e,t){var n=e._component;n?T(n):(null!=e.__preactattr_&&e.__preactattr_.ref&&e.__preactattr_.ref(null),!1!==t&&null!=e.__preactattr_||f(e),D(e))}function D(e){for(e=e.lastChild;e;){var t=e.previousSibling;O(e,!0),e=t}}var C=[];function S(e,t,n){var o,r=C.length;for(e.prototype&&e.prototype.render?(o=new e(t,n),P.call(o,t,n)):((o=new P(t,n)).constructor=e,o.render=x);r--;)if(C[r].constructor===e)return o.nextBase=C[r].nextBase,C.splice(r,1),o;return o}function x(e,t,n){return this.constructor(e,n)}function N(e,n,o,r,i){e._disable||(e._disable=!0,e.__ref=n.ref,e.__key=n.key,delete n.ref,delete n.key,void 0===e.constructor.getDerivedStateFromProps&&(!e.base||i?e.componentWillMount&&e.componentWillMount():e.componentWillReceiveProps&&e.componentWillReceiveProps(n,r)),r&&r!==e.context&&(e.prevContext||(e.prevContext=e.context),e.context=r),e.prevProps||(e.prevProps=e.props),e.props=n,e._disable=!1,0!==o&&(1!==o&&!1===t.syncComponentUpdates&&e.base?c(e):E(e,1,i)),e.__ref&&e.__ref(e))}function E(e,t,n,o){if(!e._disable){var r,s,a,u=e.props,c=e.state,l=e.context,d=e.prevProps||u,f=e.prevState||c,h=e.prevContext||l,m=e.base,y=e.nextBase,g=m||y,w=e._component,D=!1,C=h;if(e.constructor.getDerivedStateFromProps&&(c=i(i({},c),e.constructor.getDerivedStateFromProps(u,c)),e.state=c),m&&(e.props=d,e.state=f,e.context=h,2!==t&&e.shouldComponentUpdate&&!1===e.shouldComponentUpdate(u,c,l)?D=!0:e.componentWillUpdate&&e.componentWillUpdate(u,c,l),e.props=u,e.state=c,e.context=l),e.prevProps=e.prevState=e.prevContext=e.nextBase=null,e._dirty=!1,!D){r=e.render(u,c,l),e.getChildContext&&(l=i(i({},l),e.getChildContext())),m&&e.getSnapshotBeforeUpdate&&(C=e.getSnapshotBeforeUpdate(d,f));var x,P,M=r&&r.nodeName;if("function"==typeof M){var A=p(r);(s=w)&&s.constructor===M&&A.key==s.__key?N(s,A,1,l,!1):(x=s,e._component=s=S(M,A,l),s.nextBase=s.nextBase||y,s._parentComponent=e,N(s,A,0,l,!1),E(s,1,n,!0)),P=s.base}else a=g,(x=w)&&(a=e._component=null),(g||1===t)&&(a&&(a._component=null),P=k(a,r,l,n||!m,g&&g.parentNode,!0));if(g&&P!==g&&s!==w){var j=g.parentNode;j&&P!==j&&(j.replaceChild(P,g),x||(g._component=null,O(g,!1)))}if(x&&T(x),e.base=P,P&&!o){for(var W=e,q=e;q=q._parentComponent;)(W=q).base=P;P._component=W,P._componentConstructor=W.constructor}}for(!m||n?b.unshift(e):D||e.componentDidUpdate&&e.componentDidUpdate(d,f,C);e._renderCallbacks.length;)e._renderCallbacks.pop().call(e);v||o||_()}}function T(e){var t=e.base;e._disable=!0,e.componentWillUnmount&&e.componentWillUnmount(),e.base=null;var n=e._component;n?T(n):t&&(t.__preactattr_&&t.__preactattr_.ref&&t.__preactattr_.ref(null),e.nextBase=t,f(t),C.push(e),D(t)),e.__ref&&e.__ref(null)}function P(e,t){this._dirty=!0,this.context=t,this.props=e,this.state=this.state||{},this._renderCallbacks=[]}function M(e,t,n){return k(n,e,{},!1,t,!1)}i(P.prototype,{setState:function(e,t){this.prevState||(this.prevState=this.state),this.state=i(i({},this.state),"function"==typeof e?e(this.state,this.props):e),t&&this._renderCallbacks.push(t),c(this)},forceUpdate:function(e){e&&this._renderCallbacks.push(e),E(this,2)},render:function(){}});var A=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},j=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),W=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},q=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},R=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},L={currentVol:50,snoozed:!1},I=function(e){if(e.startTime<2)return L.snoozed&&(Dubtrack.room.player.setVolume(L.currentVol),L.snoozed=!1),!0},U=function(){!L.snoozed&&!Dubtrack.room.player.muted_player&&Dubtrack.playerController.volume>2?(L.currentVol=Dubtrack.playerController.volume,Dubtrack.room.player.mutePlayer(),L.snoozed=!0,Dubtrack.Events.bind("realtime:room_playlist-update",I)):L.snoozed&&(Dubtrack.room.player.setVolume(L.currentVol),Dubtrack.room.player.updateVolumeBar(),L.snoozed=!1)},G={position:"absolute",font:"1rem/1.5 proxima-nova,sans-serif",display:"block",left:"-33px",cursor:"pointer",borderRadius:"1.5rem",padding:"8px 16px",background:"#fff",fontWeight:"700",fontSize:"13.6px",textTransform:"uppercase",color:"#000",opacity:"0.8",textAlign:"center",zIndex:"9"},F=function(e){function t(){var e,n,o;A(this,t);for(var r=arguments.length,i=Array(r),s=0;s<r;s++)i[s]=arguments[s];return n=o=q(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.state={show:!1},o.showTooltip=function(){o.setState({show:!0})},o.hideTooltip=function(){o.setState({show:!1})},q(o,n)}return W(t,P),j(t,[{key:"render",value:function(e,t){return r("span",{className:"icon-mute snooze_btn",onClick:U,onMouseOver:this.showTooltip,onMouseOut:this.hideTooltip},t.show&&r("div",{className:"snooze_tooltip",style:G},"Mute current song"))}}]),t}();var z={position:"absolute",font:"1rem/1.5 proxima-nova,sans-serif",display:"block",left:"-33px",cursor:"pointer",borderRadius:"1.5rem",padding:"8px 16px",background:"#fff",fontWeight:"700",fontSize:"13.6px",textTransform:"uppercase",color:"#000",opacity:"0.8",textAlign:"center",zIndex:"9"},B=function(e){function t(){var e,n,o;A(this,t);for(var r=arguments.length,i=Array(r),s=0;s<r;s++)i[s]=arguments[s];return n=o=q(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.state={show:!1,booth_time:""},o.showTooltip=function(){var e=o.getEta();o.setState({show:!0,booth_time:e})},o.hideTooltip=function(){o.setState({show:!1})},q(o,n)}return W(t,P),j(t,[{key:"getEta",value:function(){var e=parseInt(document.querySelector("#player-controller div.left ul li.infoContainer.display-block div.currentTime span.min").textContent),t=4*parseInt(document.querySelector(".queue-position").textContent)-4+e;return t>=0?t:"You're not in the queue"}},{key:"render",value:function(e,t){return r("span",{className:"icon-history eta_tooltip_t",onMouseOver:this.showTooltip,onMouseOut:this.hideTooltip},this.state.show&&r("span",{className:"eta_tooltip",style:z},this.state.booth_time))}}]),t}();function Y(e){var t="open"===e.open?"down":"right";return r("div",{id:e.id,onClick:e.onClick,className:"dubplus-menu-section-header"},r("span",{className:"fa fa-angle-"+t}),r("p",null,e.category))}var H={menu:{general:"open","user-interface":"open",settings:"open",customize:"open",contact:"open"},options:{"dubplus-autovote":!1,"dubplus-emotes":!1,"dubplus-autocomplete":!1,mention_notifications:!1,dubplus_pm_notifications:!1,"dj-notification":!1,"dubplus-dubs-hover":!1,"dubplus-downdubs":!1,"dubplus-grabschat":!1,"dubplus-split-chat":!1,"dubplus-show-timestamp":!1,"dubplus-hide-bg":!1,"dubplus-hide-avatars":!1,"dubplus-chat-only":!1,"dubplus-video-only":!1,warn_redirect:!1,"dubplus-comm-theme":!1,"dubplus-afk":!1,"dubplus-snow":!1,"dubplus-custom-css":!1},custom:{customAfkMessage:"",dj_notification:1,css:""}},V=new(function(){function e(){A(this,e),this.srcRoot="https://cdn.jsdelivr.net/gh/FranciscoG/DubPlus";var t=localStorage.getItem("dubplusUserSettings");if(t)try{var n=JSON.parse(t);this.stored=Object.assign({},H,n)}catch(e){this.stored=H}else this.stored=H}return j(e,[{key:"save",value:function(e,t,n){this.stored[e][t]=n;try{localStorage.setItem("dubplusUserSettings",JSON.stringify(this.stored))}catch(e){console.error("an error occured saving dubplus to localStorage",e)}}}]),e}()),X=function(e){function t(){return A(this,t),q(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return W(t,P),j(t,[{key:"componentDidUpdate",value:function(e){for(var t in e)if(e[t]!==this.props[t])return setTimeout(this.renderLayer)}},{key:"componentDidMount",value:function(){this.isMounted=!0,this.renderLayer=this.renderLayer.bind(this),this.renderLayer()}},{key:"componentWillUnmount",value:function(){this.renderLayer(!1),this.isMounted=!1,this.remote&&this.remote.parentNode.removeChild(this.remote)}},{key:"findNode",value:function(e){return"string"==typeof e?document.querySelector(e):e}},{key:"renderLayer",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.isMounted&&(this.props.into!==this.intoPointer&&(this.intoPointer=this.props.into,this.into&&this.remote&&(this.remote=M(r(J,null),this.into,this.remote)),this.into=this.findNode(this.props.into)),this.remote=M(r(J,{context:this.context},e&&this.props.children||null),this.into,this.remote))}},{key:"render",value:function(){return null}}]),t}(),J=function(e){function t(){return A(this,t),q(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return W(t,P),j(t,[{key:"getChildContext",value:function(){return this.props.context}},{key:"render",value:function(e){var t=e.children;return t&&t[0]||null}}]),t}(),K=function(e){function t(){var e,n,o;A(this,t);for(var r=arguments.length,i=Array(r),s=0;s<r;s++)i[s]=arguments[s];return n=o=q(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.keyUpHandler=function(e){13===e.keyCode&&(o.props.onConfirm(o.textarea.value),o.props.onClose()),27===e.keyCode&&o.props.onClose()},o.confirmClick=function(){o.props.onConfirm(o.textarea.value),o.props.onClose()},q(o,n)}return W(t,P),j(t,[{key:"componentDidMount",value:function(){document.addEventListener("keyup",this.keyUpHandler)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keyup",this.keyUpHandler)}},{key:"render",value:function(e){var t=this,n=e.onConfirm?"cancel":"close";return e.open?r(X,{into:"body"},r("div",{className:"dp-modal"},r("aside",{className:"container"},r("div",{className:"title"},r("h1",null," ",e.title||"Dub+")),r("div",{className:"content"},r("p",null,e.content||""),e.placeholder&&r("textarea",{ref:function(e){return t.textarea=e},placeholder:e.placeholder,maxlength:e.maxlength||999},e.value||"")),r("div",{className:"dp-modal-buttons"},r("button",{id:"dp-modal-cancel",onClick:e.onClose},n),e.onConfirm&&r("button",{id:"dp-modal-confirm",onClick:this.confirmClick},"okay"))))):null}}]),t}(),Q=window.ga||function(){},Z=new(function(){function e(t){A(this,e),Q("create",t,"auto","dubplusTracker")}return j(e,[{key:"event",value:function(e,t,n,o){Q("dubplusTracker.send","event",e,t,n,o)}},{key:"menuClick",value:function(e,t,n){this.event(e,"click",t,n)}}]),e}())("UA-116652541-1"),ee=function(e){function t(){var e,n,o;A(this,t);for(var r=arguments.length,i=Array(r),s=0;s<r;s++)i[s]=arguments[s];return n=o=q(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.state={open:!1},o.loadModal=function(){o.setState({open:!0}),Z.menuClick(o.props.section+" section",o.props.id+" edit")},o.closeModal=function(){console.log("closing dub+ modal"),o.setState({open:!1})},q(o,n)}return W(t,P),j(t,[{key:"render",value:function(e,t){return r("span",{onClick:this.loadModal,className:"fa fa-pencil extra-icon"},r(K,{open:t.open,title:e.title||"Dub+ option",content:e.content||"Please enter a value",placeholder:e.placeholder||"in here",value:e.value,onConfirm:e.onConfirm,onClose:this.closeModal}))}}]),t}(),te=function(e){function t(){var e,n,o;A(this,t);for(var r=arguments.length,i=Array(r),s=0;s<r;s++)i[s]=arguments[s];return n=o=q(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.state={on:V.stored.options[o.props.id]||!1},o.switchOn=function(){o.props.turnOn(),V.save("options",o.props.id,!0),o.setState({on:!0}),Z.menuClick(o.props.section+" section",o.props.id+" on")},o.switchOff=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];o.props.turnOff(),V.save("options",o.props.id,!1),o.setState({on:!1}),e||Z.menuClick(o.props.section+" section",o.props.id+" off")},o.toggleSwitch=function(){o.state.on?o.switchOff():o.switchOn()},q(o,n)}return W(t,P),j(t,[{key:"componentDidMount",value:function(){this.state.on&&this.props.turnOn()}},{key:"render",value:function(e,t){var n=["dubplus-switch"];return t.on&&n.push("dubplus-switch-on"),e.className&&n.push(e.className),r("li",{id:e.id,title:e.desc,className:n.join(" ")},e.children||null,r("div",{onClick:this.toggleSwitch,className:"dubplus-form-control"},r("div",{class:"dubplus-switch-bg"},r("div",{class:"dubplus-switcher"})),r("span",{className:"dubplus-menu-label"},e.menuTitle)))}}]),t}(),ne=function(e){function t(){var e,n,o;A(this,t);for(var r=arguments.length,i=Array(r),s=0;s<r;s++)i[s]=arguments[s];return n=o=q(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.state={canSend:!0},o.afk_chat_respond=function(e){if(o.state.canSend){var t=e.message,n=Dubtrack.session.get("username");if(t.indexOf("@"+n)>-1&&Dubtrack.session.id!==e.user.userInfo.userid){var r=document.getElementById("chat-txt-message");V.stored.custom.customAfkMessage?r.value="[AFK] "+V.stored.custom.customAfkMessage:r.value="[AFK] I'm not here right now.",Dubtrack.room.chat.sendMessage(),o.setState({canSend:!1}),setTimeout(function(){o.setState({canSend:!0})},3e4)}}},q(o,n)}return W(t,P),j(t,[{key:"turnOn",value:function(){Dubtrack.Events.bind("realtime:chat-message",this.afk_chat_respond)}},{key:"turnOff",value:function(){Dubtrack.Events.unbind("realtime:chat-message",this.afk_chat_respond)}},{key:"saveAFKmessage",value:function(e){""!==e&&V.save("custom","customAfkMessage",e)}},{key:"render",value:function(e,t){return r(te,{id:"dubplus-afk",section:"General",menuTitle:"AFK Auto-respond",desc:"Toggle Away from Keyboard and customize AFK message.",turnOn:this.turnOn,turnOff:this.turnOff},r(ee,{title:"Custom AFK Message",section:"General",content:"Enter a custom Away From Keyboard [AFK] message here",value:V.stored.custom.customAfkMessage||"",placeholder:"Be right back!",maxlength:"255",onConfirm:this.saveAFKmessage}))}}]),t}(),oe=function(e){function t(){A(this,t);var e=q(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.advance_vote=function(){var t=document.createEvent("HTMLEvents");t.initEvent("click",!0,!1),e.dubup.dispatchEvent(t)},e.voteCheck=function(t){t.startTime<2&&e.advance_vote()},e.turnOn=function(t){var n=Dubtrack.room.player.activeSong.get("song"),o=Dubtrack.helpers.cookie.get("dub-"+Dubtrack.room.model.get("_id")),r=Dubtrack.helpers.cookie.get("dub-song");Dubtrack.room&&n&&n.songid===r||(o=!1),e.dubup.classList.contains("voted")||e.dubdown.classList.contains("voted")||o||e.advance_vote(),Dubtrack.Events.bind("realtime:room_playlist-update",e.voteCheck)},e.turnOff=function(t){Dubtrack.Events.unbind("realtime:room_playlist-update",e.voteCheck)},e.dubup=document.querySelector(".dubup"),e.dubdown=document.querySelector(".dubdown"),e}return W(t,P),j(t,[{key:"render",value:function(e,t){return r(te,{id:"dubplus-autovote",section:"General",menuTitle:"Autovote",desc:"Toggles auto upvoting for every song",turnOn:this.turnOn,turnOff:this.turnOff})}}]),t}(),re=function(e){function t(){return A(this,t),q(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return W(t,P),j(t,[{key:"componentDidUpdate",value:function(e){for(var t in e)if(e[t]!==this.props[t])return setTimeout(this.renderLayer)}},{key:"componentDidMount",value:function(){this.isMounted=!0,this.renderLayer=this.renderLayer.bind(this),this.renderLayer()}},{key:"componentWillUnmount",value:function(){this.renderLayer(!1),this.isMounted=!1,this.remote&&this.remote.parentNode.removeChild(this.remote)}},{key:"findNode",value:function(e){return"string"==typeof e?document.querySelector(e):e}},{key:"renderLayer",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.isMounted&&(this.props.into!==this.intoPointer&&(this.intoPointer=this.props.into,this.into&&this.remote&&(this.remote=M(r(ie,null),this.into,this.remote)),this.into=this.findNode(this.props.into)),this.remote=M(r(ie,{context:this.context},e&&this.props.children||null),this.into,this.remote))}},{key:"render",value:function(){return null}}]),t}(),ie=function(e){function t(){return A(this,t),q(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return W(t,P),j(t,[{key:"getChildContext",value:function(){return this.props.context}},{key:"render",value:function(e){var t=e.children;return t&&t[0]||null}}]),t}(),se=function(e){function t(){var e,n,o;A(this,t);for(var r=arguments.length,i=Array(r),s=0;s<r;s++)i[s]=arguments[s];return n=o=q(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.state={open:!1},o.turnOn=function(e){},o.turnOff=function(e){},q(o,n)}return W(t,P),j(t,[{key:"componentWillMount",value:function(){this.renderTo=document.querySelector(".pusher-chat-widget-input")}},{key:"render",value:function(e,t){var n=t.open;return r(te,{id:"dubplus-emotes",section:"General",menuTitle:"Autocomplete Emoji",desc:"Quick find and insert emojis and emotes while typing in the chat input",turnOn:this.turnOn,turnOff:this.turnOff},n?r(re,{into:this.renderTo}):null)}}]),t}(),ae=function(e){function t(){var e,n,o;A(this,t);for(var r=arguments.length,i=Array(r),s=0;s<r;s++)i[s]=arguments[s];return n=o=q(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.customMentionCheck=function(e){var t=e.message;if(V.custom.custom_mentions){var n=V.custom.custom_mentions.split(",").some(function(e){return new RegExp("\\b"+e.trim()+"\\b","i").test(t)});Dubtrack.session.id!==e.user.userInfo.userid&&n&&Dubtrack.room.chat.mentionChatSound.play()}},o.saveCustomMentions=function(e){""!==e&&V.save("custom","custom_mentions",e)},q(o,n)}return W(t,P),j(t,[{key:"turnOn",value:function(){Dubtrack.Events.bind("realtime:chat-message",this.customMentionCheck)}},{key:"turnOff",value:function(){Dubtrack.Events.unbind("realtime:chat-message",this.customMentionCheck)}},{key:"render",value:function(e,t){return r(te,{id:"custom_mentions",section:"General",menuTitle:"Custom Mentions",desc:"Toggle using custom mentions to trigger sounds in chat",turnOn:this.turnOn,turnOff:this.turnOff},r(ee,{title:"Custom AFK Message",section:"General",content:"Add your custom mention triggers here (separate by comma)",value:V.stored.custom.custom_mentions||"",placeholder:"separate, custom triggers, by, comma, :heart:",maxlength:"255",onConfirm:this.saveCustomMentions}))}}]),t}(),ue=function(e){function t(){var e,n,o;A(this,t);for(var r=arguments.length,i=Array(r),s=0;s<r;s++)i[s]=arguments[s];return n=o=q(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.chatCleanerCheck=function(e){var t=Array.from(document.querySelectorAll("ul.chat-main > li")),n=parseInt(V.stored.custom.chat_cleaner,10);if(!(isNaN(t.length)||isNaN(n)||!t.length||t.length<n)){var o=t[0].parentElement;t.slice(0,n).forEach(function(e,t){o.removeChild(e)}),$(".chat-messages").perfectScrollbar("update")}},o.saveAmount=function(e){var t=parseInt(e,10),n=isNaN(t)?500:t;V.save("custom","chat_cleaner",n)},o.turnOn=function(){Dubtrack.Events.bind("realtime:chat-message",o.chatCleanerCheck)},o.turnOff=function(){Dubtrack.Events.unbind("realtime:chat-message",o.chatCleanerCheck)},q(o,n)}return W(t,P),j(t,[{key:"render",value:function(){return r(te,{id:"chat-cleaner",section:"General",menuTitle:"Chat Cleaner",desc:"Automatically only keep a designated chatItems of chat items while clearing older ones, keeping CPU stress down",turnOn:this.turnOn,turnOff:this.turnOff},r(ee,{title:"Chat Cleaner",section:"General",content:"Please specify the number of most recent chat items that will remain in your chat history",value:V.stored.custom.chat_cleaner||"",placeholder:"500",maxlength:"5",onConfirm:this.saveAmount}))}}]),t}(),ce=!0,le={denyDismiss:{title:"Desktop Notifications",content:"You have dismissed or chosen to deny the request to allow desktop notifications. Reset this choice by clearing your cache for the site."},noSupport:{title:"Desktop Notifications",content:"Sorry this browser does not support desktop notifications.  Please use the latest version of Chrome or FireFox"}};function de(e){var t="function"==typeof e?e:function(){};return"Notification"in window?"granted"===Notification.permission?t(!0,"granted"):"denied"===Notification.permission?t(!1,le.denyDismiss):void Notification.requestPermission().then(function(e){if("denied"!==e&&"default"!==e)return t(!0,"granted");t(!1,le.denyDismiss)}):t(!1,le.noSupport)}function pe(e){var t=Object.assign({},{title:"New Message",content:"",ignoreActiveTab:!1,callback:null,wait:5e3},e);if(!0!==ce||t.ignoreActiveTab){var n={body:t.content,icon:"https://res.cloudinary.com/hhberclba/image/upload/c_lpad,h_100,w_100/v1400351432/dubtrack_new_logo_fvpxa6.png"},o=new Notification(t.title,n);o.onclick=function(){window.focus(),"function"==typeof t.callback&&t.callback(),o.close()},setTimeout(o.close.bind(o),t.wait)}}window.onfocus=function(){ce=!0},window.onblur=function(){ce=!1};var fe=function(e){function t(){var e,n,o;A(this,t);for(var r=arguments.length,i=Array(r),s=0;s<r;s++)i[s]=arguments[s];return n=o=q(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.state={showWarning:!1,warnTitle:"",warnContent:""},o.turnOn=function(){de(function(e,t){!0===e?Dubtrack.Events.bind("realtime:chat-message",o.notifyOnMention):(o.switchRef.switchOff(!0),o.setState({showWarning:!0,warnTitle:t.title,warnContent:t.content}))})},o.closeModal=function(){o.setState({showWarning:!1})},o.turnOff=function(){Dubtrack.Events.unbind("realtime:chat-message",o.notifyOnMention)},q(o,n)}return W(t,P),j(t,[{key:"notifyOnMention",value:function(e){var t=e.message,n=["@"+Dubtrack.session.get("username").toLowerCase()];V.stored.options.custom_mentions&&V.stored.custom.custom_mentions&&(n=n.concat(V.stored.custom.custom_mentions.split(","))),n.some(function(e){return new RegExp("\\b"+e.trim()+"\\b","i").test(t)})&&!this.isActiveTab&&Dubtrack.session.id!==e.user.userInfo.userid&&pe({title:"Message from "+e.user.username,content:t})}},{key:"render",value:function(e,t){var n=this;return r(te,{ref:function(e){return n.switchRef=e},id:"mention_notifications",section:"General",menuTitle:"Notification on Mentions",desc:"Enable desktop notifications when a user mentions you in chat",turnOn:this.turnOn,turnOff:this.turnOff},r(K,{open:t.showWarning,title:t.warnTitle,content:t.warnContent,onClose:this.closeModal}))}}]),t}(),he=function(e){function t(){var e,n,o;A(this,t);for(var r=arguments.length,i=Array(r),s=0;s<r;s++)i[s]=arguments[s];return n=o=q(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.state={showWarning:!1,warnTitle:"",warnContent:""},o.turnOn=function(){de(function(e,t){!0===e?Dubtrack.Events.bind("realtime:new-message",o.notify):(o.switchRef.switchOff(!0),o.setState({showWarning:!0,warnTitle:t.title,warnContent:t.content}))})},o.closeModal=function(){o.setState({showWarning:!1})},o.turnOff=function(){Dubtrack.Events.unbind("realtime:new-message",o.notify)},q(o,n)}return W(t,P),j(t,[{key:"notify",value:function(e){Dubtrack.session.get("_id")!==e.userid&&pe({title:"You have a new PM",ignoreActiveTab:!0,callback:function(){document.querySelector(".user-messages").click(),setTimeout(function(){document.querySelector('.message-item[data-messageid="'+e.messageid+'"]').click()},500)},wait:1e4})}},{key:"render",value:function(e,t){var n=this;return r(te,{ref:function(e){return n.switchRef=e},id:"dubplus_pm_notifications",section:"General",menuTitle:"Notification on PM",desc:"Enable desktop notifications when a user receives a private message",turnOn:this.turnOn,turnOff:this.turnOff},r(K,{open:t.showWarning,title:t.warnTitle,content:t.warnContent,onClose:this.closeModal}))}}]),t}(),me=function(e){function t(){var e,n,o;A(this,t);for(var r=arguments.length,i=Array(r),s=0;s<r;s++)i[s]=arguments[s];return n=o=q(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.state={canNotify:!1},o.savePosition=function(e){var t=parseInt(e,10),n=isNaN(t)?2:t;V.save("custom","dj_notification",n)},o.djNotificationCheck=function(e){if(!(e.startTime>2)){var t=document.querySelector(".queue-position").textContent,n=parseInt(t,10),r=e.startTime<0&&!isNaN(n)?n-1:n;isNaN(n)||r!==V.stored.custom.dj_notification||(o.canNotify&&pe({title:"DJ Alert!",content:"You will be DJing shortly! Make sure your song is set!",ignoreActiveTab:!0,wait:1e4}),Dubtrack.room.chat.mentionChatSound.play())}},o.turnOn=function(){de(function(e,t){!0===e&&o.setState({canNotify:!0})}),Dubtrack.Events.bind("realtime:room_playlist-update",o.djNotificationCheck)},o.turnOff=function(){Dubtrack.Events.unbind("realtime:room_playlist-update",o.djNotificationCheck)},q(o,n)}return W(t,P),j(t,[{key:"render",value:function(e,t){var n=this;return r(te,{ref:function(e){return n.switchRef=e},id:"dj-notification",section:"General",menuTitle:"DJ Notification",desc:"Notification when you are coming up to be the DJ",turnOn:this.turnOn,turnOff:this.turnOff},r(MenuPencil,{title:"DJ Notification",section:"General",content:"Please specify the position in queue you want to be notified at",value:V.stored.custom.dj_notification||"",placeholder:"2",maxlength:"2",onConfirm:this.savePosition}))}}]),t}();function be(e,t){var n=document.createElement("script"),o=document.getElementsByTagName("script")[0];n.async=1,n.onload=n.onreadystatechange=function(e,o){(o||!n.readyState||/loaded|complete/.test(n.readyState))&&(n.onload=n.onreadystatechange=null,n=void 0,o||t&&t())},n.onerror=function(e){t&&t(e)},n.src=e,o.parentNode.insertBefore(n,o)}var ve=function(e){function t(){var e,n,o;A(this,t);for(var r=arguments.length,i=Array(r),s=0;s<r;s++)i[s]=arguments[s];return n=o=q(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.turnOn=function(){$.snowfall?o.doSnow():be("https://cdn.jsdelivr.net/gh/loktar00/JQuery-Snowfall/src/snowfall.jquery.js",function(e){if(e)return o.switchRef.switchOff(!0),void console.error("Could not load snowfall jquery plugin",e);o.doSnow()})},q(o,n)}return W(t,P),j(t,[{key:"doSnow",value:function(){$(document).snowfall({round:!0,shadow:!0,flakeCount:50,minSize:1,maxSize:5,minSpeed:5,maxSpeed:5})}},{key:"turnOff",value:function(){$.snowfall&&$(document).snowfall("clear")}},{key:"render",value:function(){var e=this;return r(te,{ref:function(t){return e.switchRef=t},id:"dubplus-snow",section:"General",menuTitle:"Snow",desc:"Make it snow!",turnOn:this.turnOn,turnOff:this.turnOff})}}]),t}(),ye={particles:[],drops:[],numbase:5,numb:2,height:0,controls:{rain:2,alpha:1,color:200,opacity:1,saturation:100,lightness:50,back:0,multi:!1,speed:1},init:function(){var e=document.createElement("canvas");e.id="dubPlusRainCanvas",e.style.cssText="position : fixed; top : 0px; left : 0px; z-index: 100; pointer-events:none;",document.body.insertBefore(e,document.body.childNodes[0]),this.bindCanvas()},destroy:function(){document.body.removeChild(document.getElementById("dubPlusRainCanvas")),this.unbindCanvas()},bindCanvas:function(){this.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)};var e=document.getElementById("dubPlusRainCanvas");if(e){var t=e.getContext("2d");this.width,this.height=0,window.onresize=function(){this.width=e.width=window.innerWidth,this.height=e.height=window.innerHeight},window.onresize(),this.particles,this.drops=[],this.numbase=5,this.numb=2;var n=this;!function e(){n.requestAnimFrame(e),n.update(),n.rendu(t)}()}},buildRainParticle:function(e,t,n){for(n||(n=this.numb);n--;)this.particles.push({speedX:.25*Math.random(),speedY:9*Math.random()+1,X:e,Y:t,alpha:1,color:"hsla("+this.controls.color+","+this.controls.saturation+"%, "+this.controls.lightness+"%,"+this.controls.opacity+")"})},explosion:function(e,t,n,o){for(o||(o=this.numbase);o--;)this.drops.push({speedX:4*Math.random()-2,speedY:-4*Math.random(),X:e,Y:t,radius:.65+Math.floor(1.6*Math.random()),alpha:1,color:n})},rendu:function(e){1==this.controls.multi&&(this.controls.color=360*Math.random()),e.save(),e.clearRect(0,0,width,height);for(var t,n=this.particles,o=this.drops,r=2*Math.PI,i=0;t=n[i];i++)e.globalAlpha=t.alpha,e.fillStyle=t.color,e.fillRect(t.X,t.Y,t.speedY/4,t.speedY);var s;for(i=0;s=o[i];i++)e.globalAlpha=s.alpha,e.fillStyle=s.color,e.beginPath(),e.arc(s.X,s.Y,s.radius,0,r),e.fill();e.strokeStyle="white",e.lineWidth=2,e.restore()},update:function(){for(var e,t=this.particles,n=this.drops,o=0;e=t[o];o++)e.X+=e.speedX,e.Y+=e.speedY+5,e.Y>height-15&&(t.splice(o--,1),this.explosion(e.X,e.Y,e.color));var r;for(o=0;r=n[o];o++)r.X+=r.speedX,r.Y+=r.speedY,r.radius-=.075,r.alpha>0?r.alpha-=.005:r.alpha=0,r.radius<0&&n.splice(o--,1);for(o=this.controls.rain;o--;)this.buildRainParticle(Math.floor(Math.random()*width),-15)},unbindCanvas:function(){this.requestAnimFrame=function(){}}},ge=function(e){function t(){return A(this,t),q(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return W(t,P),j(t,[{key:"turnOn",value:function(){ye.init()}},{key:"turnOff",value:function(){ye.destroy()}},{key:"render",value:function(e,t){return r(te,{id:"dubplus-rain",section:"General",menuTitle:"Rain",desc:"Make it rain!",turnOn:this.turnOn,turnOff:this.turnOff})}}]),t}();function _e(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(n,o){var r=new XMLHttpRequest;for(var i in t)t.hasOwnProperty(i)&&r.setRequestHeader(i,t[i]);r.onload=function(){var e=r.responseText;n(e)},r.onerror=function(){o()},r.open("GET",e),r.send()})}function ke(e){return Dubtrack.helpers.isDubtrackAdmin(e)||Dubtrack.room.users.getIfOwner(e)||Dubtrack.room.users.getIfManager(e)||Dubtrack.room.users.getIfMod(e)}var we=function(e){function t(){var e,n,o;A(this,t);for(var r=arguments.length,i=Array(r),s=0;s<r;s++)i[s]=arguments[s];return n=o=q(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.state={bgColor:"auto"},q(o,n)}return W(t,P),j(t,[{key:"getBgColor",value:function(e){var t=void 0;if("up"===e)t=document.querySelector(".dubup");else{if("down"!==e)return;t=document.querySelector(".dubdown")}var n=t.classList.contains("voted")?window.getComputedStyle(t).backgroundColor:window.getComputedStyle(t.querySelector(".icon-"+e+"vote")).color;this.setState({bgColor:n})}},{key:"updateChat",value:function(e){var t=document.getElementById("chat-txt-message");t.value=e,t.focus()}},{key:"render",value:function(e){var t=this,n=e.type,o=e.dubs,i=e.into;if(!e.show)return null;var s=o.map(function(e){return r("li",{onClick:function(){return t.updateChat("@"+e.username+" ")},class:"preview-dubinfo-item users-previews dubplus-"+n+"-hover"},r("div",{class:"dubinfo-image"},r("img",{src:"https://api.dubtrack.fm/user/"+e.userID+"/image"})),r("span",{class:"dubinfo-text"},"@",e.username))}),a=["dubinfo-show","dubplus-"+n+"-container"];0===s.length&&a.push("dubinfo-no-dubs");var u="No "+n+" have been casted yet!";return"grabs"===n&&(u="This song hasn't been grabbed yet!"),r(re,{into:i},r("ul",{id:"dubinfo-preview",syle:{backgroundColor:this.getBgColor(n.replace("dubs",""))},class:a.join(" ")},s.length>0?s:r("li",null,u)))}}]),t}(),Oe=function(e){function t(){var e,n,o;A(this,t);for(var r=arguments.length,i=Array(r),s=0;s<r;s++)i[s]=arguments[s];return n=o=q(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.state={showWarning:!1,warned:!1,upDubs:[],downDubs:[],grabs:[],isOn:!1},o.turnOn=function(){o.state.warned||o.setState({showWarning:!0,warned:!0}),o.begin(),o.setState({isOn:!0})},o.closeModal=function(){o.setState({showWarning:!1})},o.dubWatcher=function(e){var t=[],n=o.state.upDubs.filter(function(n){var o=n.userid!==e.user._id;return o||t.push(n),o}),r=[],i=o.state.upDubs.filter(function(t){var n=t.userid!==e.user._id;return n||r.push(t),n});"updub"===e.dubtype?(t.length<=0&&o.setState(function(t){return{upDubs:[].concat(R(t.upDubs)).push({userid:e.user._id,username:e.user.username})}}),o.setState({downDubs:i})):"downdub"===e.dubtype&&(r.length<=0&&ke(Dubtrack.session.id)&&o.setState(function(t){return{downDubs:[].concat(R(t.downDubs)).push({userid:e.user._id,username:e.user.username})}}),o.setState({upDubs:n})),new Date-new Date(Dubtrack.room.player.activeSong.attributes.song.played)<1e3||(o.state.upDubs.length!==Dubtrack.room.player.activeSong.attributes.song.updubs?o.resetDubs():ke(Dubtrack.session.id)&&o.state.downDubs.length!==Dubtrack.room.player.activeSong.attributes.song.downdubs&&o.resetDubs())},o.grabWatcher=function(e){o.state.grabs.filter(function(t){return t.userid===e.user._id}).length<=0&&o.setState(function(t){return{grabs:[].concat(R(t.grabs)).push({userid:e.user._id,username:e.user.username})}})},o.dubUserLeaveWatcher=function(e){var t=o.state.upDubs.filter(function(t){return t.userid!==e.user._id}),n=o.state.downDubs.filter(function(t){return t.userid!==e.user._id}),r=o.state.grabs.filter(function(t){return t.userid!==e.user._id});o.setState({upDubs:t,downDubs:n,grabs:r})},o.handleReset=function(){var e=[],t=[];_e("https://api.dubtrack.fm/room/"+Dubtrack.room.model.id+"/playlist/active/dubs").then(function(n){var r=JSON.parse(n);r.upDubs.forEach(function(t){if(!(o.state.upDubs.filter(function(e){return e.userid===t.userid}).length>0))if(Dubtrack.room.users.collection.findWhere({userid:t.userid})&&Dubtrack.room.users.collection.findWhere({userid:t.userid}).attributes){var n=Dubtrack.room.users.collection.findWhere({userid:t.userid}).attributes._user.username;n&&e.push({userid:t.userid,username:n})}else{_e("https://api.dubtrack.fm/user/"+t.userid).then(function(n){var o=JSON.parse(n);if(o&&o.userinfo&&o.userinfo.username){var r=o.userinfo.username;e.push({userid:t.userid,username:r})}})}}),o.setState(function(t){return{upDubs:t.upDubs.concat(e)}}),ke(Dubtrack.session.id)&&(r.downDubs.forEach(function(e){if(!(this.state.downDubs.filter(function(t){return t.userid===e.userid}).length>0))if(Dubtrack.room.users.collection.findWhere({userid:e.userid})&&Dubtrack.room.users.collection.findWhere({userid:e.userid}).attributes){var n=Dubtrack.room.users.collection.findWhere({userid:e.userid}).attributes._user.username;n&&t.push({userid:e.userid,username:n})}else{_e("https://api.dubtrack.fm/user/"+e.userid).then(function(n){var o=JSON.parse(n);if(o&&o.userinfo&&o.userinfo.username){var r=o.userinfo.username;t.push({userid:e.userid,username:r})}})}}),o.setState(function(e){return{upDubs:e.downDubs.concat(t)}}))})},o.resetDubs=function(){o.setState({upDubs:[],downDubs:[]},o.handleReset)},q(o,n)}return W(t,P),j(t,[{key:"turnOff",value:function(){this.setState({isOn:!1}),Dubtrack.Events.unbind("realtime:room_playlist-dub",this.dubWatcher),Dubtrack.Events.unbind("realtime:room_playlist-queue-update-grabs",this.grabWatcher),Dubtrack.Events.unbind("realtime:user-leave",this.dubUserLeaveWatcher),Dubtrack.Events.unbind("realtime:room_playlist-update",this.resetDubs),Dubtrack.Events.unbind("realtime:room_playlist-update",this.resetGrabs)}},{key:"begin",value:function(){this.resetDubs(),Dubtrack.Events.bind("realtime:room_playlist-dub",this.dubWatcher),Dubtrack.Events.bind("realtime:room_playlist-queue-update-grabs",this.grabWatcher),Dubtrack.Events.bind("realtime:user-leave",this.dubUserLeaveWatcher),Dubtrack.Events.bind("realtime:room_playlist-update",this.resetDubs),Dubtrack.Events.bind("realtime:room_playlist-update",this.resetGrabs)}},{key:"render",value:function(){return r(te,{id:"dubplus-dubs-hover",section:"General",menuTitle:"Show Dub info on Hover",desc:"Show Dub info on Hover.",turnOn:this.turnOn,turnOff:this.turnOff},r(K,{open:state.showWarning,title:"Grab Vote Info",content:"Please note that this feature is currently still in development. We are waiting on the ability to pull grab vote information from Dubtrack on load. Until then the only grabs you will be able to see are those you are present in the room for.",onClose:this.closeModal}),r(we,{show:this.isOn,into:".dubpus-updubs-hover",type:"updubs",dubs:this.state.upDubs}),r(we,{show:this.isOn,into:".dubpus-downdubs-hover",type:"downdubs",dubs:this.state.downDubs}),r(we,{show:this.isOn,into:".dubpus-grabs-hover",type:"grabs",dubs:this.state.grabs}))}}]),t}();var De=function(e){function t(){return A(this,t),q(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return W(t,P),j(t,[{key:"turnOn",value:function(){ke(Dubtrack.session.id)&&Dubtrack.Events.bind("realtime:room_playlist-dub",this.downdubWatcher)}},{key:"turnOff",value:function(){Dubtrack.Events.unbind("realtime:room_playlist-dub",this.downdubWatcher)}},{key:"downdubWatcher",value:function(e){if(Dubtrack.session.get("username")===Dubtrack.room.users.collection.findWhere({userid:Dubtrack.room.player.activeSong.attributes.song.userid}).attributes._user.username&&"downdub"===e.dubtype){var t=function(e,t){var n=document.createElement("li");n.className="dubplus-chat-system dubplus-chat-system-downdub";var o=document.createElement("div");o.className="chatDelete",o.onclick=function(e){return e.currentTarget.parentElement.remove()};var r=document.createElement("span");r.className="icon-close";var i=document.createElement("div");return i.className="text",i.textContent="@"+e+" has downdubbed your song "+t,o.appendChild(r),n.appendChild(o),n.appendChild(i),n}(e.user.username,Dubtrack.room.player.activeSong.attributes.songInfo.name);document.querySelector("ul.chat-main").appendChild(t)}}},{key:"render",value:function(){return r(te,{id:"dubplus-downdubs",section:"General",menuTitle:"Downdubs in Chat (mods only)",desc:"Toggle showing downdubs in the chat box (mods only)",turnOn:this.turnOn,turnOff:this.turnOff})}}]),t}();var Ce=function(e){function t(){return A(this,t),q(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return W(t,P),j(t,[{key:"turnOn",value:function(){Dubtrack.Events.bind("realtime:room_playlist-dub",this.updubWatcher)}},{key:"turnOff",value:function(){Dubtrack.Events.unbind("realtime:room_playlist-dub",this.updubWatcher)}},{key:"updubWatcher",value:function(e){if(Dubtrack.session.get("username")===Dubtrack.room.users.collection.findWhere({userid:Dubtrack.room.player.activeSong.attributes.song.userid}).attributes._user.username&&"updub"===e.dubtype){var t=function(e,t){var n=document.createElement("li");n.className="dubplus-chat-system dubplus-chat-system-updub";var o=document.createElement("div");o.className="chatDelete",o.onclick=function(e){return e.currentTarget.parentElement.remove()};var r=document.createElement("span");r.className="icon-close";var i=document.createElement("div");return i.className="text",i.textContent="@"+e+" has updubbed your song "+t,o.appendChild(r),n.appendChild(o),n.appendChild(i),n}(e.user.username,Dubtrack.room.player.activeSong.attributes.songInfo.name);document.querySelector("ul.chat-main").appendChild(t)}}},{key:"render",value:function(){return r(te,{id:"dubplus-updubs",section:"General",menuTitle:"Updubs in Chat",desc:"Toggle showing updubs in the chat box",turnOn:this.turnOn,turnOff:this.turnOff})}}]),t}();var Se=function(e){function t(){return A(this,t),q(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return W(t,P),j(t,[{key:"turnOn",value:function(){Dubtrack.Events.bind("realtime:room_playlist-queue-update-grabs",this.grabChatWatcher)}},{key:"turnOff",value:function(){Dubtrack.Events.unbind("realtime:room_playlist-queue-update-grabs",this.grabChatWatcher)}},{key:"grabChatWatcher",value:function(e){if(Dubtrack.session.get("username")===Dubtrack.room.users.collection.findWhere({userid:Dubtrack.room.player.activeSong.attributes.song.userid}).attributes._user.username&&!Dubtrack.room.model.get("displayUserGrab")){var t=function(e,t){var n=document.createElement("li");n.className="dubplus-chat-system dubplus-chat-system-grab";var o=document.createElement("div");o.className="chatDelete",o.onclick=function(e){return e.currentTarget.parentElement.remove()};var r=document.createElement("span");r.className="icon-close";var i=document.createElement("div");return i.className="text",i.textContent="@"+e+" has grabbed your song "+t,o.appendChild(r),n.appendChild(o),n.appendChild(i),n}(e.user.username,Dubtrack.room.player.activeSong.attributes.songInfo.name);document.querySelector("ul.chat-main").appendChild(t)}}},{key:"render",value:function(){return r(te,{id:"dubplus-grabschat",section:"General",menuTitle:"Grabs in Chat",desc:"Toggle showing grabs in the chat box",turnOn:this.turnOn,turnOff:this.turnOff})}}]),t}(),xe=function(e){function t(){var e,n,o;A(this,t);for(var r=arguments.length,i=Array(r),s=0;s<r;s++)i[s]=arguments[s];return n=o=q(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.state={section:V.stored.general||"open"},o.toggleSection=function(e){o.setState(function(e){var t="open"===e.section?"closed":"open";return V.save("menu","general",t),{section:t}})},q(o,n)}return W(t,P),j(t,[{key:"render",value:function(e,t){var n=["dubplus-menu-section"];return"closed"===t.section&&n.push("dubplus-menu-section-closed"),r("span",null,r(Y,{onClick:this.toggleSection,id:"dubplus-general",category:"General",open:t.section}),r("ul",{className:n.join(" ")},r(oe,null),r(ne,null),r(se,null),r(ae,null),r(ue,null),r(fe,null),r(he,null),r(me,null),r(Oe,null),r(De,null),r(Ce,null),r(Se,null),r(ve,null),r(ge,null)))}}]),t}(),Ne=function(e){function t(){return A(this,t),q(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return W(t,P),j(t,[{key:"componentDidMount",value:function(){setTimeout(function(){M(r(F,null),document.querySelector(".player_sharing")),M(r(B,null),document.querySelector(".player_sharing"))},10)}},{key:"render",value:function(e,t){return r("section",{className:"dubplus-menu"},r("p",{className:"dubplus-menu-header"},"Dub+ Options"),r(xe,null))}}]),t}();function Ee(e,t){for(var n=e.split("."),o=n.length,r=t||window,i=0;i<o;i++){if(void 0===r[n[i]])return!1;r=r[n[i]]}return!0}function Te(e,t){for(var n=e.length,o=t||window,r=0;r<n;r++)if(!Ee(e[r],o))return console.log(e[r],"is not found yet"),!1;return!0}var Pe={fontFamily:"'Trebuchet MS', Helvetica, sans-serif",zIndex:"2147483647",color:"white",position:"fixed",top:"69px",right:"-250px",background:"#222",padding:"10px",lineHeight:1,boxShadow:"0px 0px 5px 0px rgba(0,0,0,0.75)",borderRadius:"5px",overflow:"hidden",width:"230px",transition:"right 200ms"},Me={float:"left",width:"26px",marginRight:"5px"},Ae={display:"table-cell",width:"10000px",paddingTop:"5px"},je=function(e){function t(){var e,n,o;A(this,t);for(var r=arguments.length,i=Array(r),s=0;s<r;s++)i[s]=arguments[s];return n=o=q(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.state={mainStyles:Pe},q(o,n)}return W(t,P),j(t,[{key:"componentDidMount",value:function(){var e=this;setTimeout(function(){e.setState(function(e,t){return{mainStyles:Object.assign({},e.mainStyles,{right:"13px"})}})},200)}},{key:"componentWillUnmount",value:function(){this.setState(function(e,t){return{mainStyles:Object.assign({},e.mainStyles,{right:"-250px"})}})}},{key:"render",value:function(e,t){return r("div",{style:t.mainStyles},r("div",{style:Me},r("img",{src:V.srcRoot+"/images/dubplus.svg",alt:"DubPlus icon"})),r("span",{style:Ae},e.text||"Waiting for Dubtrack..."))}}]),t}(),We=function(e,t){var n=document.createElement("link");return n.rel="stylesheet",n.type="text/css",n.className=e||"",n.href=t,n};var qe={load:function(e,t){if(e){var n=We(t,V.srcRoot+e+"?1548135553711");document.head.appendChild(n)}},loadExternal:function(e,t){if(e){var n=We(t,e);document.head.appendChild(n)}}},Re=function(e){function t(){var e,n,o;A(this,t);for(var r=arguments.length,i=Array(r),s=0;s<r;s++)i[s]=arguments[s];return n=o=q(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.state={open:!1},o.toggle=function(){var e=document.querySelector(".dubplus-menu");o.state.open?(e.classList.add("dubplus-menu-open"),o.setState({open:!1})):(e.classList.remove("dubplus-menu-open"),o.setState({open:!0}))},q(o,n)}return W(t,P),j(t,[{key:"render",value:function(e,t){return r("div",{className:"dubplus-icon",onClick:this.toggle},r("img",{src:V.srcRoot+"/images/dubplus.svg",alt:"DubPlus Icon"}))}}]),t}();[Element.prototype,CharacterData.prototype,DocumentType.prototype].forEach(function(e){e.hasOwnProperty("remove")||Object.defineProperty(e,"remove",{configurable:!0,enumerable:!0,writable:!0,value:function(){null!==this.parentNode&&this.parentNode.removeChild(this)}})}),setTimeout(function(){qe.load("/css/dubplus.css"),qe.loadExternal("https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"),"undefined"==typeof Promise&&be("https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.auto.min.js")},1),M(r(function(e){function t(){var e,n,o;A(this,t);for(var r=arguments.length,i=Array(r),s=0;s<r;s++)i[s]=arguments[s];return n=o=q(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.state={loading:!0,error:!1,errorMsg:"",failed:!1},q(o,n)}return W(t,P),j(t,[{key:"componentDidMount",value:function(){var e=this;if(window.DubPlus)Dubtrack.session.id?this.showError("Dub+ is already loaded"):this.showError("You're not logged in. Please login to use Dub+.");else{new function(e,t){if("string"==typeof e||Array.isArray(e)){var n=function(){},o=function(){},r=Array.isArray(e)?Te:Ee,i=Object.assign({},{interval:500,seconds:15},t),s=0,a=1e3*i.seconds/i.interval,u=function t(){return s++,r(e)?n():s<a?void window.setTimeout(t,i.interval):o()};return{then:function(e){return"function"==typeof e&&(n=e),window.setTimeout(u,i.interval),this},fail:function(e){return"function"==typeof e&&(o=e),this}}}console.warn("WaitFor: invalid first argument")}(["Dubtrack.session.id","Dubtrack.room.chat","Dubtrack.Events","Dubtrack.room.player","Dubtrack.helpers.cookie","Dubtrack.room.model","Dubtrack.room.users"],{seconds:120}).then(function(){e.setState({loading:!1,error:!1})}).fail(function(){Dubtrack.session.id?(e.showError("Something happed, refresh and try again"),Z.event("Dub+ lib","load","failed")):e.showError("You're not logged in. Please login to use Dub+.")})}}},{key:"showError",value:function(e){this.setState({loading:!1,error:!0,errorMsg:e})}},{key:"render",value:function(e,t){var n=this;return t.loading?r(je,null):t.error?r(K,{title:"Dub+ Error",onClose:function(){n.setState({failed:!0,error:!1})},content:t.errorMsg}):t.failed?null:r(Ne,null)}}]),t}(),null),document.body),M(r(Re,null),document.querySelector(".header-right-navigation"));return{version:"0.1.8",description:"Dub+ - A simple script/extension for Dubtrack.fm",license:"MIT",bugs:"https://github.com/DubPlus/DubPlus/issues"}}();
