
/*
     /$$$$$$$            /$$                
    | $$__  $$          | $$          /$$   
    | $$  | $$ /$$   /$$| $$$$$$$    | $$   
    | $$  | $$| $$  | $$| $$__  $$ /$$$$$$$$
    | $$  | $$| $$  | $$| $$  | $$|__  $$__/
    | $$  | $$| $$  | $$| $$  | $$   | $$   
    | $$$$$$$/|  $$$$$$/| $$$$$$$/   |__/   
    |_______/  ______/ |_______/           
                                            
                                            
    https://github.com/DubPlus/DubPlus

    This source code is licensed under the MIT license 
    found here: https://github.com/DubPlus/DubPlus/blob/master/LICENSE

    Copyright (c) 2017-present DubPlus

    more info at https://dub.plus
*/
var DubPlus=function(){"use strict";var t=function(){},e={},n=[],o=[];function r(e,r){var i,s,a,u,l=o;for(u=arguments.length;u-- >2;)n.push(arguments[u]);for(r&&null!=r.children&&(n.length||n.push(r.children),delete r.children);n.length;)if((s=n.pop())&&void 0!==s.pop)for(u=s.length;u--;)n.push(s[u]);else"boolean"==typeof s&&(s=null),(a="function"!=typeof e)&&(null==s?s="":"number"==typeof s?s=String(s):"string"!=typeof s&&(a=!1)),a&&i?l[l.length-1]+=s:l===o?l=[s]:l.push(s),i=a;var c=new t;return c.nodeName=e,c.children=l,c.attributes=null==r?void 0:r,c.key=null==r?void 0:r.key,c}function i(t,e){for(var n in e)t[n]=e[n];return t}var s="function"==typeof Promise?Promise.resolve().then.bind(Promise.resolve()):setTimeout,a=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,u=[];function l(t){!t._dirty&&(t._dirty=!0)&&1==u.push(t)&&s(c)}function c(){var t,e=u;for(u=[];t=e.pop();)t._dirty&&M(t)}function d(t,e){return t.normalizedNodeName===e||t.nodeName.toLowerCase()===e.toLowerCase()}function p(t){var e=i({},t.attributes);e.children=t.children;var n=t.nodeName.defaultProps;if(void 0!==n)for(var o in n)void 0===e[o]&&(e[o]=n[o]);return e}function f(t){var e=t.parentNode;e&&e.removeChild(t)}function h(t,e,n,o,r){if("className"===e&&(e="class"),"key"===e);else if("ref"===e)n&&n(null),o&&o(t);else if("class"!==e||r)if("style"===e){if(o&&"string"!=typeof o&&"string"!=typeof n||(t.style.cssText=o||""),o&&"object"==typeof o){if("string"!=typeof n)for(var i in n)i in o||(t.style[i]="");for(var i in o)t.style[i]="number"==typeof o[i]&&!1===a.test(i)?o[i]+"px":o[i]}}else if("dangerouslySetInnerHTML"===e)o&&(t.innerHTML=o.__html||"");else if("o"==e[0]&&"n"==e[1]){var s=e!==(e=e.replace(/Capture$/,""));e=e.toLowerCase().substring(2),o?n||t.addEventListener(e,m,s):t.removeEventListener(e,m,s),(t._listeners||(t._listeners={}))[e]=o}else if("list"!==e&&"type"!==e&&!r&&e in t){try{t[e]=null==o?"":o}catch(t){}null!=o&&!1!==o||"spellcheck"==e||t.removeAttribute(e)}else{var u=r&&e!==(e=e.replace(/^xlink:?/,""));null==o||!1===o?u?t.removeAttributeNS("http://www.w3.org/1999/xlink",e.toLowerCase()):t.removeAttribute(e):"function"!=typeof o&&(u?t.setAttributeNS("http://www.w3.org/1999/xlink",e.toLowerCase(),o):t.setAttribute(e,o))}else t.className=o||""}function m(t){return this._listeners[t.type](t)}var v=[],y=0,b=!1,g=!1;function _(){for(var t;t=v.pop();)t.componentDidMount&&t.componentDidMount()}function k(t,e,n,o,r,i){y++||(b=null!=r&&void 0!==r.ownerSVGElement,g=null!=t&&!("__preactattr_"in t));var s=w(t,e,n,o,i);return r&&s.parentNode!==r&&r.appendChild(s),--y||(g=!1,i||_()),s}function w(t,e,n,o,r){var i=t,s=b;if(null!=e&&"boolean"!=typeof e||(e=""),"string"==typeof e||"number"==typeof e)return t&&void 0!==t.splitText&&t.parentNode&&(!t._component||r)?t.nodeValue!=e&&(t.nodeValue=e):(i=document.createTextNode(e),t&&(t.parentNode&&t.parentNode.replaceChild(i,t),O(t,!0))),i.__preactattr_=!0,i;var a,u,l=e.nodeName;if("function"==typeof l)return function(t,e,n,o){var r=t&&t._component,i=r,s=t,a=r&&t._componentConstructor===e.nodeName,u=a,l=p(e);for(;r&&!u&&(r=r._parentComponent);)u=r.constructor===e.nodeName;r&&u&&(!o||r._component)?(N(r,l,3,n,o),t=r.base):(i&&!a&&(T(i),t=s=null),r=S(e.nodeName,l,n),t&&!r.nextBase&&(r.nextBase=t,s=null),N(r,l,1,n,o),t=r.base,s&&t!==s&&(s._component=null,O(s,!1)));return t}(t,e,n,o);if(b="svg"===l||"foreignObject"!==l&&b,l=String(l),(!t||!d(t,l))&&(a=l,(u=b?document.createElementNS("http://www.w3.org/2000/svg",a):document.createElement(a)).normalizedNodeName=a,i=u,t)){for(;t.firstChild;)i.appendChild(t.firstChild);t.parentNode&&t.parentNode.replaceChild(i,t),O(t,!0)}var c=i.firstChild,m=i.__preactattr_,v=e.children;if(null==m){m=i.__preactattr_={};for(var y=i.attributes,_=y.length;_--;)m[y[_].name]=y[_].value}return!g&&v&&1===v.length&&"string"==typeof v[0]&&null!=c&&void 0!==c.splitText&&null==c.nextSibling?c.nodeValue!=v[0]&&(c.nodeValue=v[0]):(v&&v.length||null!=c)&&function(t,e,n,o,r){var i,s,a,u,l,c=t.childNodes,p=[],h={},m=0,v=0,y=c.length,b=0,g=e?e.length:0;if(0!==y)for(var _=0;_<y;_++){var k=c[_],C=k.__preactattr_,x=g&&C?k._component?k._component.__key:C.key:null;null!=x?(m++,h[x]=k):(C||(void 0!==k.splitText?!r||k.nodeValue.trim():r))&&(p[b++]=k)}if(0!==g)for(var _=0;_<g;_++){u=e[_],l=null;var x=u.key;if(null!=x)m&&void 0!==h[x]&&(l=h[x],h[x]=void 0,m--);else if(v<b)for(i=v;i<b;i++)if(void 0!==p[i]&&(S=s=p[i],N=r,"string"==typeof(D=u)||"number"==typeof D?void 0!==S.splitText:"string"==typeof D.nodeName?!S._componentConstructor&&d(S,D.nodeName):N||S._componentConstructor===D.nodeName)){l=s,p[i]=void 0,i===b-1&&b--,i===v&&v++;break}l=w(l,u,n,o),a=c[_],l&&l!==t&&l!==a&&(null==a?t.appendChild(l):l===a.nextSibling?f(a):t.insertBefore(l,a))}var S,D,N;if(m)for(var _ in h)void 0!==h[_]&&O(h[_],!1);for(;v<=b;)void 0!==(l=p[b--])&&O(l,!1)}(i,v,n,o,g||null!=m.dangerouslySetInnerHTML),function(t,e,n){var o;for(o in n)e&&null!=e[o]||null==n[o]||h(t,o,n[o],n[o]=void 0,b);for(o in e)"children"===o||"innerHTML"===o||o in n&&e[o]===("value"===o||"checked"===o?t[o]:n[o])||h(t,o,n[o],n[o]=e[o],b)}(i,e.attributes,m),b=s,i}function O(t,e){var n=t._component;n?T(n):(null!=t.__preactattr_&&t.__preactattr_.ref&&t.__preactattr_.ref(null),!1!==e&&null!=t.__preactattr_||f(t),C(t))}function C(t){for(t=t.lastChild;t;){var e=t.previousSibling;O(t,!0),t=e}}var x=[];function S(t,e,n){var o,r=x.length;for(t.prototype&&t.prototype.render?(o=new t(e,n),A.call(o,e,n)):((o=new A(e,n)).constructor=t,o.render=D);r--;)if(x[r].constructor===t)return o.nextBase=x[r].nextBase,x.splice(r,1),o;return o}function D(t,e,n){return this.constructor(t,n)}function N(t,n,o,r,i){t._disable||(t._disable=!0,t.__ref=n.ref,t.__key=n.key,delete n.ref,delete n.key,void 0===t.constructor.getDerivedStateFromProps&&(!t.base||i?t.componentWillMount&&t.componentWillMount():t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r)),r&&r!==t.context&&(t.prevContext||(t.prevContext=t.context),t.context=r),t.prevProps||(t.prevProps=t.props),t.props=n,t._disable=!1,0!==o&&(1!==o&&!1===e.syncComponentUpdates&&t.base?l(t):M(t,1,i)),t.__ref&&t.__ref(t))}function M(t,e,n,o){if(!t._disable){var r,s,a,u=t.props,l=t.state,c=t.context,d=t.prevProps||u,f=t.prevState||l,h=t.prevContext||c,m=t.base,b=t.nextBase,g=m||b,w=t._component,C=!1,x=h;if(t.constructor.getDerivedStateFromProps&&(l=i(i({},l),t.constructor.getDerivedStateFromProps(u,l)),t.state=l),m&&(t.props=d,t.state=f,t.context=h,2!==e&&t.shouldComponentUpdate&&!1===t.shouldComponentUpdate(u,l,c)?C=!0:t.componentWillUpdate&&t.componentWillUpdate(u,l,c),t.props=u,t.state=l,t.context=c),t.prevProps=t.prevState=t.prevContext=t.nextBase=null,t._dirty=!1,!C){r=t.render(u,l,c),t.getChildContext&&(c=i(i({},c),t.getChildContext())),m&&t.getSnapshotBeforeUpdate&&(x=t.getSnapshotBeforeUpdate(d,f));var D,A,P=r&&r.nodeName;if("function"==typeof P){var E=p(r);(s=w)&&s.constructor===P&&E.key==s.__key?N(s,E,1,c,!1):(D=s,t._component=s=S(P,E,c),s.nextBase=s.nextBase||b,s._parentComponent=t,N(s,E,0,c,!1),M(s,1,n,!0)),A=s.base}else a=g,(D=w)&&(a=t._component=null),(g||1===e)&&(a&&(a._component=null),A=k(a,r,c,n||!m,g&&g.parentNode,!0));if(g&&A!==g&&s!==w){var j=g.parentNode;j&&A!==j&&(j.replaceChild(A,g),D||(g._component=null,O(g,!1)))}if(D&&T(D),t.base=A,A&&!o){for(var R=t,L=t;L=L._parentComponent;)(R=L).base=A;A._component=R,A._componentConstructor=R.constructor}}for(!m||n?v.unshift(t):C||t.componentDidUpdate&&t.componentDidUpdate(d,f,x);t._renderCallbacks.length;)t._renderCallbacks.pop().call(t);y||o||_()}}function T(t){var e=t.base;t._disable=!0,t.componentWillUnmount&&t.componentWillUnmount(),t.base=null;var n=t._component;n?T(n):e&&(e.__preactattr_&&e.__preactattr_.ref&&e.__preactattr_.ref(null),t.nextBase=e,f(e),x.push(t),C(e)),t.__ref&&t.__ref(null)}function A(t,e){this._dirty=!0,this.context=e,this.props=t,this.state=this.state||{},this._renderCallbacks=[]}function P(t,e,n){return k(n,t,{},!1,e,!1)}i(A.prototype,{setState:function(t,e){this.prevState||(this.prevState=this.state),this.state=i(i({},this.state),"function"==typeof t?t(this.state,this.props):t),e&&this._renderCallbacks.push(e),l(this)},forceUpdate:function(t){t&&this._renderCallbacks.push(t),M(this,2)},render:function(){}});var E=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},j=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),R=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},L=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},q={currentVol:50,snoozed:!1},W=function(t){if(t.startTime<2)return q.snoozed&&(Dubtrack.room.player.setVolume(q.currentVol),q.snoozed=!1),!0},F=function(){!q.snoozed&&!Dubtrack.room.player.muted_player&&Dubtrack.playerController.volume>2?(q.currentVol=Dubtrack.playerController.volume,Dubtrack.room.player.mutePlayer(),q.snoozed=!0,Dubtrack.Events.bind("realtime:room_playlist-update",W)):q.snoozed&&(Dubtrack.room.player.setVolume(q.currentVol),Dubtrack.room.player.updateVolumeBar(),q.snoozed=!1)},z={position:"absolute",font:"1rem/1.5 proxima-nova,sans-serif",display:"block",left:"-33px",cursor:"pointer",borderRadius:"1.5rem",padding:"8px 16px",background:"#fff",fontWeight:"700",fontSize:"13.6px",textTransform:"uppercase",color:"#000",opacity:"0.8",textAlign:"center",zIndex:"9"},U=function(t){function e(){var t,n,o;E(this,e);for(var r=arguments.length,i=Array(r),s=0;s<r;s++)i[s]=arguments[s];return n=o=L(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(i))),o.state={show:!1},o.showTooltip=function(){o.setState({show:!0})},o.hideTooltip=function(){o.setState({show:!1})},L(o,n)}return R(e,A),j(e,[{key:"render",value:function(t,e){return r("span",{className:"icon-mute snooze_btn",onClick:F,onMouseOver:this.showTooltip,onMouseOut:this.hideTooltip},e.show&&r("div",{className:"snooze_tooltip",style:z},"Mute current song"))}}]),e}();var I={position:"absolute",font:"1rem/1.5 proxima-nova,sans-serif",display:"block",left:"-33px",cursor:"pointer",borderRadius:"1.5rem",padding:"8px 16px",background:"#fff",fontWeight:"700",fontSize:"13.6px",textTransform:"uppercase",color:"#000",opacity:"0.8",textAlign:"center",zIndex:"9"},B=function(t){function e(){var t,n,o;E(this,e);for(var r=arguments.length,i=Array(r),s=0;s<r;s++)i[s]=arguments[s];return n=o=L(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(i))),o.state={show:!1,booth_time:""},o.showTooltip=function(){var t=o.getEta();o.setState({show:!0,booth_time:t})},o.hideTooltip=function(){o.setState({show:!1})},L(o,n)}return R(e,A),j(e,[{key:"getEta",value:function(){var t=parseInt(document.querySelector("#player-controller div.left ul li.infoContainer.display-block div.currentTime span.min").textContent),e=4*parseInt(document.querySelector(".queue-position").textContent)-4+t;return e>=0?e:"You're not in the queue"}},{key:"render",value:function(t,e){return r("span",{className:"icon-history eta_tooltip_t",onMouseOver:this.showTooltip,onMouseOut:this.hideTooltip},this.state.show&&r("span",{className:"eta_tooltip",style:I},this.state.booth_time))}}]),e}();function Y(t){return r("div",{id:t.id,className:"dubplus-menu-section-header"},r("span",{className:"fa fa-angle-"+t.arrow}),r("p",null,t.category))}var G={menu:{general:"open","user-interface":"open",settings:"open",customize:"open",contact:"open"},options:{"dubplus-autovote":!1,"dubplus-emotes":!1,"dubplus-autocomplete":!1,mention_notifications:!1,dubplus_pm_notifications:!1,"dj-notification":!1,"dubplus-dubs-hover":!1,"dubplus-downdubs":!1,"dubplus-grabschat":!1,"dubplus-split-chat":!1,"dubplus-show-timestamp":!1,"dubplus-hide-bg":!1,"dubplus-hide-avatars":!1,"dubplus-chat-only":!1,"dubplus-video-only":!1,warn_redirect:!1,"dubplus-comm-theme":!1,"dubplus-afk":!1,"dubplus-snow":!1,"dubplus-custom-css":!1},custom:{customAfkMessage:"",dj_notification:1,css:""}},V=new(function(){function t(){E(this,t),this.srcRoot="https://rawgit.com/FranciscoG/DubPlus/preact-version";var e=localStorage.getItem("dubplusUserSettings");if(e)try{var n=JSON.parse(e);this.stored=Object.assign({},G,n)}catch(t){this.stored=G}else this.stored=G}return j(t,[{key:"save",value:function(t,e,n){this.stored[t][e]=n;try{localStorage.setItem("dubplusUserSettings",JSON.stringify(this.stored))}catch(t){console.error("an error occured saving dubplus to localStorage",t)}}}]),t}()),H=function(t){function e(){return E(this,e),L(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return R(e,A),j(e,[{key:"componentDidUpdate",value:function(t){for(var e in t)if(t[e]!==this.props[e])return setTimeout(this.renderLayer)}},{key:"componentDidMount",value:function(){this.isMounted=!0,this.renderLayer=this.renderLayer.bind(this),this.renderLayer()}},{key:"componentWillUnmount",value:function(){this.renderLayer(!1),this.isMounted=!1,this.remote&&this.remote.parentNode.removeChild(this.remote)}},{key:"findNode",value:function(t){return"string"==typeof t?document.querySelector(t):t}},{key:"renderLayer",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.isMounted&&(this.props.into!==this.intoPointer&&(this.intoPointer=this.props.into,this.into&&this.remote&&(this.remote=P(r(K,null),this.into,this.remote)),this.into=this.findNode(this.props.into)),this.remote=P(r(K,{context:this.context},t&&this.props.children||null),this.into,this.remote))}},{key:"render",value:function(){return null}}]),e}(),K=function(t){function e(){return E(this,e),L(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return R(e,A),j(e,[{key:"getChildContext",value:function(){return this.props.context}},{key:"render",value:function(t){var e=t.children;return e&&e[0]||null}}]),e}(),X=function(t){function e(){var t,n,o;E(this,e);for(var r=arguments.length,i=Array(r),s=0;s<r;s++)i[s]=arguments[s];return n=o=L(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(i))),o.keyUpHandler=function(t){13===t.keyCode&&(o.props.onConfirm(o.textarea.value),o.props.onClose()),27===t.keyCode&&o.props.onClose()},o.confirmClick=function(){o.props.onConfirm(o.textarea.value),o.props.onClose()},L(o,n)}return R(e,A),j(e,[{key:"componentDidMount",value:function(){document.addEventListener("keyup",this.keyUpHandler)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keyup",this.keyUpHandler)}},{key:"render",value:function(t){var e=this,n=t.onConfirm?"cancel":"close";return t.open?r(H,{into:"body"},r("div",{className:"dp-modal"},r("aside",{className:"container"},r("div",{className:"title"},r("h1",null," ",t.title||"Dub+")),r("div",{className:"content"},r("p",null,t.content||""),t.placeholder&&r("textarea",{ref:function(t){return e.textarea=t},placeholder:t.placeholder,maxlength:t.maxlength||999},t.value||"")),r("div",{className:"dp-modal-buttons"},r("button",{id:"dp-modal-cancel",onClick:t.onClose},n),t.onConfirm&&r("button",{id:"dp-modal-confirm",onClick:this.confirmClick},"okay"))))):null}}]),e}(),J=window.ga||function(){},Q=new(function(){function t(e){E(this,t),J("create",e,"auto","dubplusTracker")}return j(t,[{key:"event",value:function(t,e,n,o){J("dubplusTracker.send","event",t,e,n,o)}},{key:"menuClick",value:function(t,e,n){this.event(t,"click",e,n)}}]),t}())("UA-116652541-1"),Z=function(t){function e(){var t,n,o;E(this,e);for(var r=arguments.length,i=Array(r),s=0;s<r;s++)i[s]=arguments[s];return n=o=L(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(i))),o.state={open:!1},o.loadModal=function(){o.setState({open:!0}),Q.menuClick(o.props.section+" section",o.props.id+" edit")},o.closeModal=function(){console.log("closing dub+ modal"),o.setState({open:!1})},L(o,n)}return R(e,A),j(e,[{key:"render",value:function(t,e){return r("span",{onClick:this.loadModal,className:"fa fa-pencil extra-icon"},r(X,{open:e.open,title:t.title||"Dub+ option",content:t.content||"Please enter a value",placeholder:t.placeholder||"in here",value:t.value,onConfirm:t.onConfirm,onClose:this.closeModal}))}}]),e}(),tt=function(t){function e(){var t,n,o;E(this,e);for(var r=arguments.length,i=Array(r),s=0;s<r;s++)i[s]=arguments[s];return n=o=L(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(i))),o.state={on:V.stored.options[o.props.id]||!1},o.switchOn=function(){o.props.turnOn(),V.save("options",o.props.id,!0),o.setState({on:!0}),Q.menuClick(o.props.section+" section",o.props.id+" on")},o.switchOff=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];o.props.turnOff(),V.save("options",o.props.id,!1),o.setState({on:!1}),t||Q.menuClick(o.props.section+" section",o.props.id+" off")},o.toggleSwitch=function(){o.state.on?o.switchOff():o.switchOn()},L(o,n)}return R(e,A),j(e,[{key:"componentDidMount",value:function(){this.state.on&&this.props.turnOn()}},{key:"render",value:function(t,e){var n=["dubplus-switch"];return e.on&&n.push("dubplus-switch-on"),t.className&&n.push(t.className),r("li",{id:t.id,title:t.desc,className:n.join(" ")},t.children||null,r("div",{onClick:this.toggleSwitch,className:"dubplus-form-control"},r("div",{class:"dubplus-switch-bg"},r("div",{class:"dubplus-switcher"})),r("span",{className:"dubplus-menu-label"},t.menuTitle)))}}]),e}(),et=function(t){function e(){var t,n,o;E(this,e);for(var r=arguments.length,i=Array(r),s=0;s<r;s++)i[s]=arguments[s];return n=o=L(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(i))),o.state={canSend:!0},o.afk_chat_respond=function(t){if(o.state.canSend){var e=t.message,n=Dubtrack.session.get("username");if(e.indexOf("@"+n)>-1&&Dubtrack.session.id!==t.user.userInfo.userid){var r=document.getElementById("chat-txt-message");V.stored.custom.customAfkMessage?r.value="[AFK] "+V.stored.custom.customAfkMessage:r.value="[AFK] I'm not here right now.",Dubtrack.room.chat.sendMessage(),o.setState({canSend:!1}),setTimeout(function(){o.setState({canSend:!0})},3e4)}}},L(o,n)}return R(e,A),j(e,[{key:"turnOn",value:function(){Dubtrack.Events.bind("realtime:chat-message",this.afk_chat_respond)}},{key:"turnOff",value:function(){Dubtrack.Events.unbind("realtime:chat-message",this.afk_chat_respond)}},{key:"saveAFKmessage",value:function(t){""!==t&&V.save("custom","customAfkMessage",t)}},{key:"render",value:function(t,e){return r(tt,{id:"dubplus-afk",section:"General",menuTitle:"AFK Auto-respond",desc:"Toggle Away from Keyboard and customize AFK message.",turnOn:this.turnOn,turnOff:this.turnOff},r(Z,{title:"Custom AFK Message",section:"General",content:"Enter a custom Away From Keyboard [AFK] message here",value:V.stored.custom.customAfkMessage||"",placeholder:"Be right back!",maxlength:"255",onConfirm:this.saveAFKmessage}))}}]),e}(),nt=function(t){function e(){E(this,e);var t=L(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.advance_vote=function(){var e=document.createEvent("HTMLEvents");e.initEvent("click",!0,!1),t.dubup.dispatchEvent(e)},t.voteCheck=function(e){e.startTime<2&&t.advance_vote()},t.turnOn=function(e){var n=Dubtrack.room.player.activeSong.get("song"),o=Dubtrack.helpers.cookie.get("dub-"+Dubtrack.room.model.get("_id")),r=Dubtrack.helpers.cookie.get("dub-song");Dubtrack.room&&n&&n.songid===r||(o=!1),t.dubup.classList.contains("voted")||t.dubdown.classList.contains("voted")||o||t.advance_vote(),Dubtrack.Events.bind("realtime:room_playlist-update",t.voteCheck)},t.turnOff=function(e){Dubtrack.Events.unbind("realtime:room_playlist-update",t.voteCheck)},t.dubup=document.querySelector(".dubup"),t.dubdown=document.querySelector(".dubdown"),t}return R(e,A),j(e,[{key:"render",value:function(t,e){return r(tt,{id:"dubplus-autovote",section:"General",menuTitle:"Autovote",desc:"Toggles auto upvoting for every song",turnOn:this.turnOn,turnOff:this.turnOff})}}]),e}(),ot=function(t){function e(){return E(this,e),L(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return R(e,A),j(e,[{key:"componentDidUpdate",value:function(t){for(var e in t)if(t[e]!==this.props[e])return setTimeout(this.renderLayer)}},{key:"componentDidMount",value:function(){this.isMounted=!0,this.renderLayer=this.renderLayer.bind(this),this.renderLayer()}},{key:"componentWillUnmount",value:function(){this.renderLayer(!1),this.isMounted=!1,this.remote&&this.remote.parentNode.removeChild(this.remote)}},{key:"findNode",value:function(t){return"string"==typeof t?document.querySelector(t):t}},{key:"renderLayer",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.isMounted&&(this.props.into!==this.intoPointer&&(this.intoPointer=this.props.into,this.into&&this.remote&&(this.remote=P(r(rt,null),this.into,this.remote)),this.into=this.findNode(this.props.into)),this.remote=P(r(rt,{context:this.context},t&&this.props.children||null),this.into,this.remote))}},{key:"render",value:function(){return null}}]),e}(),rt=function(t){function e(){return E(this,e),L(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return R(e,A),j(e,[{key:"getChildContext",value:function(){return this.props.context}},{key:"render",value:function(t){var e=t.children;return e&&e[0]||null}}]),e}(),it=function(t){function e(){var t,n,o;E(this,e);for(var r=arguments.length,i=Array(r),s=0;s<r;s++)i[s]=arguments[s];return n=o=L(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(i))),o.state={open:!1},o.turnOn=function(t){},o.turnOff=function(t){},L(o,n)}return R(e,A),j(e,[{key:"componentWillMount",value:function(){this.renderTo=document.querySelector(".pusher-chat-widget-input")}},{key:"render",value:function(t,e){var n=e.open;return r(tt,{id:"dubplus-emotes",section:"General",menuTitle:"Autocomplete Emoji",desc:"Quick find and insert emojis and emotes while typing in the chat input",turnOn:this.turnOn,turnOff:this.turnOff},n?r(ot,{into:this.renderTo}):null)}}]),e}(),st=function(t){function e(){var t,n,o;E(this,e);for(var r=arguments.length,i=Array(r),s=0;s<r;s++)i[s]=arguments[s];return n=o=L(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(i))),o.customMentionCheck=function(t){var e=t.message;if(V.custom.custom_mentions){var n=V.custom.custom_mentions.split(",").some(function(t){return new RegExp("\\b"+t.trim()+"\\b","i").test(e)});Dubtrack.session.id!==t.user.userInfo.userid&&n&&Dubtrack.room.chat.mentionChatSound.play()}},o.saveCustomMentions=function(t){""!==t&&V.save("custom","custom_mentions",t)},L(o,n)}return R(e,A),j(e,[{key:"turnOn",value:function(){Dubtrack.Events.bind("realtime:chat-message",this.customMentionCheck)}},{key:"turnOff",value:function(){Dubtrack.Events.unbind("realtime:chat-message",this.customMentionCheck)}},{key:"render",value:function(t,e){return r(tt,{id:"custom_mentions",section:"General",menuTitle:"Custom Mentions",desc:"Toggle using custom mentions to trigger sounds in chat",turnOn:this.turnOn,turnOff:this.turnOff},r(Z,{title:"Custom AFK Message",section:"General",content:"Add your custom mention triggers here (separate by comma)",value:V.stored.custom.custom_mentions||"",placeholder:"separate, custom triggers, by, comma, :heart:",maxlength:"255",onConfirm:this.saveCustomMentions}))}}]),e}(),at=function(t){function e(){var t,n,o;E(this,e);for(var r=arguments.length,i=Array(r),s=0;s<r;s++)i[s]=arguments[s];return n=o=L(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(i))),o.chatCleanerCheck=function(t){var e=Array.from(document.querySelectorAll("ul.chat-main > li")),n=parseInt(V.stored.custom.chat_cleaner,10);if(!(isNaN(e.length)||isNaN(n)||!e.length||e.length<n)){var o=e[0].parentElement;e.slice(0,n).forEach(function(t,e){o.removeChild(t)}),$(".chat-messages").perfectScrollbar("update")}},o.saveAmount=function(t){var e=parseInt(t,10),n=isNaN(e)?500:e;V.save("custom","chat_cleaner",n)},o.turnOn=function(){Dubtrack.Events.bind("realtime:chat-message",o.chatCleanerCheck)},o.turnOff=function(){Dubtrack.Events.unbind("realtime:chat-message",o.chatCleanerCheck)},L(o,n)}return R(e,A),j(e,[{key:"render",value:function(){return r(tt,{id:"chat-cleaner",section:"General",menuTitle:"Chat Cleaner",desc:"Automatically only keep a designated chatItems of chat items while clearing older ones, keeping CPU stress down",turnOn:this.turnOn,turnOff:this.turnOff},r(Z,{title:"Chat Cleaner",section:"General",content:"Please specify the number of most recent chat items that will remain in your chat history",value:V.stored.custom.chat_cleaner||"",placeholder:"500",maxlength:"5",onConfirm:this.saveAmount}))}}]),e}(),ut=!0,lt={denyDismiss:{title:"Desktop Notifications",content:"You have dismissed or chosen to deny the request to allow desktop notifications. Reset this choice by clearing your cache for the site."},noSupport:{title:"Desktop Notifications",content:"Sorry this browser does not support desktop notifications.  Please use the latest version of Chrome or FireFox"}};function ct(t){var e="function"==typeof t?t:function(){};return"Notification"in window?"granted"===Notification.permission?e(!0,"granted"):"denied"===Notification.permission?e(!1,lt.denyDismiss):void Notification.requestPermission().then(function(t){if("denied"!==t&&"default"!==t)return e(!0,"granted");e(!1,lt.denyDismiss)}):e(!1,lt.noSupport)}function dt(t){var e=Object.assign({},{title:"New Message",content:"",ignoreActiveTab:!1,callback:null,wait:5e3},t);if(!0!==ut||e.ignoreActiveTab){var n={body:e.content,icon:"https://res.cloudinary.com/hhberclba/image/upload/c_lpad,h_100,w_100/v1400351432/dubtrack_new_logo_fvpxa6.png"},o=new Notification(e.title,n);o.onclick=function(){window.focus(),"function"==typeof e.callback&&e.callback(),o.close()},setTimeout(o.close.bind(o),e.wait)}}window.onfocus=function(){ut=!0},window.onblur=function(){ut=!1};var pt=function(t){function e(){var t,n,o;E(this,e);for(var r=arguments.length,i=Array(r),s=0;s<r;s++)i[s]=arguments[s];return n=o=L(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(i))),o.state={showWarning:!1,warnTitle:"",warnContent:""},o.turnOn=function(){ct(function(t,e){!0===t?Dubtrack.Events.bind("realtime:chat-message",o.notifyOnMention):(o.switchRef.switchOff(!0),o.setState({showWarning:!0,warnTitle:e.title,warnContent:e.content}))})},o.closeModal=function(){o.setState({showWarning:!1})},o.turnOff=function(){Dubtrack.Events.unbind("realtime:chat-message",o.notifyOnMention)},L(o,n)}return R(e,A),j(e,[{key:"notifyOnMention",value:function(t){var e=t.message,n=["@"+Dubtrack.session.get("username").toLowerCase()];V.stored.options.custom_mentions&&V.stored.custom.custom_mentions&&(n=n.concat(V.stored.custom.custom_mentions.split(","))),n.some(function(t){return new RegExp("\\b"+t.trim()+"\\b","i").test(e)})&&!this.isActiveTab&&Dubtrack.session.id!==t.user.userInfo.userid&&dt({title:"Message from "+t.user.username,content:e})}},{key:"render",value:function(t,e){var n=this;return r(tt,{ref:function(t){return n.switchRef=t},id:"mention_notifications",section:"General",menuTitle:"Notification on Mentions",desc:"Enable desktop notifications when a user mentions you in chat",turnOn:this.turnOn,turnOff:this.turnOff},r(X,{open:e.showWarning,title:e.warnTitle,content:e.warnContent,onClose:this.closeModal}))}}]),e}(),ft=function(t){function e(){var t,n,o;E(this,e);for(var r=arguments.length,i=Array(r),s=0;s<r;s++)i[s]=arguments[s];return n=o=L(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(i))),o.state={showWarning:!1,warnTitle:"",warnContent:""},o.turnOn=function(){ct(function(t,e){!0===t?Dubtrack.Events.bind("realtime:new-message",o.notify):(o.switchRef.switchOff(!0),o.setState({showWarning:!0,warnTitle:e.title,warnContent:e.content}))})},o.closeModal=function(){o.setState({showWarning:!1})},o.turnOff=function(){Dubtrack.Events.unbind("realtime:new-message",o.notify)},L(o,n)}return R(e,A),j(e,[{key:"notify",value:function(t){Dubtrack.session.get("_id")!==t.userid&&dt({title:"You have a new PM",ignoreActiveTab:!0,callback:function(){document.querySelector(".user-messages").click(),setTimeout(function(){document.querySelector('.message-item[data-messageid="'+t.messageid+'"]').click()},500)},wait:1e4})}},{key:"render",value:function(t,e){var n=this;return r(tt,{ref:function(t){return n.switchRef=t},id:"dubplus_pm_notifications",section:"General",menuTitle:"Notification on PM",desc:"Enable desktop notifications when a user receives a private message",turnOn:this.turnOn,turnOff:this.turnOff},r(X,{open:e.showWarning,title:e.warnTitle,content:e.warnContent,onClose:this.closeModal}))}}]),e}();function ht(t,e){var n=document.createElement("script"),o=document.getElementsByTagName("script")[0];n.async=1,n.onload=n.onreadystatechange=function(t,o){(o||!n.readyState||/loaded|complete/.test(n.readyState))&&(n.onload=n.onreadystatechange=null,n=void 0,o||e&&e())},n.onerror=function(t){e&&e(t)},n.src=t,o.parentNode.insertBefore(n,o)}var mt=function(t){function e(){var t,n,o;E(this,e);for(var r=arguments.length,i=Array(r),s=0;s<r;s++)i[s]=arguments[s];return n=o=L(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(i))),o.turnOn=function(){$.snowfall?o.doSnow():ht("https://rawgit.com/loktar00/JQuery-Snowfall/master/src/snowfall.jquery.js",function(t){if(t)return o.switchRef.switchOff(!0),void console.error("Could not load snowfall jquery plugin",t);o.doSnow()})},L(o,n)}return R(e,A),j(e,[{key:"doSnow",value:function(){$(document).snowfall({round:!0,shadow:!0,flakeCount:50,minSize:1,maxSize:5,minSpeed:5,maxSpeed:5})}},{key:"turnOff",value:function(){$.snowfall&&$(document).snowfall("clear")}},{key:"render",value:function(){var t=this;return r(tt,{ref:function(e){return t.switchRef=e},id:"dubplus-snow",section:"General",menuTitle:"Snow",desc:"Make it snow!",turnOn:this.turnOn,turnOff:this.turnOff})}}]),e}(),vt={particles:[],drops:[],numbase:5,numb:2,height:0,controls:{rain:2,alpha:1,color:200,opacity:1,saturation:100,lightness:50,back:0,multi:!1,speed:1},init:function(){var t=document.createElement("canvas");t.id="dubPlusRainCanvas",t.style.cssText="position : fixed; top : 0px; left : 0px; z-index: 100; pointer-events:none;",document.body.insertBefore(t,document.body.childNodes[0]),this.bindCanvas()},destroy:function(){document.body.removeChild(document.getElementById("dubPlusRainCanvas")),this.unbindCanvas()},bindCanvas:function(){this.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)};var t=document.getElementById("dubPlusRainCanvas");if(t){var e=t.getContext("2d");this.width,this.height=0,window.onresize=function(){this.width=t.width=window.innerWidth,this.height=t.height=window.innerHeight},window.onresize(),this.particles,this.drops=[],this.numbase=5,this.numb=2;var n=this;!function t(){n.requestAnimFrame(t),n.update(),n.rendu(e)}()}},buildRainParticle:function(t,e,n){for(n||(n=this.numb);n--;)this.particles.push({speedX:.25*Math.random(),speedY:9*Math.random()+1,X:t,Y:e,alpha:1,color:"hsla("+this.controls.color+","+this.controls.saturation+"%, "+this.controls.lightness+"%,"+this.controls.opacity+")"})},explosion:function(t,e,n,o){for(o||(o=this.numbase);o--;)this.drops.push({speedX:4*Math.random()-2,speedY:-4*Math.random(),X:t,Y:e,radius:.65+Math.floor(1.6*Math.random()),alpha:1,color:n})},rendu:function(t){1==this.controls.multi&&(this.controls.color=360*Math.random()),t.save(),t.clearRect(0,0,width,height);for(var e,n=this.particles,o=this.drops,r=2*Math.PI,i=0;e=n[i];i++)t.globalAlpha=e.alpha,t.fillStyle=e.color,t.fillRect(e.X,e.Y,e.speedY/4,e.speedY);var s;for(i=0;s=o[i];i++)t.globalAlpha=s.alpha,t.fillStyle=s.color,t.beginPath(),t.arc(s.X,s.Y,s.radius,0,r),t.fill();t.strokeStyle="white",t.lineWidth=2,t.restore()},update:function(){for(var t,e=this.particles,n=this.drops,o=0;t=e[o];o++)t.X+=t.speedX,t.Y+=t.speedY+5,t.Y>height-15&&(e.splice(o--,1),this.explosion(t.X,t.Y,t.color));var r;for(o=0;r=n[o];o++)r.X+=r.speedX,r.Y+=r.speedY,r.radius-=.075,r.alpha>0?r.alpha-=.005:r.alpha=0,r.radius<0&&n.splice(o--,1);for(o=this.controls.rain;o--;)this.buildRainParticle(Math.floor(Math.random()*width),-15)},unbindCanvas:function(){this.requestAnimFrame=function(){}}},yt=function(t){function e(){return E(this,e),L(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return R(e,A),j(e,[{key:"turnOn",value:function(){vt.init()}},{key:"turnOff",value:function(){vt.destroy()}},{key:"render",value:function(t,e){return r(tt,{id:"dubplus-rain",section:"General",menuTitle:"Rain",desc:"Make it rain!",turnOn:this.turnOn,turnOff:this.turnOff})}}]),e}(),bt=function(t){function e(){var t,n,o;E(this,e);for(var r=arguments.length,i=Array(r),s=0;s<r;s++)i[s]=arguments[s];return n=o=L(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(i))),o.state={css:V.stored.general||"open"},o.toggleSection=function(){o.setState(function(t){var e="open"===t.css?"closed":"open";return V.save("menu","general",e),{css:e}})},L(o,n)}return R(e,A),j(e,[{key:"render",value:function(t,e){var n=["dubplus-menu-section"];return"closed"===e.css&&n.push("dubplus-menu-section-closed"),r("span",null,r(Y,{onClick:this.toggleSection,id:"dubplus-general",category:"General"}),r("ul",{className:n.join(" ")},r(nt,null),r(et,null),r(it,null),r(st,null),r(at,null),r(pt,null),r(ft,null),r(mt,null),r(yt,null)))}}]),e}(),gt=function(t){function e(){return E(this,e),L(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return R(e,A),j(e,[{key:"componentDidMount",value:function(){setTimeout(function(){P(r(U,null),document.querySelector(".player_sharing")),P(r(B,null),document.querySelector(".player_sharing"))},10)}},{key:"render",value:function(t,e){return r("section",{className:"dubplus-menu"},r("p",{className:"dubplus-menu-header"},"Dub+ Options"),r(bt,null))}}]),e}();function _t(t,e){for(var n=t.split("."),o=n.length,r=e||window,i=0;i<o;i++){if(void 0===r[n[i]])return!1;r=r[n[i]]}return!0}function kt(t,e){for(var n=t.length,o=e||window,r=0;r<n;r++)if(!_t(t[r],o))return console.log(t[r],"is not found yet"),!1;return!0}var wt={fontFamily:"'Trebuchet MS', Helvetica, sans-serif",zIndex:"2147483647",color:"white",position:"fixed",top:"69px",right:"-250px",background:"#222",padding:"10px",lineHeight:1,boxShadow:"0px 0px 5px 0px rgba(0,0,0,0.75)",borderRadius:"5px",overflow:"hidden",width:"230px",transition:"right 200ms"},Ot={float:"left",width:"26px",marginRight:"5px"},Ct={display:"table-cell",width:"10000px",paddingTop:"5px"},xt=function(t){function e(){var t,n,o;E(this,e);for(var r=arguments.length,i=Array(r),s=0;s<r;s++)i[s]=arguments[s];return n=o=L(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(i))),o.state={mainStyles:wt},L(o,n)}return R(e,A),j(e,[{key:"componentDidMount",value:function(){var t=this;setTimeout(function(){t.setState(function(t,e){return{mainStyles:Object.assign({},t.mainStyles,{right:"13px"})}})},200)}},{key:"componentWillUnmount",value:function(){this.setState(function(t,e){return{mainStyles:Object.assign({},t.mainStyles,{right:"-250px"})}})}},{key:"render",value:function(t,e){return r("div",{style:e.mainStyles},r("div",{style:Ot},r("img",{src:V.srcRoot+"/images/dubplus.svg",alt:"DubPlus icon"})),r("span",{style:Ct},t.text||"Waiting for Dubtrack..."))}}]),e}(),St=function(t,e){var n=document.createElement("link");return n.rel="stylesheet",n.type="text/css",n.className=t||"",n.href=e,n};var Dt={load:function(t,e){if(t){var n=St(e,V.srcRoot+t+"?1542167899102");document.head.appendChild(n)}},loadExternal:function(t,e){if(t){var n=St(e,t);document.head.appendChild(n)}}},Nt=function(t){function e(){var t,n,o;E(this,e);for(var r=arguments.length,i=Array(r),s=0;s<r;s++)i[s]=arguments[s];return n=o=L(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(i))),o.state={open:!1},o.toggle=function(){var t=document.querySelector(".dubplus-menu");o.state.open?(t.classList.add("dubplus-menu-open"),o.setState({open:!1})):(t.classList.remove("dubplus-menu-open"),o.setState({open:!0}))},L(o,n)}return R(e,A),j(e,[{key:"render",value:function(t,e){return r("div",{className:"dubplus-icon",onClick:this.toggle},r("img",{src:V.srcRoot+"/images/dubplus.svg",alt:"DubPlus Icon"}))}}]),e}();setTimeout(function(){Dt.load("/css/dubplus.css"),Dt.loadExternal("https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"),"undefined"==typeof Promise&&ht("https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.auto.min.js")},1),P(r(function(t){function e(){var t,n,o;E(this,e);for(var r=arguments.length,i=Array(r),s=0;s<r;s++)i[s]=arguments[s];return n=o=L(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(i))),o.state={loading:!0,error:!1,errorMsg:"",failed:!1},L(o,n)}return R(e,A),j(e,[{key:"componentDidMount",value:function(){var t=this;if(window.DubPlus)Dubtrack.session.id?this.showError("Dub+ is already loaded"):this.showError("You're not logged in. Please login to use Dub+.");else{new function(t,e){if("string"==typeof t||Array.isArray(t)){var n=function(){},o=function(){},r=Array.isArray(t)?kt:_t,i=Object.assign({},{interval:500,seconds:15},e),s=0,a=1e3*i.seconds/i.interval,u=function e(){return s++,r(t)?n():s<a?void window.setTimeout(e,i.interval):o()};return{then:function(t){return"function"==typeof t&&(n=t),window.setTimeout(u,i.interval),this},fail:function(t){return"function"==typeof t&&(o=t),this}}}console.warn("WaitFor: invalid first argument")}(["Dubtrack.session.id","Dubtrack.room.chat","Dubtrack.Events","Dubtrack.room.player","Dubtrack.helpers.cookie","Dubtrack.room.model","Dubtrack.room.users"],{seconds:120}).then(function(){t.setState({loading:!1,error:!1})}).fail(function(){Dubtrack.session.id?(t.showError("Something happed, refresh and try again"),Q.event("Dub+ lib","load","failed")):t.showError("You're not logged in. Please login to use Dub+.")})}}},{key:"showError",value:function(t){this.setState({loading:!1,error:!0,errorMsg:t})}},{key:"render",value:function(t,e){var n=this;return e.loading?r(xt,null):e.error?r(X,{title:"Dub+ Error",onClose:function(){n.setState({failed:!0,error:!1})},content:e.errorMsg}):e.failed?null:r(gt,null)}}]),e}(),null),document.body),P(r(Nt,null),document.querySelector(".header-right-navigation"));return{version:"0.1.8",description:"Dub+ - A simple script/extension for Dubtrack.fm",license:"MIT",bugs:"https://github.com/DubPlus/DubPlus/issues"}}();
