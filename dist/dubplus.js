
/*
     /$$$$$$$            /$$                
    | $$__  $$          | $$          /$$   
    | $$  | $$ /$$   /$$| $$$$$$$    | $$   
    | $$  | $$| $$  | $$| $$__  $$ /$$$$$$$$
    | $$  | $$| $$  | $$| $$  | $$|__  $$__/
    | $$  | $$| $$  | $$| $$  | $$   | $$   
    | $$$$$$$/|  $$$$$$/| $$$$$$$/   |__/   
    |_______/  ______/ |_______/           
                                            
                                            
    https://github.com/DubPlus/DubPlus

    This source code is licensed under the MIT license 
    found here: https://github.com/DubPlus/DubPlus/blob/master/LICENSE

    Copyright (c) 2017-present DubPlus

    more info at https://dub.plus
*/
var DubPlus=function(){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function a(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function r(e,t){return(r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?l(e):t}function f(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var p=function(){},i={},h=[],m=[];function b(e,t){var n,o,r,i,s=m;for(i=arguments.length;2<i--;)h.push(arguments[i]);for(t&&null!=t.children&&(h.length||h.push(t.children),delete t.children);h.length;)if((o=h.pop())&&void 0!==o.pop)for(i=o.length;i--;)h.push(o[i]);else"boolean"==typeof o&&(o=null),(r="function"!=typeof e)&&(null==o?o="":"number"==typeof o?o=String(o):"string"!=typeof o&&(r=!1)),r&&n?s[s.length-1]+=o:s===m?s=[o]:s.push(o),n=r;var a=new p;return a.nodeName=e,a.children=s,a.attributes=null==t?void 0:t,a.key=null==t?void 0:t.key,a}function O(e,t){for(var n in t)e[n]=t[n];return e}function v(e,t){null!=e&&("function"==typeof e?e(t):e.current=t)}var t="function"==typeof Promise?Promise.resolve().then.bind(Promise.resolve()):setTimeout,y=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,g=[];function k(e){!e._dirty&&(e._dirty=!0)&&1==g.push(e)&&t(w)}function w(){for(var e;e=g.pop();)e._dirty&&G(e)}function S(e,t){return e.normalizedNodeName===t||e.nodeName.toLowerCase()===t.toLowerCase()}function x(e){var t=O({},e.attributes);t.children=e.children;var n=e.nodeName.defaultProps;if(void 0!==n)for(var o in n)void 0===t[o]&&(t[o]=n[o]);return t}function N(e){var t=e.parentNode;t&&t.removeChild(e)}function _(e,t,n,o,r){if("className"===t&&(t="class"),"key"===t);else if("ref"===t)v(n,null),v(o,e);else if("class"!==t||r)if("style"===t){if(o&&"string"!=typeof o&&"string"!=typeof n||(e.style.cssText=o||""),o&&"object"==typeof o){if("string"!=typeof n)for(var i in n)i in o||(e.style[i]="");for(var i in o)e.style[i]="number"==typeof o[i]&&!1===y.test(i)?o[i]+"px":o[i]}}else if("dangerouslySetInnerHTML"===t)o&&(e.innerHTML=o.__html||"");else if("o"==t[0]&&"n"==t[1]){var s=t!==(t=t.replace(/Capture$/,""));t=t.toLowerCase().substring(2),o?n||e.addEventListener(t,D,s):e.removeEventListener(t,D,s),(e._listeners||(e._listeners={}))[t]=o}else if("list"!==t&&"type"!==t&&!r&&t in e){try{e[t]=null==o?"":o}catch(e){}null!=o&&!1!==o||"spellcheck"==t||e.removeAttribute(t)}else{var a=r&&t!==(t=t.replace(/^xlink:?/,""));null==o||!1===o?a?e.removeAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase()):e.removeAttribute(t):"function"!=typeof o&&(a?e.setAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase(),o):e.setAttribute(t,o))}else e.className=o||""}function D(e){return this._listeners[e.type](e)}var E=[],T=0,C=!1,M=!1;function A(){for(var e;e=E.shift();)e.componentDidMount&&e.componentDidMount()}function P(e,t,n,o,r,i){T++||(C=null!=r&&void 0!==r.ownerSVGElement,M=null!=e&&!("__preactattr_"in e));var s=W(e,t,n,o,i);return r&&s.parentNode!==r&&r.appendChild(s),--T||(M=!1,i||A()),s}function W(e,t,n,o,r){var i=e,s=C;if(null!=t&&"boolean"!=typeof t||(t=""),"string"==typeof t||"number"==typeof t)return e&&void 0!==e.splitText&&e.parentNode&&(!e._component||r)?e.nodeValue!=t&&(e.nodeValue=t):(i=document.createTextNode(t),e&&(e.parentNode&&e.parentNode.replaceChild(i,e),q(e,!0))),i.__preactattr_=!0,i;var a,u,c=t.nodeName;if("function"==typeof c)return function(e,t,n,o){var r=e&&e._component,i=r,s=e,a=r&&e._componentConstructor===t.nodeName,u=a,c=x(t);for(;r&&!u&&(r=r._parentComponent);)u=r.constructor===t.nodeName;r&&u&&(!o||r._component)?(U(r,c,3,n,o),e=r.base):(i&&!a&&(z(i),e=s=null),r=R(t.nodeName,c,n),e&&!r.nextBase&&(r.nextBase=e,s=null),U(r,c,1,n,o),e=r.base,s&&e!==s&&(s._component=null,q(s,!1)));return e}(e,t,n,o);if(C="svg"===c||"foreignObject"!==c&&C,c=String(c),(!e||!S(e,c))&&(a=c,(u=C?document.createElementNS("http://www.w3.org/2000/svg",a):document.createElement(a)).normalizedNodeName=a,i=u,e)){for(;e.firstChild;)i.appendChild(e.firstChild);e.parentNode&&e.parentNode.replaceChild(i,e),q(e,!0)}var l=i.firstChild,d=i.__preactattr_,f=t.children;if(null==d){d=i.__preactattr_={};for(var p=i.attributes,h=p.length;h--;)d[p[h].name]=p[h].value}return!M&&f&&1===f.length&&"string"==typeof f[0]&&null!=l&&void 0!==l.splitText&&null==l.nextSibling?l.nodeValue!=f[0]&&(l.nodeValue=f[0]):(f&&f.length||null!=l)&&function(e,t,n,o,r){var i,s,a,u,c,l=e.childNodes,d=[],f={},p=0,h=0,m=l.length,b=0,v=t?t.length:0;if(0!==m)for(var y=0;y<m;y++){var g=l[y],k=g.__preactattr_,w=v&&k?g._component?g._component.__key:k.key:null;null!=w?(p++,f[w]=g):(k||(void 0!==g.splitText?!r||g.nodeValue.trim():r))&&(d[b++]=g)}if(0!==v)for(var y=0;y<v;y++){u=t[y],c=null;var w=u.key;if(null!=w)p&&void 0!==f[w]&&(c=f[w],f[w]=void 0,p--);else if(h<b)for(i=h;i<b;i++)if(void 0!==d[i]&&(_=s=d[i],C=r,"string"==typeof(D=u)||"number"==typeof D?void 0!==_.splitText:"string"==typeof D.nodeName?!_._componentConstructor&&S(_,D.nodeName):C||_._componentConstructor===D.nodeName)){c=s,d[i]=void 0,i===b-1&&b--,i===h&&h++;break}c=W(c,u,n,o),a=l[y],c&&c!==e&&c!==a&&(null==a?e.appendChild(c):c===a.nextSibling?N(a):e.insertBefore(c,a))}var _,D,C;if(p)for(var y in f)void 0!==f[y]&&q(f[y],!1);for(;h<=b;)void 0!==(c=d[b--])&&q(c,!1)}(i,f,n,o,M||null!=d.dangerouslySetInnerHTML),function(e,t,n){var o;for(o in n)t&&null!=t[o]||null==n[o]||_(e,o,n[o],n[o]=void 0,C);for(o in t)"children"===o||"innerHTML"===o||o in n&&t[o]===("value"===o||"checked"===o?e[o]:n[o])||_(e,o,n[o],n[o]=t[o],C)}(i,t.attributes,d),C=s,i}function q(e,t){var n=e._component;n?z(n):(null!=e.__preactattr_&&v(e.__preactattr_.ref,null),!1!==t&&null!=e.__preactattr_||N(e),j(e))}function j(e){for(e=e.lastChild;e;){var t=e.previousSibling;q(e,!0),e=t}}var I=[];function R(e,t,n){var o,r=I.length;for(e.prototype&&e.prototype.render?(o=new e(t,n),F.call(o,t,n)):((o=new F(t,n)).constructor=e,o.render=L);r--;)if(I[r].constructor===e)return o.nextBase=I[r].nextBase,I.splice(r,1),o;return o}function L(e,t,n){return this.constructor(e,n)}function U(e,t,n,o,r){e._disable||(e._disable=!0,e.__ref=t.ref,e.__key=t.key,delete t.ref,delete t.key,void 0===e.constructor.getDerivedStateFromProps&&(!e.base||r?e.componentWillMount&&e.componentWillMount():e.componentWillReceiveProps&&e.componentWillReceiveProps(t,o)),o&&o!==e.context&&(e.prevContext||(e.prevContext=e.context),e.context=o),e.prevProps||(e.prevProps=e.props),e.props=t,e._disable=!1,0!==n&&(1!==n&&!1===i.syncComponentUpdates&&e.base?k(e):G(e,1,r)),v(e.__ref,e))}function G(e,t,n,o){if(!e._disable){var r,i,s,a=e.props,u=e.state,c=e.context,l=e.prevProps||a,d=e.prevState||u,f=e.prevContext||c,p=e.base,h=e.nextBase,m=p||h,b=e._component,v=!1,y=f;if(e.constructor.getDerivedStateFromProps&&(u=O(O({},u),e.constructor.getDerivedStateFromProps(a,u)),e.state=u),p&&(e.props=l,e.state=d,e.context=f,2!==t&&e.shouldComponentUpdate&&!1===e.shouldComponentUpdate(a,u,c)?v=!0:e.componentWillUpdate&&e.componentWillUpdate(a,u,c),e.props=a,e.state=u,e.context=c),e.prevProps=e.prevState=e.prevContext=e.nextBase=null,e._dirty=!1,!v){r=e.render(a,u,c),e.getChildContext&&(c=O(O({},c),e.getChildContext())),p&&e.getSnapshotBeforeUpdate&&(y=e.getSnapshotBeforeUpdate(l,d));var g,k,w=r&&r.nodeName;if("function"==typeof w){var _=x(r);(i=b)&&i.constructor===w&&_.key==i.__key?U(i,_,1,c,!1):(g=i,e._component=i=R(w,_,c),i.nextBase=i.nextBase||h,i._parentComponent=e,U(i,_,0,c,!1),G(i,1,n,!0)),k=i.base}else s=m,(g=b)&&(s=e._component=null),(m||1===t)&&(s&&(s._component=null),k=P(s,r,c,n||!p,m&&m.parentNode,!0));if(m&&k!==m&&i!==b){var D=m.parentNode;D&&k!==D&&(D.replaceChild(k,m),g||(m._component=null,q(m,!1)))}if(g&&z(g),(e.base=k)&&!o){for(var C=e,S=e;S=S._parentComponent;)(C=S).base=k;k._component=C,k._componentConstructor=C.constructor}}for(!p||n?E.push(e):v||e.componentDidUpdate&&e.componentDidUpdate(l,d,y);e._renderCallbacks.length;)e._renderCallbacks.pop().call(e);T||o||A()}}function z(e){var t=e.base;e._disable=!0,e.componentWillUnmount&&e.componentWillUnmount(),e.base=null;var n=e._component;n?z(n):t&&(null!=t.__preactattr_&&v(t.__preactattr_.ref,null),N(e.nextBase=t),I.push(e),j(t)),v(e.__ref,null)}function F(e,t){this._dirty=!0,this.context=t,this.props=e,this.state=this.state||{},this._renderCallbacks=[]}function B(e,t,n){return P(n,e,{},!1,t,!1)}function Y(e,n){var o=document.createElement("script"),t=document.getElementsByTagName("script")[0];o.async=1,o.onload=o.onreadystatechange=function(e,t){(t||!o.readyState||/loaded|complete/.test(o.readyState))&&(o.onload=o.onreadystatechange=null,o=void 0,t||n&&n())},o.onerror=function(e){n&&n(e)},o.src=e,t.parentNode.insertBefore(o,t)}O(F.prototype,{setState:function(e,t){this.prevState||(this.prevState=this.state),this.state=O(O({},this.state),"function"==typeof e?e(this.state,this.props):e),t&&this._renderCallbacks.push(t),k(this)},forceUpdate:function(e){e&&this._renderCallbacks.push(e),G(this,2)},render:function(){}});var H={currentVol:50,snoozed:!1},e=function(e){if(e.startTime<2)return H.snoozed&&(Dubtrack.room.player.setVolume(H.currentVol),H.snoozed=!1),!0},V=function(){!H.snoozed&&!Dubtrack.room.player.muted_player&&2<Dubtrack.playerController.volume?(H.currentVol=Dubtrack.playerController.volume,Dubtrack.room.player.mutePlayer(),H.snoozed=!0,Dubtrack.Events.bind("realtime:room_playlist-update",e)):H.snoozed&&(Dubtrack.room.player.setVolume(H.currentVol),Dubtrack.room.player.updateVolumeBar(),H.snoozed=!1)},X={position:"absolute",font:"1rem/1.5 proxima-nova,sans-serif",display:"block",left:"-33px",cursor:"pointer",borderRadius:"1.5rem",padding:"8px 16px",background:"#fff",fontWeight:"700",fontSize:"13.6px",textTransform:"uppercase",color:"#000",opacity:"0.8",textAlign:"center",zIndex:"9"},K=function(e){function i(){var e,t;s(this,i);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return u(l(l(t=d(this,(e=c(i)).call.apply(e,[this].concat(o))))),"state",{show:!1}),u(l(l(t)),"showTooltip",function(){t.setState({show:!0})}),u(l(l(t)),"hideTooltip",function(){t.setState({show:!1})}),t}return n(i,F),a(i,[{key:"render",value:function(e,t){return b("span",{className:"icon-mute snooze_btn",onClick:V,onMouseOver:this.showTooltip,onMouseOut:this.hideTooltip},t.show&&b("div",{className:"snooze_tooltip",style:X},"Mute current song"))}}]),i}();var J={position:"absolute",font:"1rem/1.5 proxima-nova,sans-serif",display:"block",left:"-33px",cursor:"pointer",borderRadius:"1.5rem",padding:"8px 16px",background:"#fff",fontWeight:"700",fontSize:"13.6px",textTransform:"uppercase",color:"#000",opacity:"0.8",textAlign:"center",zIndex:"9"},Q=function(e){function i(){var e,t;s(this,i);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return u(l(l(t=d(this,(e=c(i)).call.apply(e,[this].concat(o))))),"state",{show:!1,booth_time:""}),u(l(l(t)),"showTooltip",function(){var e=t.getEta();t.setState({show:!0,booth_time:e})}),u(l(l(t)),"hideTooltip",function(){t.setState({show:!1})}),t}return n(i,F),a(i,[{key:"getEta",value:function(){var e=parseInt(document.querySelector("#player-controller div.left ul li.infoContainer.display-block div.currentTime span.min").textContent),t=4*parseInt(document.querySelector(".queue-position").textContent)-4+e;return 0<=t?t:"You're not in the queue"}},{key:"render",value:function(e,t){return b("span",{className:"icon-history eta_tooltip_t",onMouseOver:this.showTooltip,onMouseOut:this.hideTooltip},this.state.show&&b("span",{className:"eta_tooltip",style:J},this.state.booth_time))}}]),i}();function Z(e){var t="open"===e.open?"down":"right";return b("div",{id:e.id,onClick:e.onClick,className:"dubplus-menu-section-header"},b("span",{className:"fa fa-angle-".concat(t)}),b("p",null,e.category))}var ee={menu:{general:"open","user-interface":"open",settings:"open",customize:"open",contact:"open"},options:{"dubplus-autovote":!1,"dubplus-emotes":!1,"dubplus-autocomplete":!1,mention_notifications:!1,dubplus_pm_notifications:!1,"dj-notification":!1,"dubplus-dubs-hover":!1,"dubplus-downdubs":!1,"dubplus-grabschat":!1,"dubplus-split-chat":!1,"dubplus-show-timestamp":!1,"dubplus-hide-bg":!1,"dubplus-hide-avatars":!1,"dubplus-chat-only":!1,"dubplus-video-only":!1,warn_redirect:!1,"dubplus-comm-theme":!1,"dubplus-afk":!1,"dubplus-snow":!1,"dubplus-custom-css":!1},custom:{customAfkMessage:"",dj_notification:1,css:""}},te=new(function(){function n(){s(this,n),u(this,"srcRoot","https://cdn.jsdelivr.net/gh/FranciscoG/DubPlus@preact-version");var e=localStorage.getItem("dubplusUserSettings");if(e)try{var t=JSON.parse(e);this.stored=Object.assign({},ee,t)}catch(e){this.stored=ee}else this.stored=ee}return a(n,[{key:"save",value:function(e,t,n){this.stored[e][t]=n;try{localStorage.setItem("dubplusUserSettings",JSON.stringify(this.stored))}catch(e){console.error("an error occured saving dubplus to localStorage",e)}}}]),n}()),ne=function(e){function t(){return s(this,t),d(this,c(t).apply(this,arguments))}return n(t,F),a(t,[{key:"componentDidUpdate",value:function(e){for(var t in e)if(e[t]!==this.props[t])return setTimeout(this.renderLayer)}},{key:"componentDidMount",value:function(){this.isMounted=!0,this.renderLayer=this.renderLayer.bind(this),this.renderLayer()}},{key:"componentWillUnmount",value:function(){this.renderLayer(!1),this.isMounted=!1,this.remote&&this.remote.parentNode.removeChild(this.remote)}},{key:"findNode",value:function(e){return"string"==typeof e?document.querySelector(e):e}},{key:"renderLayer",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];this.isMounted&&(this.props.into!==this.intoPointer&&(this.intoPointer=this.props.into,this.into&&this.remote&&(this.remote=B(b(oe,null),this.into,this.remote)),this.into=this.findNode(this.props.into)),this.remote=B(b(oe,{context:this.context},e&&this.props.children||null),this.into,this.remote))}},{key:"render",value:function(){return null}}]),t}(),oe=function(e){function t(){return s(this,t),d(this,c(t).apply(this,arguments))}return n(t,F),a(t,[{key:"getChildContext",value:function(){return this.props.context}},{key:"render",value:function(e){var t=e.children;return t&&t[0]||null}}]),t}(),re=function(e){function i(){var e,t;s(this,i);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return u(l(l(t=d(this,(e=c(i)).call.apply(e,[this].concat(o))))),"keyUpHandler",function(e){13===e.keyCode&&(t.props.onConfirm(t.textarea.value),t.props.onClose()),27===e.keyCode&&t.props.onClose()}),u(l(l(t)),"confirmClick",function(){t.props.onConfirm(t.textarea.value),t.props.onClose()}),t}return n(i,F),a(i,[{key:"componentDidMount",value:function(){document.addEventListener("keyup",this.keyUpHandler)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keyup",this.keyUpHandler)}},{key:"render",value:function(e){var t=this,n=e.onConfirm?"cancel":"close";return e.open?b(ne,{into:"body"},b("div",{className:"dp-modal"},b("aside",{className:"container"},b("div",{className:"title"},b("h1",null," ",e.title||"Dub+")),b("div",{className:"content"},b("p",null,e.content||""),e.placeholder&&b("textarea",{ref:function(e){return t.textarea=e},placeholder:e.placeholder,maxlength:e.maxlength||999},e.value||"")),b("div",{className:"dp-modal-buttons"},b("button",{id:"dp-modal-cancel",onClick:e.onClose},n),e.onConfirm&&b("button",{id:"dp-modal-confirm",onClick:this.confirmClick},"okay"))))):null}}]),i}(),ie=window.ga||function(){},se=new(function(){function t(e){s(this,t),ie("create",e,"auto","dubplusTracker")}return a(t,[{key:"event",value:function(e,t,n,o){ie("dubplusTracker.send","event",e,t,n,o)}},{key:"menuClick",value:function(e,t,n){this.event(e,"click",t,n)}}]),t}())("UA-116652541-1"),ae=function(e){function i(){var e,t;s(this,i);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return u(l(l(t=d(this,(e=c(i)).call.apply(e,[this].concat(o))))),"state",{open:!1}),u(l(l(t)),"loadModal",function(){t.setState({open:!0}),se.menuClick(t.props.section+" section",t.props.id+" edit")}),u(l(l(t)),"closeModal",function(){console.log("closing dub+ modal"),t.setState({open:!1})}),t}return n(i,F),a(i,[{key:"render",value:function(e,t){return b("span",{onClick:this.loadModal,className:"fa fa-pencil extra-icon"},b(re,{open:t.open,title:e.title||"Dub+ option",content:e.content||"Please enter a value",placeholder:e.placeholder||"in here",value:e.value,onConfirm:e.onConfirm,onClose:this.closeModal}))}}]),i}(),ue=function(e){function i(){var e,t;s(this,i);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return u(l(l(t=d(this,(e=c(i)).call.apply(e,[this].concat(o))))),"state",{on:te.stored.options[t.props.id]||!1}),u(l(l(t)),"switchOn",function(){t.props.turnOn(),te.save("options",t.props.id,!0),t.setState({on:!0}),se.menuClick(t.props.section+" section",t.props.id+" on")}),u(l(l(t)),"switchOff",function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];t.props.turnOff(),te.save("options",t.props.id,!1),t.setState({on:!1}),e||se.menuClick(t.props.section+" section",t.props.id+" off")}),u(l(l(t)),"toggleSwitch",function(){t.state.on?t.switchOff():t.switchOn()}),t}return n(i,F),a(i,[{key:"componentDidMount",value:function(){this.state.on&&this.props.turnOn()}},{key:"render",value:function(e,t){var n=["dubplus-switch"];return t.on&&n.push("dubplus-switch-on"),e.className&&n.push(e.className),b("li",{id:e.id,title:e.desc,className:n.join(" ")},e.children||null,b("div",{onClick:this.toggleSwitch,className:"dubplus-form-control"},b("div",{className:"dubplus-switch-bg"},b("div",{className:"dubplus-switcher"})),b("span",{className:"dubplus-menu-label"},e.menuTitle)))}}]),i}(),ce=function(e){function i(){var e,r;s(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return u(l(l(r=d(this,(e=c(i)).call.apply(e,[this].concat(n))))),"state",{canSend:!0}),u(l(l(r)),"afk_chat_respond",function(e){if(r.state.canSend){var t=e.message,n=Dubtrack.session.get("username");if(-1<t.indexOf("@"+n)&&Dubtrack.session.id!==e.user.userInfo.userid){var o=document.getElementById("chat-txt-message");te.stored.custom.customAfkMessage?o.value="[AFK] "+te.stored.custom.customAfkMessage:o.value="[AFK] I'm not here right now.",Dubtrack.room.chat.sendMessage(),r.setState({canSend:!1}),setTimeout(function(){r.setState({canSend:!0})},3e4)}}}),r}return n(i,F),a(i,[{key:"turnOn",value:function(){Dubtrack.Events.bind("realtime:chat-message",this.afk_chat_respond)}},{key:"turnOff",value:function(){Dubtrack.Events.unbind("realtime:chat-message",this.afk_chat_respond)}},{key:"saveAFKmessage",value:function(e){""!==e&&te.save("custom","customAfkMessage",e)}},{key:"render",value:function(e,t){return b(ue,{id:"dubplus-afk",section:"General",menuTitle:"AFK Auto-respond",desc:"Toggle Away from Keyboard and customize AFK message.",turnOn:this.turnOn,turnOff:this.turnOff},b(ae,{title:"Custom AFK Message",section:"General",content:"Enter a custom Away From Keyboard [AFK] message here",value:te.stored.custom.customAfkMessage||"",placeholder:"Be right back!",maxlength:"255",onConfirm:this.saveAFKmessage}))}}]),i}(),le=function(e){function t(){var r;return s(this,t),u(l(l(r=d(this,c(t).call(this)))),"advance_vote",function(){var e=document.createEvent("HTMLEvents");e.initEvent("click",!0,!1),r.dubup.dispatchEvent(e)}),u(l(l(r)),"voteCheck",function(e){e.startTime<2&&r.advance_vote()}),u(l(l(r)),"turnOn",function(e){var t=Dubtrack.room.player.activeSong.get("song"),n=Dubtrack.helpers.cookie.get("dub-"+Dubtrack.room.model.get("_id")),o=Dubtrack.helpers.cookie.get("dub-song");Dubtrack.room&&t&&t.songid===o||(n=!1),r.dubup.classList.contains("voted")||r.dubdown.classList.contains("voted")||n||r.advance_vote(),Dubtrack.Events.bind("realtime:room_playlist-update",r.voteCheck)}),u(l(l(r)),"turnOff",function(e){Dubtrack.Events.unbind("realtime:room_playlist-update",r.voteCheck)}),r.dubup=document.querySelector(".dubup"),r.dubdown=document.querySelector(".dubdown"),r}return n(t,F),a(t,[{key:"render",value:function(e,t){return b(ue,{id:"dubplus-autovote",section:"General",menuTitle:"Autovote",desc:"Toggles auto upvoting for every song",turnOn:this.turnOn,turnOff:this.turnOff})}}]),t}(),de=function(e){function i(){var e,t;s(this,i);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return u(l(l(t=d(this,(e=c(i)).call.apply(e,[this].concat(o))))),"state",{open:!1}),u(l(l(t)),"turnOn",function(e){}),u(l(l(t)),"turnOff",function(e){}),t}return n(i,F),a(i,[{key:"componentWillMount",value:function(){this.renderTo=document.querySelector(".pusher-chat-widget-input")}},{key:"render",value:function(e,t){var n=t.open;return b(ue,{id:"dubplus-emotes",section:"General",menuTitle:"Autocomplete Emoji",desc:"Quick find and insert emojis and emotes while typing in the chat input",turnOn:this.turnOn,turnOff:this.turnOff},n?b(ne,{into:this.renderTo}):null)}}]),i}(),fe=function(e){function i(){var e,t;s(this,i);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return u(l(l(t=d(this,(e=c(i)).call.apply(e,[this].concat(o))))),"customMentionCheck",function(e){var t=e.message;if(te.custom.custom_mentions){var n=te.custom.custom_mentions.split(",").some(function(e){return new RegExp("\\b"+e.trim()+"\\b","i").test(t)});Dubtrack.session.id!==e.user.userInfo.userid&&n&&Dubtrack.room.chat.mentionChatSound.play()}}),u(l(l(t)),"saveCustomMentions",function(e){""!==e&&te.save("custom","custom_mentions",e)}),t}return n(i,F),a(i,[{key:"turnOn",value:function(){Dubtrack.Events.bind("realtime:chat-message",this.customMentionCheck)}},{key:"turnOff",value:function(){Dubtrack.Events.unbind("realtime:chat-message",this.customMentionCheck)}},{key:"render",value:function(e,t){return b(ue,{id:"custom_mentions",section:"General",menuTitle:"Custom Mentions",desc:"Toggle using custom mentions to trigger sounds in chat",turnOn:this.turnOn,turnOff:this.turnOff},b(ae,{title:"Custom AFK Message",section:"General",content:"Add your custom mention triggers here (separate by comma)",value:te.stored.custom.custom_mentions||"",placeholder:"separate, custom triggers, by, comma, :heart:",maxlength:"255",onConfirm:this.saveCustomMentions}))}}]),i}(),pe=function(e){function i(){var e,t;s(this,i);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return u(l(l(t=d(this,(e=c(i)).call.apply(e,[this].concat(o))))),"chatCleanerCheck",function(e){var t=Array.from(document.querySelectorAll("ul.chat-main > li")),n=parseInt(te.stored.custom.chat_cleaner,10);if(!(isNaN(t.length)||isNaN(n)||!t.length||t.length<n)){var o=t[0].parentElement;t.slice(0,n).forEach(function(e,t){o.removeChild(e)}),$(".chat-messages").perfectScrollbar("update")}}),u(l(l(t)),"saveAmount",function(e){var t=parseInt(e,10),n=isNaN(t)?500:t;te.save("custom","chat_cleaner",n)}),u(l(l(t)),"turnOn",function(){Dubtrack.Events.bind("realtime:chat-message",t.chatCleanerCheck)}),u(l(l(t)),"turnOff",function(){Dubtrack.Events.unbind("realtime:chat-message",t.chatCleanerCheck)}),t}return n(i,F),a(i,[{key:"render",value:function(){return b(ue,{id:"chat-cleaner",section:"General",menuTitle:"Chat Cleaner",desc:"Automatically only keep a designated chatItems of chat items while clearing older ones, keeping CPU stress down",turnOn:this.turnOn,turnOff:this.turnOff},b(ae,{title:"Chat Cleaner",section:"General",content:"Please specify the number of most recent chat items that will remain in your chat history",value:te.stored.custom.chat_cleaner||"",placeholder:"500",maxlength:"5",onConfirm:this.saveAmount}))}}]),i}(),he=!0,me={denyDismiss:{title:"Desktop Notifications",content:"You have dismissed or chosen to deny the request to allow desktop notifications. Reset this choice by clearing your cache for the site."},noSupport:{title:"Desktop Notifications",content:"Sorry this browser does not support desktop notifications.  Please use the latest version of Chrome or FireFox"}};function be(e){var t="function"==typeof e?e:function(){};return"Notification"in window?"granted"===Notification.permission?t(!0,"granted"):"denied"===Notification.permission?t(!1,me.denyDismiss):void Notification.requestPermission().then(function(e){if("denied"!==e&&"default"!==e)return t(!0,"granted");t(!1,me.denyDismiss)}):t(!1,me.noSupport)}function ve(e){var t=Object.assign({},{title:"New Message",content:"",ignoreActiveTab:!1,callback:null,wait:5e3},e);if(!0!==he||t.ignoreActiveTab){var n={body:t.content,icon:"https://res.cloudinary.com/hhberclba/image/upload/c_lpad,h_100,w_100/v1400351432/dubtrack_new_logo_fvpxa6.png"},o=new Notification(t.title,n);o.onclick=function(){window.focus(),"function"==typeof t.callback&&t.callback(),o.close()},setTimeout(o.close.bind(o),t.wait)}}window.onfocus=function(){he=!0},window.onblur=function(){he=!1};var ye=function(e){function i(){var e,n;s(this,i);for(var t=arguments.length,o=new Array(t),r=0;r<t;r++)o[r]=arguments[r];return u(l(l(n=d(this,(e=c(i)).call.apply(e,[this].concat(o))))),"state",{showWarning:!1,warnTitle:"",warnContent:""}),u(l(l(n)),"turnOn",function(){be(function(e,t){!0===e?Dubtrack.Events.bind("realtime:chat-message",n.notifyOnMention):(n.switchRef.switchOff(!0),n.setState({showWarning:!0,warnTitle:t.title,warnContent:t.content}))})}),u(l(l(n)),"closeModal",function(){n.setState({showWarning:!1})}),u(l(l(n)),"turnOff",function(){Dubtrack.Events.unbind("realtime:chat-message",n.notifyOnMention)}),n}return n(i,F),a(i,[{key:"notifyOnMention",value:function(e){var t=e.message,n=["@"+Dubtrack.session.get("username").toLowerCase()];te.stored.options.custom_mentions&&te.stored.custom.custom_mentions&&(n=n.concat(te.stored.custom.custom_mentions.split(","))),n.some(function(e){return new RegExp("\\b"+e.trim()+"\\b","i").test(t)})&&!this.isActiveTab&&Dubtrack.session.id!==e.user.userInfo.userid&&ve({title:"Message from ".concat(e.user.username),content:t})}},{key:"render",value:function(e,t){var n=this;return b(ue,{ref:function(e){return n.switchRef=e},id:"mention_notifications",section:"General",menuTitle:"Notification on Mentions",desc:"Enable desktop notifications when a user mentions you in chat",turnOn:this.turnOn,turnOff:this.turnOff},b(re,{open:t.showWarning,title:t.warnTitle,content:t.warnContent,onClose:this.closeModal}))}}]),i}(),ge=function(e){function i(){var e,n;s(this,i);for(var t=arguments.length,o=new Array(t),r=0;r<t;r++)o[r]=arguments[r];return u(l(l(n=d(this,(e=c(i)).call.apply(e,[this].concat(o))))),"state",{showWarning:!1,warnTitle:"",warnContent:""}),u(l(l(n)),"turnOn",function(){be(function(e,t){!0===e?Dubtrack.Events.bind("realtime:new-message",n.notify):(n.switchRef.switchOff(!0),n.setState({showWarning:!0,warnTitle:t.title,warnContent:t.content}))})}),u(l(l(n)),"closeModal",function(){n.setState({showWarning:!1})}),u(l(l(n)),"turnOff",function(){Dubtrack.Events.unbind("realtime:new-message",n.notify)}),n}return n(i,F),a(i,[{key:"notify",value:function(e){Dubtrack.session.get("_id")!==e.userid&&ve({title:"You have a new PM",ignoreActiveTab:!0,callback:function(){document.querySelector(".user-messages").click(),setTimeout(function(){document.querySelector('.message-item[data-messageid="'.concat(e.messageid,'"]')).click()},500)},wait:1e4})}},{key:"render",value:function(e,t){var n=this;return b(ue,{ref:function(e){return n.switchRef=e},id:"dubplus_pm_notifications",section:"General",menuTitle:"Notification on PM",desc:"Enable desktop notifications when a user receives a private message",turnOn:this.turnOn,turnOff:this.turnOff},b(re,{open:t.showWarning,title:t.warnTitle,content:t.warnContent,onClose:this.closeModal}))}}]),i}(),ke=function(e){function i(){var e,r;s(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return u(l(l(r=d(this,(e=c(i)).call.apply(e,[this].concat(n))))),"state",{canNotify:!1}),u(l(l(r)),"savePosition",function(e){var t=parseInt(e,10),n=isNaN(t)?2:t;te.save("custom","dj_notification",n)}),u(l(l(r)),"djNotificationCheck",function(e){if(!(2<e.startTime)){var t=document.querySelector(".queue-position").textContent,n=parseInt(t,10),o=e.startTime<0&&!isNaN(n)?n-1:n;isNaN(n)||o!==te.stored.custom.dj_notification||(r.canNotify&&ve({title:"DJ Alert!",content:"You will be DJing shortly! Make sure your song is set!",ignoreActiveTab:!0,wait:1e4}),Dubtrack.room.chat.mentionChatSound.play())}}),u(l(l(r)),"turnOn",function(){be(function(e,t){!0===e&&r.setState({canNotify:!0})}),Dubtrack.Events.bind("realtime:room_playlist-update",r.djNotificationCheck)}),u(l(l(r)),"turnOff",function(){Dubtrack.Events.unbind("realtime:room_playlist-update",r.djNotificationCheck)}),r}return n(i,F),a(i,[{key:"render",value:function(e,t){var n=this;return b(ue,{ref:function(e){return n.switchRef=e},id:"dj-notification",section:"General",menuTitle:"DJ Notification",desc:"Notification when you are coming up to be the DJ",turnOn:this.turnOn,turnOff:this.turnOff},b(ae,{title:"DJ Notification",section:"General",content:"Please specify the position in queue you want to be notified at",value:te.stored.custom.dj_notification||"",placeholder:"2",maxlength:"2",onConfirm:this.savePosition}))}}]),i}(),we=function(e){function i(){var e,t;s(this,i);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return u(l(l(t=d(this,(e=c(i)).call.apply(e,[this].concat(o))))),"turnOn",function(){$.snowfall?t.doSnow():Y("https://cdn.jsdelivr.net/gh/loktar00/JQuery-Snowfall/src/snowfall.jquery.js",function(e){if(e)return t.switchRef.switchOff(!0),void console.error("Could not load snowfall jquery plugin",e);t.doSnow()})}),t}return n(i,F),a(i,[{key:"doSnow",value:function(){$(document).snowfall({round:!0,shadow:!0,flakeCount:50,minSize:1,maxSize:5,minSpeed:5,maxSpeed:5})}},{key:"turnOff",value:function(){$.snowfall&&$(document).snowfall("clear")}},{key:"render",value:function(){var t=this;return b(ue,{ref:function(e){return t.switchRef=e},id:"dubplus-snow",section:"General",menuTitle:"Snow",desc:"Make it snow!",turnOn:this.turnOn,turnOff:this.turnOff})}}]),i}(),_e={particles:[],drops:[],numbase:5,numb:2,height:0,controls:{rain:2,alpha:1,color:200,opacity:1,saturation:100,lightness:50,back:0,multi:!1,speed:1},init:function(){var e=document.createElement("canvas");e.id="dubPlusRainCanvas",e.style.cssText="position : fixed; top : 0px; left : 0px; z-index: 100; pointer-events:none;",document.body.insertBefore(e,document.body.childNodes[0]),this.bindCanvas()},destroy:function(){document.body.removeChild(document.getElementById("dubPlusRainCanvas")),this.unbindCanvas()},bindCanvas:function(){this.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)};var e=document.getElementById("dubPlusRainCanvas");if(e){var t=e.getContext("2d");this.width,this.height=0,window.onresize=function(){this.width=e.width=window.innerWidth,this.height=e.height=window.innerHeight},window.onresize(),this.particles,this.drops=[],this.numbase=5,this.numb=2;var n=this;!function e(){n.requestAnimFrame(e),n.update(),n.rendu(t)}()}},buildRainParticle:function(e,t,n){for(n||(n=this.numb);n--;)this.particles.push({speedX:.25*Math.random(),speedY:9*Math.random()+1,X:e,Y:t,alpha:1,color:"hsla("+this.controls.color+","+this.controls.saturation+"%, "+this.controls.lightness+"%,"+this.controls.opacity+")"})},explosion:function(e,t,n,o){for(o||(o=this.numbase);o--;)this.drops.push({speedX:4*Math.random()-2,speedY:-4*Math.random(),X:e,Y:t,radius:.65+Math.floor(1.6*Math.random()),alpha:1,color:n})},rendu:function(e){1==this.controls.multi&&(this.controls.color=360*Math.random()),e.save(),e.clearRect(0,0,width,height);for(var t,n=this.particles,o=this.drops,r=2*Math.PI,i=0;t=n[i];i++)e.globalAlpha=t.alpha,e.fillStyle=t.color,e.fillRect(t.X,t.Y,t.speedY/4,t.speedY);var s;for(i=0;s=o[i];i++)e.globalAlpha=s.alpha,e.fillStyle=s.color,e.beginPath(),e.arc(s.X,s.Y,s.radius,0,r),e.fill();e.strokeStyle="white",e.lineWidth=2,e.restore()},update:function(){for(var e,t=this.particles,n=this.drops,o=0;e=t[o];o++)e.X+=e.speedX,e.Y+=e.speedY+5,e.Y>height-15&&(t.splice(o--,1),this.explosion(e.X,e.Y,e.color));var r;for(o=0;r=n[o];o++)r.X+=r.speedX,r.Y+=r.speedY,r.radius-=.075,0<r.alpha?r.alpha-=.005:r.alpha=0,r.radius<0&&n.splice(o--,1);for(o=this.controls.rain;o--;)this.buildRainParticle(Math.floor(Math.random()*width),-15)},unbindCanvas:function(){this.requestAnimFrame=function(){}}},De=function(e){function t(){return s(this,t),d(this,c(t).apply(this,arguments))}return n(t,F),a(t,[{key:"turnOn",value:function(){_e.init()}},{key:"turnOff",value:function(){_e.destroy()}},{key:"render",value:function(e,t){return b(ue,{id:"dubplus-rain",section:"General",menuTitle:"Rain",desc:"Make it rain!",turnOn:this.turnOn,turnOff:this.turnOff})}}]),t}();function Ce(r){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(t,n){var o=new XMLHttpRequest;for(var e in i)i.hasOwnProperty(e)&&o.setRequestHeader(e,i[e]);o.onload=function(){try{var e=JSON.parse(o.responseText);t(e)}catch(e){n(e)}},o.onerror=function(){n()},o.open("GET",r),o.send()})}function Se(e){return Dubtrack.helpers.isDubtrackAdmin(e)||Dubtrack.room.users.getIfOwner(e)||Dubtrack.room.users.getIfManager(e)||Dubtrack.room.users.getIfMod(e)}var Oe=function(e){var t=e.data,n=e.click;return b("li",{onClick:function(){return n("@"+t.username+" ")},className:"dubinfo-preview-item"},b("div",{className:"dubinfo-image"},b("img",{src:"https://api.dubtrack.fm/user/".concat(t.userid,"/image")})),b("span",{className:"dubinfo-text"},"@",t.username))},xe=function(e){function t(){return s(this,t),d(this,c(t).apply(this,arguments))}return n(t,F),a(t,[{key:"getBgColor",value:function(){var e,t=this.props.type.replace("dubs","");if("up"===t)e=document.querySelector(".dubup");else{if("down"!==t)return;e=document.querySelector(".dubdown")}return e.classList.contains("voted")?window.getComputedStyle(e).backgroundColor:window.getComputedStyle(e.querySelector(".icon-".concat(t,"vote"))).color}},{key:"updateChat",value:function(e){var t=document.getElementById("chat-txt-message");t.value=e,t.focus()}},{key:"makeList",value:function(){var n=this;return this.props.dubs.map(function(e,t){return b(Oe,{data:e,click:n.updateChat,key:"info-".concat(n.props.type,"-").concat(t)})})}},{key:"render",value:function(e){var t=e.type,n=e.isMod,o="No ".concat(t," have been casted yet!");"grabs"===t&&(o="This song hasn't been grabbed yet!");var r=this.makeList(),i=["dubinfo-preview","dubinfo-".concat(t)];return 0===r.length&&(r=b("li",{className:"dubinfo-preview-none"},o),i.push("dubinfo-no-dubs")),"downdubs"!==t||n||i.push("dubinfo-unauthorized"),b("ul",{style:{borderColor:this.getBgColor()},className:i.join(" ")},r)}}]),t}(),Ne=function(e){function r(){var e,i;s(this,r);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return u(l(l(i=d(this,(e=c(r)).call.apply(e,[this].concat(n))))),"state",{isOn:!1,showWarning:!0,upDubs:[],downDubs:[],grabs:[]}),u(l(l(i)),"userIsMod",Se(Dubtrack.session.id)),u(l(l(i)),"turnOn",function(){i.setState({isOn:!0},i.resetDubs),Dubtrack.Events.bind("realtime:room_playlist-dub",i.dubWatcher),Dubtrack.Events.bind("realtime:room_playlist-queue-update-grabs",i.grabWatcher),Dubtrack.Events.bind("realtime:user-leave",i.dubUserLeaveWatcher),Dubtrack.Events.bind("realtime:room_playlist-update",i.resetDubs),Dubtrack.Events.bind("realtime:room_playlist-update",i.resetGrabs)}),u(l(l(i)),"turnOff",function(){i.setState({isOn:!1}),Dubtrack.Events.unbind("realtime:room_playlist-dub",i.dubWatcher),Dubtrack.Events.unbind("realtime:room_playlist-queue-update-grabs",i.grabWatcher),Dubtrack.Events.unbind("realtime:user-leave",i.dubUserLeaveWatcher),Dubtrack.Events.unbind("realtime:room_playlist-update",i.resetDubs),Dubtrack.Events.unbind("realtime:room_playlist-update",i.resetGrabs)}),u(l(l(i)),"closeModal",function(){i.setState({showWarning:!1})}),u(l(l(i)),"dubWatcher",function(t){var e=i.state,n=e.upDubs,o=e.downDubs,r={userid:t.user._id,username:t.user.username};"updub"===t.dubtype&&(0===n.filter(function(e){return e.userid===t.user._id}).length&&i.setState(function(e){return{upDubs:[].concat(f(e.upDubs),[r])}}),0<o.filter(function(e){return e.userid===t.user._id}).length&&i.setState(function(e){return{downDubs:e.downDubs.filter(function(e){return e.userid!==t.user._id})}}));"downdub"===t.dubtype&&(0===o.filter(function(e){return e.userid===t.user._id}).length&&i.userIsMod&&i.setState(function(e){return{downDubs:[].concat(f(e.downDubs),[r])}}),0<n.filter(function(e){return e.userid===t.user._id}).length&&i.setState(function(e){return{upDubs:e.upDubs.filter(function(e){return e.userid!==t.user._id})}}))}),u(l(l(i)),"grabWatcher",function(t){if(i.state.grabs.filter(function(e){return e.userid===t.user._id}).length<=0){var n={userid:t.user._id,username:t.user.username};i.setState(function(e){return{grabs:[].concat(f(e.grabs),[n])}})}}),u(l(l(i)),"dubUserLeaveWatcher",function(t){var e=i.state.upDubs.filter(function(e){return e.userid!==t.user._id}),n=i.state.downDubs.filter(function(e){return e.userid!==t.user._id}),o=i.state.grabs.filter(function(e){return e.userid!==t.user._id});i.setState({upDubs:e,downDubs:n,grabs:o})}),u(l(l(i)),"resetDubs",function(){i.setState({upDubs:[],downDubs:[]},i.handleReset)}),u(l(l(i)),"resetGrabs",function(){i.setState({grabs:[]})}),i}return n(r,F),a(r,[{key:"handleReset",value:function(){var r=this;Ce("https://api.dubtrack.fm/room/".concat(Dubtrack.room.model.id,"/playlist/active/dubs")).then(function(e){e.data&&e.data.upDubs&&e.data.upDubs.forEach(function(o){if(!(0<r.state.upDubs.filter(function(e){return e.userid===o.userid}).length)){var e=Dubtrack.room.users.collection.findWhere({userid:o.userid});if(e&&e.attributes){if(e.attributes._user.username){var t={userid:o.userid,username:e.attributes._user.username};r.setState(function(e){return{upDubs:[].concat(f(e.upDubs),[t])}})}}else Ce("https://api.dubtrack.fm/user/"+o.userid).then(function(e){var t=e.data;if(t&&t.userinfo&&t.userinfo.username){var n={userid:o.userid,username:t.userinfo.username};r.setState(function(e){return{upDubs:[].concat(f(e.upDubs),[n])}})}})}}),e.data&&e.data.downDubs&&r.userIsMod&&e.data.downDubs.forEach(function(o){if(!(0<r.state.downDubs.filter(function(e){return e.userid===o.userid}).length)){var e=Dubtrack.room.users.collection.findWhere({userid:o.userid});if(e&&e.attributes){if(e.attributes._user.username){var t={userid:o.userid,username:e.attributes._user.username};r.setState(function(e){return{downDubs:[].concat(f(e.downDubs),[t])}})}}else Ce("https://api.dubtrack.fm/user/"+o.userid).then(function(e){var t=e.data;if(t&&t.userinfo&&t.userinfo.username){var n={userid:o.userid,username:t.userinfo.username};r.setState(function(e){return{downDubs:[].concat(f(e.downDubs),[n])}})}})}})})}},{key:"componentWillMount",value:function(){this.upElem=document.querySelector(".dubup").parentElement,this.upElem.classList.add("dubplus-updub-btn"),this.downElem=document.querySelector(".dubdown").parentElement,this.downElem.classList.add("dubplus-downdub-btn"),this.grabElem=document.querySelector(".add-to-playlist-button").parentElement,this.grabElem.classList.add("dubplus-grab-btn")}},{key:"render",value:function(e,t){return b(ue,{id:"dubplus-dubs-hover",section:"General",menuTitle:"Show Dub info on Hover",desc:"Show Dub info on Hover.",turnOn:this.turnOn,turnOff:this.turnOff},b(re,{open:t.showWarning,title:"Vote & Grab Info",content:"Please note that this feature is currently still in development. We are waiting on the ability to pull grab vote information from Dubtrack on load. Until then the only grabs you will be able to see are those you are present in the room for.",onClose:this.closeModal}),t.isOn?b("span",null,b(ne,{into:this.upElem},b(xe,{type:"updubs",dubs:t.upDubs})),b(ne,{into:this.downElem},b(xe,{type:"downdubs",isMod:this.userIsMod,dubs:t.downDubs})),b(ne,{into:this.grabElem},b(xe,{type:"grabs",dubs:t.grabs}))):null)}}]),r}();var Ee=function(e){function t(){return s(this,t),d(this,c(t).apply(this,arguments))}return n(t,F),a(t,[{key:"turnOn",value:function(){Se(Dubtrack.session.id)&&Dubtrack.Events.bind("realtime:room_playlist-dub",this.downdubWatcher)}},{key:"turnOff",value:function(){Dubtrack.Events.unbind("realtime:room_playlist-dub",this.downdubWatcher)}},{key:"downdubWatcher",value:function(e){if(Dubtrack.session.get("username")===Dubtrack.room.users.collection.findWhere({userid:Dubtrack.room.player.activeSong.attributes.song.userid}).attributes._user.username&&"downdub"===e.dubtype){var t=function(e,t){var n=document.createElement("li");n.className="dubplus-chat-system dubplus-chat-system-downdub";var o=document.createElement("div");o.className="chatDelete",o.onclick=function(e){return e.currentTarget.parentElement.remove()};var r=document.createElement("span");r.className="icon-close";var i=document.createElement("div");return i.className="text",i.textContent="@".concat(e," has downdubbed your song ").concat(t),o.appendChild(r),n.appendChild(o),n.appendChild(i),n}(e.user.username,Dubtrack.room.player.activeSong.attributes.songInfo.name);document.querySelector("ul.chat-main").appendChild(t)}}},{key:"render",value:function(){return b(ue,{id:"dubplus-downdubs",section:"General",menuTitle:"Downdubs in Chat (mods only)",desc:"Toggle showing downdubs in the chat box (mods only)",turnOn:this.turnOn,turnOff:this.turnOff})}}]),t}();var Te=function(e){function t(){return s(this,t),d(this,c(t).apply(this,arguments))}return n(t,F),a(t,[{key:"turnOn",value:function(){Dubtrack.Events.bind("realtime:room_playlist-dub",this.updubWatcher)}},{key:"turnOff",value:function(){Dubtrack.Events.unbind("realtime:room_playlist-dub",this.updubWatcher)}},{key:"updubWatcher",value:function(e){if(Dubtrack.session.get("username")===Dubtrack.room.users.collection.findWhere({userid:Dubtrack.room.player.activeSong.attributes.song.userid}).attributes._user.username&&"updub"===e.dubtype){var t=function(e,t){var n=document.createElement("li");n.className="dubplus-chat-system dubplus-chat-system-updub";var o=document.createElement("div");o.className="chatDelete",o.onclick=function(e){return e.currentTarget.parentElement.remove()};var r=document.createElement("span");r.className="icon-close";var i=document.createElement("div");return i.className="text",i.textContent="@".concat(e," has updubbed your song ").concat(t),o.appendChild(r),n.appendChild(o),n.appendChild(i),n}(e.user.username,Dubtrack.room.player.activeSong.attributes.songInfo.name);document.querySelector("ul.chat-main").appendChild(t)}}},{key:"render",value:function(){return b(ue,{id:"dubplus-updubs",section:"General",menuTitle:"Updubs in Chat",desc:"Toggle showing updubs in the chat box",turnOn:this.turnOn,turnOff:this.turnOff})}}]),t}();var Me=function(e){function t(){return s(this,t),d(this,c(t).apply(this,arguments))}return n(t,F),a(t,[{key:"turnOn",value:function(){Dubtrack.Events.bind("realtime:room_playlist-queue-update-grabs",this.grabChatWatcher)}},{key:"turnOff",value:function(){Dubtrack.Events.unbind("realtime:room_playlist-queue-update-grabs",this.grabChatWatcher)}},{key:"grabChatWatcher",value:function(e){if(Dubtrack.session.get("username")===Dubtrack.room.users.collection.findWhere({userid:Dubtrack.room.player.activeSong.attributes.song.userid}).attributes._user.username&&!Dubtrack.room.model.get("displayUserGrab")){var t=function(e,t){var n=document.createElement("li");n.className="dubplus-chat-system dubplus-chat-system-grab";var o=document.createElement("div");o.className="chatDelete",o.onclick=function(e){return e.currentTarget.parentElement.remove()};var r=document.createElement("span");r.className="icon-close";var i=document.createElement("div");return i.className="text",i.textContent="@".concat(e," has grabbed your song ").concat(t),o.appendChild(r),n.appendChild(o),n.appendChild(i),n}(e.user.username,Dubtrack.room.player.activeSong.attributes.songInfo.name);document.querySelector("ul.chat-main").appendChild(t)}}},{key:"render",value:function(){return b(ue,{id:"dubplus-grabschat",section:"General",menuTitle:"Grabs in Chat",desc:"Toggle showing grabs in the chat box",turnOn:this.turnOn,turnOff:this.turnOff})}}]),t}(),Ae=function(e){function i(){var e,t;s(this,i);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return u(l(l(t=d(this,(e=c(i)).call.apply(e,[this].concat(o))))),"state",{section:te.stored.general||"open"}),u(l(l(t)),"toggleSection",function(e){t.setState(function(e){var t="open"===e.section?"closed":"open";return te.save("menu","general",t),{section:t}})}),t}return n(i,F),a(i,[{key:"render",value:function(e,t){var n=["dubplus-menu-section"];return"closed"===t.section&&n.push("dubplus-menu-section-closed"),b("span",null,b(Z,{onClick:this.toggleSection,id:"dubplus-general",category:"General",open:t.section}),b("ul",{className:n.join(" ")},b(le,null),b(ce,null),b(de,null),b(fe,null),b(pe,null),b(ye,null),b(ge,null),b(ke,null),b(Ne,null),b(Ee,null),b(Te,null),b(Me,null),b(we,null),b(De,null)))}}]),i}(),Pe=function(e){function t(){return s(this,t),d(this,c(t).apply(this,arguments))}return n(t,F),a(t,[{key:"componentDidMount",value:function(){setTimeout(function(){B(b(K,null),document.querySelector(".player_sharing")),B(b(Q,null),document.querySelector(".player_sharing"))},10)}},{key:"render",value:function(e,t){return b("section",{className:"dubplus-menu"},b("p",{className:"dubplus-menu-header"},"Dub+ Options"),b(Ae,null))}}]),t}();function We(e,t){for(var n=e.split("."),o=n.length,r=t||window,i=0;i<o;i++){if(void 0===r[n[i]])return!1;r=r[n[i]]}return!0}function qe(e,t){for(var n=e.length,o=t||window,r=0;r<n;r++)if(!We(e[r],o))return console.log(e[r],"is not found yet"),!1;return!0}function je(t,e){if("string"==typeof t||Array.isArray(t)){var n=function(){},o=function(){},r=Array.isArray(t)?qe:We,i=Object.assign({},{interval:500,seconds:15},e),s=0,a=1e3*i.seconds/i.interval,u=function e(){return s++,r(t)?n():s<a?void window.setTimeout(e,i.interval):o()};return{then:function(e){return"function"==typeof e&&(n=e),window.setTimeout(u,i.interval),this},fail:function(e){return"function"==typeof e&&(o=e),this}}}console.warn("WaitFor: invalid first argument")}var Ie={fontFamily:"'Trebuchet MS', Helvetica, sans-serif",zIndex:"2147483647",color:"white",position:"fixed",top:"69px",right:"-250px",background:"#222",padding:"10px",lineHeight:1,boxShadow:"0px 0px 5px 0px rgba(0,0,0,0.75)",borderRadius:"5px",overflow:"hidden",width:"230px",transition:"right 200ms"},Re={float:"left",width:"26px",marginRight:"5px"},Le={display:"table-cell",width:"10000px",paddingTop:"5px"},Ue=function(e){function i(){var e,t;s(this,i);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return u(l(l(t=d(this,(e=c(i)).call.apply(e,[this].concat(o))))),"state",{mainStyles:Ie}),t}return n(i,F),a(i,[{key:"componentDidMount",value:function(){var e=this;setTimeout(function(){e.setState(function(e,t){return{mainStyles:Object.assign({},e.mainStyles,{right:"13px"})}})},200)}},{key:"componentWillUnmount",value:function(){this.setState(function(e,t){return{mainStyles:Object.assign({},e.mainStyles,{right:"-250px"})}})}},{key:"render",value:function(e,t){return b("div",{style:t.mainStyles},b("div",{style:Re},b("img",{src:te.srcRoot+"/images/dubplus.svg",alt:"DubPlus icon"})),b("span",{style:Le},e.text||"Waiting for Dubtrack..."))}}]),i}(),Ge=function(e,t){var n=document.createElement("link");return n.rel="stylesheet",n.type="text/css",n.className=e||"",n.href=t,n};var ze={load:function(e,t){if(e){var n=Ge(t,te.srcRoot+e+"?1548542059323");document.head.appendChild(n)}},loadExternal:function(e,t){if(e){var n=Ge(t,e);document.head.appendChild(n)}}},Fe=function(e){function i(){var e,t;s(this,i);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return u(l(l(t=d(this,(e=c(i)).call.apply(e,[this].concat(o))))),"state",{open:!1}),u(l(l(t)),"toggle",function(){var e=document.querySelector(".dubplus-menu");t.state.open?(e.classList.remove("dubplus-menu-open"),t.setState({open:!1})):(e.classList.add("dubplus-menu-open"),t.setState({open:!0}))}),t}return n(i,F),a(i,[{key:"render",value:function(e,t){return b("div",{className:"dubplus-icon",onClick:this.toggle},b("img",{src:"".concat(te.srcRoot,"/images/dubplus.svg"),alt:"DubPlus Icon"}))}}]),i}();[Element.prototype,CharacterData.prototype,DocumentType.prototype].forEach(function(e){e.hasOwnProperty("remove")||Object.defineProperty(e,"remove",{configurable:!0,enumerable:!0,writable:!0,value:function(){null!==this.parentNode&&this.parentNode.removeChild(this)}})}),"undefined"==typeof Promise&&Y("https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.auto.min.js"),setTimeout(function(){ze.loadExternal("https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"),ze.load("/css/dubplus.css")},1),B(b(function(e){function i(){var e,t;s(this,i);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return u(l(l(t=d(this,(e=c(i)).call.apply(e,[this].concat(o))))),"state",{loading:!0,error:!1,errorMsg:"",failed:!1}),t}return n(i,F),a(i,[{key:"componentDidMount",value:function(){var e=this;if(window.DubPlus)Dubtrack.session.id?this.showError("Dub+ is already loaded"):this.showError("You're not logged in. Please login to use Dub+.");else{new je(["Dubtrack.session.id","Dubtrack.room.chat","Dubtrack.Events","Dubtrack.room.player","Dubtrack.helpers.cookie","Dubtrack.room.model","Dubtrack.room.users"],{seconds:120}).then(function(){e.setState({loading:!1,error:!1})}).fail(function(){Dubtrack.session.id?(e.showError("Something happed, refresh and try again"),se.event("Dub+ lib","load","failed")):e.showError("You're not logged in. Please login to use Dub+.")})}}},{key:"showError",value:function(e){this.setState({loading:!1,error:!0,errorMsg:e})}},{key:"render",value:function(e,t){var n=this;return t.loading?b(Ue,null):t.error?b(re,{title:"Dub+ Error",onClose:function(){n.setState({failed:!0,error:!1})},content:t.errorMsg}):t.failed?null:(document.querySelector("html").classList.add("dubplus"),b(Pe,null))}}]),i}(),null),document.body),B(b(Fe,null),document.querySelector(".header-right-navigation"));return{version:"2.0.0",description:"Dub+ - A simple script/extension for Dubtrack.fm",license:"MIT",bugs:"https://github.com/DubPlus/DubPlus/issues"}}();
