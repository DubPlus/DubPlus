(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';var _waitFor=require('./utils/waitFor.js'),_waitFor2=_interopRequireDefault(_waitFor),_preload=require('./utils/preload.js'),_preload2=_interopRequireDefault(_preload);function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}var modal=require('./utils/modal.js'),init=require('./lib/init.js'),css=require('./utils/css.js');if(!window.dubplus&&Dubtrack.session.id){(0,_preload2.default)();var checkList=['Dubtrack.room.chat','Dubtrack.Events','Dubtrack.room.player','Dubtrack.helpers.cookie','Dubtrack.room.model','Dubtrack.room.users'],_dubplusWaiting=new _waitFor2.default(checkList,{seconds:10});_dubplusWaiting.then(function(){init(),$('.dubplus-waiting').remove()}).fail(function(){$('.dubplus-waiting span').text('Something happed, refresh and try again')})}else{var errorMsg;Dubtrack.session.id?errorMsg='Dub+ is already loaded':(css.load('/css/dubplus.css'),errorMsg='You\'re not logged in. Please login to use Dub+.'),modal.create({title:'Dub+ Error',content:errorMsg})}

},{"./lib/init.js":4,"./utils/css.js":36,"./utils/modal.js":38,"./utils/preload.js":42,"./utils/waitFor.js":43}],2:[function(require,module,exports){
'use strict';var GetJSON=require('../utils/getJSON.js'),settings=require('../lib/settings.js'),prepEmoji={};prepEmoji.emoji={template:function template(a){return emojify.defaultConfig.img_dir+'/'+encodeURI(a)+'.png'}},prepEmoji.twitch={template:function template(a){return'//static-cdn.jtvnw.net/emoticons/v1/'+a+'/3.0'},specialEmotes:[],emotes:{},chatRegex:/:([-_a-z0-9]+):/ig},prepEmoji.bttv={template:function template(a){return'//cdn.betterttv.net/emote/'+a+'/3x'},emotes:{},chatRegex:/:([&!()\-_a-z0-9]+):/ig},prepEmoji.tasty={template:function template(a){return this.emotes[a].url},emotes:{}},prepEmoji.shouldUpdateAPIs=function(a){var c=localStorage.getItem(a+'_api');if(c){var d=JSON.parse(c);if('undefined'!=typeof d.error)return!0}var e=Date.now(),f=parseInt(localStorage.getItem(a+'_api_timestamp'));return isNaN(f)||e-f>5*8.64e7||!c},prepEmoji.loadTwitchEmotes=function(){var a=this,b;if(this.shouldUpdateAPIs('twitch')){console.log('dub+','twitch','loading from api');var c=new GetJSON('https://api.twitch.tv/kraken/chat/emoticon_images','twitch:loaded',{'Client-ID':'5vhafslpr2yqal6715puzysmzrntmt8'});c.done(function(e){localStorage.setItem('twitch_api_timestamp',Date.now().toString()),localStorage.setItem('twitch_api',e),a.processTwitchEmotes(JSON.parse(e))})}else{console.log('dub+','twitch','loading from localstorage'),b=JSON.parse(localStorage.getItem('twitch_api')),this.processTwitchEmotes(b),b=null;var d=new Event('twitch:loaded');window.dispatchEvent(d)}},prepEmoji.loadBTTVEmotes=function(){var a=this,b;if(this.shouldUpdateAPIs('bttv')){console.log('dub+','bttv','loading from api');var c=new GetJSON('//api.betterttv.net/2/emotes','bttv:loaded');c.done(function(e){localStorage.setItem('bttv_api_timestamp',Date.now().toString()),localStorage.setItem('bttv_api',e),a.processBTTVEmotes(JSON.parse(e))})}else{console.log('dub+','bttv','loading from localstorage'),b=JSON.parse(localStorage.getItem('bttv_api')),this.processBTTVEmotes(b),b=null;var d=new Event('bttv:loaded');window.dispatchEvent(d)}},prepEmoji.loadTastyEmotes=function(){var a=this;console.log('dub+','tasty','loading from api');var b=new GetJSON(settings.srcRoot+'/emotes/tastyemotes.json','tasty:loaded');b.done(function(c){localStorage.setItem('tasty_api',c),a.processTastyEmotes(JSON.parse(c))})},prepEmoji.processTwitchEmotes=function(a){var b=this;a.emoticons.forEach(function(c){var d=c.code.toLowerCase();return 0<=c.code.indexOf('\\')?void b.twitch.specialEmotes.push([c.code,c.id]):void(0<=emojify.emojiNames.indexOf(d)||(b.twitch.emotes[d]?null===c.emoticon_set&&(b.twitch.emotes[d]=c.id):b.twitch.emotes[d]=c.id))}),this.twitchJSONSLoaded=!0,this.emojiEmotes=emojify.emojiNames.concat(Object.keys(this.twitch.emotes))},prepEmoji.processBTTVEmotes=function(a){var b=this;a.emotes.forEach(function(c){var d=c.code.toLowerCase();0<=c.code.indexOf(':')||0<=emojify.emojiNames.indexOf(d)||(0<=c.code.indexOf('(')&&(d=d.replace(/([()])/g,'')),b.bttv.emotes[d]=c.id)}),this.bttvJSONSLoaded=!0,this.emojiEmotes=this.emojiEmotes.concat(Object.keys(this.bttv.emotes))},prepEmoji.processTastyEmotes=function(a){this.tasty.emotes=a.emotes,this.tastyJSONLoaded=!0,this.emojiEmotes=this.emojiEmotes.concat(Object.keys(this.tasty.emotes))},module.exports=prepEmoji;

},{"../lib/settings.js":7,"../utils/getJSON.js":37}],3:[function(require,module,exports){
"use strict";var textChoice="",currentData,setData=function(a){currentData=a};function repl(a,b,c,e){return a.substring(0,b-1)+e+a.substring(c)}var updateChatInput=function(a,b,c){var e=$("#chat-txt-message").val(),f=repl(e,a,b,c||textChoice)+" ";$("#autocomplete-preview").empty().removeClass("ac-show"),$("#chat-txt-message").val(f).focus()},doNavigate=function(a){var b=$(".preview-item.selected").index();b+=a;var c=$(".ac-show li");$(".ac-list-press-enter").remove(),b>=c.length&&(b=0),0>b&&(b=c.length-1);var e="selected";c.removeClass(e).eq(b).addClass(e).append("<span class=\"ac-list-press-enter\">press enter to select</span>");var g=$(".preview-item.selected");g.get(0).scrollIntoView(!1),textChoice=g.find(".ac-text").text()},display=function(a){function b(k){var l=document.createElement("li");return l.className=k,l}function c(k,l){var m=document.createElement("img");m.src=k,l&&(m.title=l,m.alt=l);var n=document.createElement("div");return n.className="ac-image",n.appendChild(m),n}function e(k){var l=document.createElement("span");return l.textContent=k,l.className="ac-text",l}function f(){var k=document.createElement("span");return k.textContent="press enter to select",k.className="ac-list-press-enter",k}function g(k,l){var o,m=b("preview-item "+k.cn+"-previews"),n=e(k.text);return o=k.alt?c(k.src,k.alt):c(k.src),m.appendChild(o),m.appendChild(n),0===l&&(m.appendChild(f()),m.classList.add("selected")),m.tabIndex=-1,m}var h=document.getElementById("autocomplete-preview");h.innerHTML="";var j=document.createDocumentFragment();a.forEach(function(k,l){j.appendChild(g(k,l))}),h.appendChild(j),h.classList.add("ac-show")},updater=function(){var a=$(this).find(".ac-text").text();updateChatInput(currentData.strStart,currentData.strEnd,a)},init=function(){var a=document.createElement("ul");a.id="autocomplete-preview",$(".pusher-chat-widget-input").prepend(a),$(document.body).on("click",".preview-item",updater)},stop=function(){$(document.body).off("click",".preview-item",updater),$("#autocomplete-preview").remove()};module.exports={init:init,stop:stop,display:display,updateChatInput:updateChatInput,doNavigate:doNavigate,setData:setData};

},{}],4:[function(require,module,exports){
(function (PKGINFO){
'use strict';var _loadModules=require('./loadModules.js'),_loadModules2=_interopRequireDefault(_loadModules),_snooze=require('../modules/snooze.js'),_snooze2=_interopRequireDefault(_snooze),_eta=require('../modules/eta.js'),_eta2=_interopRequireDefault(_eta);function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}var css=require('../utils/css.js'),menu=require('./menu.js');module.exports=function(){window.dubplus=JSON.parse(PKGINFO),css.load('/css/dubplus.css'),$('html').addClass('dubplus');var a=menu.beginMenu(),b=(0,_loadModules2.default)();menu.finishMenu(b,a),(0,_snooze2.default)(),(0,_eta2.default)(),$('.dubplus-menu').perfectScrollbar()};

}).call(this,'{"name":"DubPlus","version":"0.1.0","description":"Dub+ - A simple script/extension for Dubtrack.fm","author":"DubPlus","license":"MIT","homepage":"https://dub.plus"}')
},{"../modules/eta.js":18,"../modules/snooze.js":30,"../utils/css.js":36,"./loadModules.js":5,"./menu.js":6}],5:[function(require,module,exports){
'use strict';Object.defineProperty(exports,'__esModule',{value:!0});var options=require('../utils/options.js'),dubPlus_modules=require('../modules/index.js'),settings=require('../lib/settings.js'),menu=require('../lib/menu.js'),menuObj={General:'','User Interface':'',Settings:'',Customize:''},loadAllModules=function(){return dubPlus_modules.forEach(function(a){window.dubplus[a.id]=a,window.dubplus[a.id].toggleAndSave=options.toggleAndSave,a.optionState=settings.options[a.id]||!1,$('body').on('click','#'+a.id,function(c){if(c.target.classList.contains('extra-icon')&&a.extra)return void a.extra.call(a);if(a.turnOn&&a.turnOff){var d;return a.optionState?(d=!1,a.turnOff.call(a)):(d=!0,a.turnOn.call(a)),a.optionState=d,void options.toggleAndSave(a.id,d)}a.go&&a.go.call(a)}),'function'==typeof a.init&&a.init.call(a),a.optionState&&'function'==typeof a.turnOn&&a.turnOn.call(a);var b=null;'function'!=typeof a.extra||a.extraIcon||(b='pencil'),menuObj[a.category]+=menu.makeOptionMenu(a.moduleName,{id:a.id,desc:a.description,state:a.optionState,extraIcon:a.extraIcon||b,cssClass:a.menuCssClass||'',altIcon:a.altIcon||null})}),menuObj};exports.default=loadAllModules;

},{"../lib/menu.js":6,"../lib/settings.js":7,"../modules/index.js":25,"../utils/options.js":41}],6:[function(require,module,exports){
'use strict';var options=require('../utils/options.js'),settings=require('./settings.js'),css=require('../utils/css.js'),arrow='down',isClosedClass='';'closed'===settings.menu.contact&&(isClosedClass='dubplus-menu-section-closed',arrow='right');var contactSection='\n  <div id="dubplus-contact" class="dubplus-menu-section-header">\n      <span class="fa fa-angle-'+arrow+'"></span>\n      <p>Contact</p>\n    </div>\n    <ul class="dubplus-menu-section '+isClosedClass+'">\n      <li class="dubplus-menu-icon">\n        <span class="fa fa-bug"></span>\n        <a href="https://discord.gg/XUkG3Qy" class="dubplus-menu-label" target="_blank">Report bugs on Discord</a>\n      </li>\n      <li class="dubplus-menu-icon">\n        <span class="fa fa-reddit-alien"></span>\n        <a href="https://www.reddit.com/r/DubPlus/" class="dubplus-menu-label"  target="_blank">Reddit</a>\n      </li>\n      <li class="dubplus-menu-icon">\n        <span class="fa fa-facebook"></span>\n        <a href="https://facebook.com/DubPlusScript" class="dubplus-menu-label"  target="_blank">Facebook</a>\n      </li>\n      <li class="dubplus-menu-icon">\n        <span class="fa fa-twitter"></span>\n        <a href="https://twitter.com/DubPlusScript" class="dubplus-menu-label"  target="_blank">Twitter</a>\n      </li>\n    </ul>';module.exports={beginMenu:function beginMenu(){css.loadExternal('https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css');var a='<div class="dubplus-icon"><img src="'+settings.srcRoot+'/images/dubplus.svg" alt=""></div>';$('.header-right-navigation').append(a),$('body').on('click','.dubplus-icon',function(){$('.dubplus-menu').toggleClass('dubplus-menu-open')});return'\n      <section class="dubplus-menu">\n          <p class="dubplus-menu-header">Dub+ Options</p>'},finishMenu:function finishMenu(a,b){for(var c in a){var d=c.replace(' ','-').toLowerCase(),f=settings.menu[d],h='down',i='';'closed'===f&&(i='dubplus-menu-section-closed',h='right'),b+='\n        <div id="'+('dubplus-'+d)+'" class="dubplus-menu-section-header">\n          <span class="fa fa-angle-'+h+'"></span>\n          <p>'+c+'</p>\n        </div>\n        <ul class="dubplus-menu-section '+i+'">',b+=a[c],b+='</ul>'}b+=contactSection,b+='</section>',$('body').append(b),$('body').on('click','.dubplus-menu-section-header',function(){var k=$(this).next('.dubplus-menu-section'),l=$(this).find('span'),m=$(this).text().trim().replace(' ','-').toLowerCase();k.toggleClass('dubplus-menu-section-closed'),k.hasClass('dubplus-menu-section-closed')?(l.removeClass('fa-angle-down').addClass('fa-angle-right'),options.saveOption('menu',m,'closed')):(l.removeClass('fa-angle-right').addClass('fa-angle-down'),options.saveOption('menu',m,'open'))})},makeOptionMenu:function makeOptionMenu(a,b){var d=$.extend({},{id:'',desc:'',state:!1,extraIcon:null,cssClass:'',altIcon:null},b),f='',g=d.state?'dubplus-switch-on':'';d.extraIcon&&(f='<span class="fa fa-'+d.extraIcon+' extra-icon"></span>');var h='dubplus-switch',i='\n        <div class="dubplus-switch-bg">\n          <div class="dubplus-switcher"></div>\n        </div>';return d.altIcon&&(h='dubplus-menu-icon',i='<span class="fa fa-'+d.altIcon+'"></span>'),'\n      <li id="'+d.id+'" class="'+h+' '+g+' '+d.cssClass+' title="'+d.desc+'">\n        '+f+'\n        '+i+'\n        <span class="dubplus-menu-label">'+a+'</span>\n      </li>'},makeLinkMenu:function makeLinkMenu(a,b,c,d){var g=$.extend({},{id:'',desc:'',cssClass:''},d);return'\n      <li id="'+g.id+'" class="dubplus-menu-icon '+g.cssClass+' title="'+g.desc+'">\n        <span class="fa fa-'+b+'"></span>\n        <a href="'+c+'" class="dubplus-menu-label" target="_blank">'+a+'</a>\n      </li>'}};

},{"../utils/css.js":36,"../utils/options.js":41,"./settings.js":7}],7:[function(require,module,exports){
(function (CURRENT_BRANCH,CURRENT_REPO){
"use strict";var defaults={our_version:"0.1.0",options:{},menu:{general:"open","user-interface":"open",settings:"open",customize:"open",contact:"open"},custom:{}},savedSettings={},_storageRaw=localStorage.getItem("dubplusUserSettings");_storageRaw&&(savedSettings=JSON.parse(_storageRaw));var exportSettings=$.extend({},defaults,savedSettings);exportSettings.srcRoot="https://rawgit.com/"+CURRENT_REPO+"/DubPlus/"+CURRENT_BRANCH,module.exports=exportSettings;

}).call(this,'master','DubPlus')
},{}],8:[function(require,module,exports){
'use strict';var modal=require('../utils/modal.js'),options=require('../utils/options.js'),settings=require('../lib/settings.js'),afk_module={};afk_module.id='dubplus-afk',afk_module.moduleName='AFK Auto-respond',afk_module.description='Toggle Away from Keyboard and customize AFK message.',afk_module.category='General';var afk_chat_respond=function(a){var b=a.message,c=Dubtrack.session.get('username');if(-1<b.indexOf('@'+c)&&Dubtrack.session.id!==a.user.userInfo.userid){settings.custom.customAfkMessage?$('#chat-txt-message').val('[AFK] '+settings.custom.customAfkMessage):$('#chat-txt-message').val('[AFK] I\'m not here right now.'),Dubtrack.room.chat.sendMessage(),this.optionState=!1;var d=this;setTimeout(function(){d.optionState=!0},1.8e5)}};afk_module.turnOn=function(){Dubtrack.Events.bind('realtime:chat-message',afk_chat_respond)},afk_module.turnOff=function(){Dubtrack.Events.unbind('realtime:chat-message',afk_chat_respond)};var saveAFKmessage=function(){var a=$('.dp-modal textarea').val();''!==a&&options.saveOption('custom','customAfkMessage',a)};afk_module.extra=function(){modal.create({title:'Custom AFK Message',content:'Enter a custom Away From Keyboard [AFK] message here',value:settings.custom.customAfkMessage||'',placeholder:'Be right back!',maxlength:'255',confirmCallback:saveAFKmessage})},module.exports=afk_module;

},{"../lib/settings.js":7,"../utils/modal.js":38,"../utils/options.js":41}],9:[function(require,module,exports){
'use strict';var previewList=require('../emojiUtils/previewList.js'),settings=require('../lib/settings.js'),prepEmjoji=require('../emojiUtils/prepEmoji.js'),myModule={};myModule.id='dubplus-autocomplete',myModule.moduleName='Autocomplete Emoji',myModule.description='Toggle autocompleting emojis and emotes.  Shows a preview box in the chat',myModule.category='General';var KEYS={up:38,down:40,left:37,right:39,enter:13,esc:27,tab:9,shiftKey:16,backspace:8,del:46,space:32,ctrl:17},keyCharMin=3,inputRegex=/(:|@)([&!()\+\-_a-z0-9]+)($|\s)/ig,previewSearchStr='',strStart=0,strEnd=0,emojiUtils={createPreviewObj:function createPreviewObj(a,b,c){return{src:prepEmjoji[a].template(b),text:':'+c+':',alt:c,cn:a}},addToPreviewList:function addToPreviewList(a){var b=this,c=[],d;a.forEach(function(f){d=f.toLowerCase(),'undefined'!=typeof prepEmjoji.twitch.emotes[d]&&c.push(b.createPreviewObj('twitch',prepEmjoji.twitch.emotes[d],f)),'undefined'!=typeof prepEmjoji.bttv.emotes[d]&&c.push(b.createPreviewObj('bttv',prepEmjoji.bttv.emotes[d],f)),'undefined'!=typeof prepEmjoji.tasty.emotes[d]&&c.push(b.createPreviewObj('tasty',d,f)),0<=emojify.emojiNames.indexOf(d)&&c.push(b.createPreviewObj('emoji',f,f))}),previewList.display(c)},filterEmoji:function filterEmoji(a){var b=a.replace(/([+()])/,'\\$1'),c=new RegExp('^'+b,'i'),d=emojify.emojiNames;return settings.options['dubplus-emotes']&&(d=prepEmjoji.emojiEmotes),d.filter(function(f){return c.test(f)})}},shouldClearPreview=function(a,b,c,d){var f=c.charAt(c.length-1);return(b.length<d||':'===f||' '===f||''===c)&&(b='',a.empty().removeClass('ac-show')),b},handleMatch=function(a,b,c,d){var f=a.length-1,g=a[f].trim(),h=g.charAt(0);g=g.substring(1);var i=b.lastIndexOf(g),j=i+g.length;return c>=i&&c<=j&&g&&g.length>=d&&':'===h&&emojiUtils.addToPreviewList(emojiUtils.filterEmoji(g)),{strStart:i,strEnd:j,currentMatch:g}},chatInputKeyupFunc=function(a){var b=$('#autocomplete-preview'),c=0<b.find('li').length;if(a.keyCode!==KEYS.enter||c){if(a.keyCode===KEYS.up&&c)return void previewList.doNavigate(-1);if(a.keyCode===KEYS.down&&c)return void previewList.doNavigate(1);var d=this.value,f=$(this).get(0).selectionStart,g=d.match(inputRegex);if(g&&0<g.length){var h=handleMatch(g,d,f,keyCharMin);previewSearchStr=h.currentMatch,strStart=h.strStart,strEnd=h.strEnd,previewList.setData(h)}return(previewSearchStr=shouldClearPreview(b,previewSearchStr,d,keyCharMin),(a.keyCode===KEYS.enter||a.keyCode===KEYS.tab)&&c)?(a.preventDefault(),previewList.updateChatInput(strStart,strEnd),!1):void 0}},chatInputKeydownFunc=function(a){if(_.includes([KEYS.tab,KEYS.enter,KEYS.up,KEYS.down],a.keyCode)&&0===$('.ac-show').length)return Dubtrack.room.chat.ncKeyDown({which:a.keyCode})};myModule.turnOn=function(){previewList.init(),Dubtrack.room.chat.delegateEvents(_(Dubtrack.room.chat.events).omit('keydown #chat-txt-message')),$(document.body).on('keydown','#chat-txt-message',chatInputKeydownFunc),$(document.body).on('keyup','#chat-txt-message',chatInputKeyupFunc)},myModule.turnOff=function(){previewList.stop(),$(document.body).off('keydown','#chat-txt-message',chatInputKeydownFunc),$(document.body).off('keyup','#chat-txt-message',chatInputKeyupFunc)},module.exports=myModule;

},{"../emojiUtils/prepEmoji.js":2,"../emojiUtils/previewList.js":3,"../lib/settings.js":7}],10:[function(require,module,exports){
"use strict";var autovote={id:"dubplus-autovote",moduleName:"Autovote",description:"Toggles auto upvoting for every song",category:"General"},advance_vote=function(){$(".dubup").click()},voteCheck=function(a){2>a.startTime&&advance_vote()};autovote.turnOff=function(){Dubtrack.Events.unbind("realtime:room_playlist-update",voteCheck)},autovote.turnOn=function(){var a=Dubtrack.room.player.activeSong.get("song"),b=Dubtrack.helpers.cookie.get("dub-"+Dubtrack.room.model.get("_id")),c=Dubtrack.helpers.cookie.get("dub-song");Dubtrack.room&&a&&a.songid===c||(b=!1),$(".dubup, .dubdown").hasClass("voted")||b||advance_vote(),Dubtrack.Events.bind("realtime:room_playlist-update",voteCheck)},module.exports=autovote;

},{}],11:[function(require,module,exports){
"use strict";var _notify=require("../utils/notify.js"),settings=require("../lib/settings.js"),myModule={};myModule.id="mention_notifications",myModule.moduleName="Notification on Mentions",myModule.description="Enable desktop notifications when a user mentions you in chat",myModule.category="General",myModule.notifyOnMention=function(a){var b=a.message,c=Dubtrack.session.get("username").toLowerCase(),d=["@"+c];settings.options.custom_mentions&&settings.custom.custom_mentions&&(d=d.concat(settings.custom.custom_mentions.toLowerCase().split(",")));var f=d.some(function(g){return 0<=b.toLowerCase().indexOf(g.trim(" "))});f&&!this.isActiveTab&&Dubtrack.session.id!==a.user.userInfo.userid&&(0,_notify.showNotification)({title:"Message from "+a.user.username,content:b})},myModule.turnOn=function(){var a=this;(0,_notify.notifyCheckPermission)(function(b){!0===b?Dubtrack.Events.bind("realtime:chat-message",a.notifyOnMention):a.toggleAndSave(a.id,!1)})},myModule.turnOff=function(){Dubtrack.Events.unbind("realtime:chat-message",this.notifyOnMention)},module.exports=myModule;

},{"../lib/settings.js":7,"../utils/notify.js":40}],12:[function(require,module,exports){
"use strict";var css=require("../utils/css.js"),myModule={};myModule.id="dubplus-comm-theme",myModule.moduleName="Community Theme",myModule.description="Toggle Community CSS theme.",myModule.category="Customize",myModule.turnOn=function(){var a=Dubtrack.room.model.get("roomUrl");$.ajax({type:"GET",url:"https://api.dubtrack.fm/room/"+a}).done(function(b){var c=b.data.description,d=new RegExp(/(@dub[x|plus]=)((https?:\/\/)?[\w-]+(\.[\w-]+)+\.?(:\d+)?(\/\S*)?)/,"i"),f=null;c.replace(d,function(g,h,i){console.log("loading community css theme:",i),f=i});f&&css.loadExternal(f,"dubplus-comm-theme")})},myModule.turnOff=function(){$(".dubplus-comm-theme").remove()},module.exports=myModule;

},{"../utils/css.js":36}],13:[function(require,module,exports){
'use strict';var settings=require('../lib/settings.js'),modal=require('../utils/modal.js'),options=require('../utils/options.js'),myModule={};myModule.id='dubplus-custom-bg',myModule.moduleName='Custom Background',myModule.description='Add your own custom background.',myModule.category='Customize',myModule.extraIcon='pencil';var makeBGdiv=function(a){return'<div class="dubplus-custom-bg" style="background-image: url('+a+');"></div>'},saveCustomBG=function(){var a=$('.dp-modal textarea').val();return''!==a&&a?void($('.dubplus-custom-bg').length?$('.dubplus-custom-bg').css('background-image','url('+a+')'):$('body').append(makeBGdiv(a)),options.saveOption('custom','bg',a)):($('.dubplus-custom-bg').remove(),void options.saveOption('custom','bg',''))};myModule.extra=function(){modal.create({title:'Custom Background Image',content:'Enter the full URL of an image. We recommend using a .jpg file. Leave blank to remove the current background image',value:settings.custom.bg||'',placeholder:'https://example.com/big-image.jpg',maxlength:'500',confirmCallback:saveCustomBG})},myModule.turnOn=function(){settings.custom.bg&&''!==settings.custom.bg?$('body').append(makeBGdiv(settings.custom.bg)):this.extra()},myModule.turnOff=function(){$('.dubplus-custom-bg').remove()},module.exports=myModule;

},{"../lib/settings.js":7,"../utils/modal.js":38,"../utils/options.js":41}],14:[function(require,module,exports){
'use strict';var css=require('../utils/css.js'),settings=require('../lib/settings.js'),modal=require('../utils/modal.js'),options=require('../utils/options.js'),myModule={};myModule.id='dubplus-custom-css',myModule.moduleName='Custom CSS',myModule.description='Add your own custom CSS.',myModule.category='Customize',myModule.extraIcon='pencil';var css_import=function(){$('.dubplus-custom-css').remove();var a=$('.dp-modal textarea').val();options.saveOption('custom','css',a),a&&''!==a&&css.loadExternal(a,'dubplus-custom-css')};myModule.extra=function(){modal.create({title:'Custom CSS',content:'Enter a url location for your custom css',value:settings.custom.css||'',placeholder:'https://example.com/example.css',maxlength:'500',confirmCallback:css_import})},myModule.turnOn=function(){settings.custom.css&&''!==settings.custom.css?css.loadExternal(settings.custom.css,'dubplus-custom-css'):this.extra()},myModule.turnOff=function(){$('.dubplus-custom-css').remove()},module.exports=myModule;

},{"../lib/settings.js":7,"../utils/css.js":36,"../utils/modal.js":38,"../utils/options.js":41}],15:[function(require,module,exports){
'use strict';var settings=require('../lib/settings.js'),modal=require('../utils/modal.js'),options=require('../utils/options.js'),myModule={};myModule.id='custom_mentions',myModule.moduleName='Custom Mentions',myModule.description='Toggle using custom mentions to trigger sounds in chat',myModule.category='General',myModule.extraIcon='pencil';var saveCustomMentions=function(){var a=$('.dp-modal textarea').val();''!==a&&options.saveOption('custom','custom_mentions',a)};myModule.customMentionCheck=function(a){var b=a.message.toLowerCase();if(settings.custom.custom_mentions){var c=settings.custom.custom_mentions.toLowerCase().split(','),d=c.some(function(f){return 0<=b.indexOf(f.trim(' '))});Dubtrack.session.id!==a.user.userInfo.userid&&d&&Dubtrack.room.chat.mentionChatSound.play()}},myModule.turnOn=function(){Dubtrack.Events.bind('realtime:chat-message',this.customMentionCheck)},myModule.extra=function(){modal.create({title:'Custom AFK Message',content:'Custom Mention Triggers (separate by comma)',value:settings.custom.custom_mentions||'',placeholder:'separate, custom triggers, by, comma, :heart:',maxlength:'255',confirmCallback:saveCustomMentions})},myModule.turnOff=function(){Dubtrack.Events.unbind('realtime:chat-message',this.customMentionCheck)},module.exports=myModule;

},{"../lib/settings.js":7,"../utils/modal.js":38,"../utils/options.js":41}],16:[function(require,module,exports){
"use strict";var _modcheck=require("../utils/modcheck.js"),_modcheck2=_interopRequireDefault(_modcheck);function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}var myModule={};myModule.id="dubplus-downdubs",myModule.moduleName="Downdubs in Chat (mods only)",myModule.description="Toggle showing downdubs in the chat box (mods only)",myModule.category="General",myModule.downdubWatcher=function(a){var b=Dubtrack.session.get("username"),c=Dubtrack.room.users.collection.findWhere({userid:Dubtrack.room.player.activeSong.attributes.song.userid}).attributes._user.username;if(b===c&&"downdub"===a.dubtype){var d="\n      <li class=\"dubplus-chat-system dubplus-chat-system-downdub\">\n        <div class=\"chatDelete\" onclick=\"dubplus.deleteChatMessageClientSide(this)\">\n          <span class=\"icon-close\"></span>\n        </div>\n        <div class=\"text\">\n          @"+a.user.username+" has downdubbed your song "+Dubtrack.room.player.activeSong.attributes.songInfo.name+"\n        </div>\n      </li>";$("ul.chat-main").append(d)}},myModule.turnOn=function(){(0,_modcheck2.default)(Dubtrack.session.id)&&(Dubtrack.Events.bind("realtime:room_playlist-dub",this.downdubWatcher),"function"!=typeof window.dubplus.deleteChatMessageClientSide&&(window.dubplus.deleteChatMessageClientSide=function(a){$(a).parent("li")[0].remove()}))},myModule.turnOff=function(){Dubtrack.Events.unbind("realtime:room_playlist-dub",this.downdubWatcher)},module.exports=myModule;

},{"../utils/modcheck.js":39}],17:[function(require,module,exports){
"use strict";var dubplus_emoji=require("../emojiUtils/prepEmoji.js"),emote_module={};emote_module.id="dubplus-emotes",emote_module.moduleName="Emotes",emote_module.description="Adds twitch and bttv emotes in chat.",emote_module.category="General";function makeImage(a,b,c,d,e){return"<img class=\"emoji "+a+"-emote\" "+(d?"width=\""+d+"\" ":"")+(e?"height=\""+e+"\" ":"")+"title=\""+c+"\" alt=\""+c+"\" src=\""+b+"\" />"}var replaceTextWithEmote=function(){var a=dubplus_emoji.twitch.chatRegex;if(dubplus_emoji.twitchJSONSLoaded){var b=$(".chat-main .text").last();if(b.html()){dubplus_emoji.bttvJSONSLoaded&&(a=dubplus_emoji.bttv.chatRegex);var c=b.html().replace(a,function(d,e){var f,g,i=e.toLowerCase();return dubplus_emoji.twitch.emotes[i]?(f=dubplus_emoji.twitch.emotes[i],g=dubplus_emoji.twitch.template(f),makeImage("twitch",g,i)):dubplus_emoji.bttv.emotes[i]?(f=dubplus_emoji.bttv.emotes[i],g=dubplus_emoji.bttv.template(f),makeImage("bttv",g,i)):dubplus_emoji.tasty.emotes[i]?(g=dubplus_emoji.tasty.template(i),makeImage("tasty",g,i,dubplus_emoji.tasty.emotes[i].width,dubplus_emoji.tasty.emotes[i].height)):d});b.html(c)}}};emote_module.turnOn=function(){window.addEventListener("twitch:loaded",dubplus_emoji.loadBTTVEmotes.bind(dubplus_emoji)),dubplus_emoji.twitchJSONSLoaded?replaceTextWithEmote():dubplus_emoji.loadTwitchEmotes(),Dubtrack.Events.bind("realtime:chat-message",replaceTextWithEmote)},emote_module.turnOff=function(){Dubtrack.Events.unbind("realtime:chat-message",replaceTextWithEmote)},module.exports=emote_module;

},{"../emojiUtils/prepEmoji.js":2}],18:[function(require,module,exports){
'use strict';Object.defineProperty(exports,'__esModule',{value:!0}),exports.default=function(){$('.player_sharing').append('<span class="icon-history eta_tooltip_t"></span>'),$('.eta_tooltip_t').mouseover(eta).mouseout(hide_eta)};var eta=function(){var a=4,b=parseInt($('#player-controller div.left ul li.infoContainer.display-block div.currentTime span.min').text()),c=parseInt($('.queue-position').text()),d=c*a-a+b;0<=d?$(this).append('<div class="eta_tooltip" style="position: absolute;font: 1rem/1.5 proxima-nova,sans-serif;display: block;left: -33px;cursor: pointer;border-radius: 1.5rem;padding: 8px 16px;background: #fff;font-weight: 700;font-size: 13.6px;text-transform: uppercase;color: #000;opacity: .8;text-align: center;z-index: 9;">ETA: '+d+' minutes</div>'):$(this).append('<div class="eta_tooltip" style="position: absolute;font: 1rem/1.5 proxima-nova,sans-serif;display: block;left: -33px;cursor: pointer;border-radius: 1.5rem;padding: 8px 16px;background: #fff;font-weight: 700;font-size: 13.6px;text-transform: uppercase;color: #000;opacity: .8;text-align: center;z-index: 9;">You\'re not in the queue</div>')},hide_eta=function(){$(this).empty()};

},{}],19:[function(require,module,exports){
"use strict";var fs_module={};fs_module.id="dubplus-fullscreen",fs_module.moduleName="Fullscreen Video",fs_module.description="Toggle fullscreen video mode",fs_module.category="User Interface",fs_module.altIcon="arrows-alt",fs_module.go=function(){var a=document.querySelector(".playerElement iframe");a.requestFullscreen?a.requestFullscreen():a.msRequestFullscreen?a.msRequestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen&&a.webkitRequestFullscreen()},module.exports=fs_module;

},{}],20:[function(require,module,exports){
"use strict";var myModule={};myModule.id="dubplus-grabschat",myModule.moduleName="Grabs in Chat",myModule.description="Toggle showing grabs in the chat box",myModule.category="General",myModule.grabChatWatcher=function(a){var b=Dubtrack.session.get("username"),c=Dubtrack.room.users.collection.findWhere({userid:Dubtrack.room.player.activeSong.attributes.song.userid}).attributes._user.username;if(b===c&&!Dubtrack.room.model.get("displayUserGrab")){var d="\n      <li class=\"dubplus-chat-system dubplus-chat-system-grab\">\n        <div class=\"chatDelete\" onclick=\"dubplus.deleteChatMessageClientSide(this)\">\n          <span class=\"icon-close\"></span>\n        </div>\n        <div class=\"text\">\n          @"+a.user.username+" has grabbed your song "+Dubtrack.room.player.activeSong.attributes.songInfo.name+"\n        </div>\n      </li>";$("ul.chat-main").append(d)}},myModule.turnOn=function(){Dubtrack.Events.bind("realtime:room_playlist-queue-update-grabs",this.grabChatWatcher),"function"!=typeof window.dubplus.deleteChatMessageClientSide&&(window.dubplus.deleteChatMessageClientSide=function(a){$(a).parent("li")[0].remove()})},myModule.turnOff=function(){Dubtrack.Events.unbind("realtime:room_playlist-queue-update-grabs",this.grabChatWatcher)},module.exports=myModule;

},{}],21:[function(require,module,exports){
"use strict";var myModule={};myModule.id="dubplus-hide-avatars",myModule.moduleName="Hide Avatars",myModule.description="Toggle hiding user avatars in the chat box.",myModule.category="User Interface",myModule.turnOn=function(){$("body").addClass("dubplus-hide-avatars")},myModule.turnOff=function(){$("body").removeClass("dubplus-hide-avatars")},module.exports=myModule;

},{}],22:[function(require,module,exports){
"use strict";var myModule={};myModule.id="dubplus-hide-bg",myModule.moduleName="Hide Background",myModule.description="Toggle hiding background image.",myModule.category="User Interface",myModule.turnOn=function(){$("body").addClass("dubplus-hide-bg")},myModule.turnOff=function(){$("body").removeClass("dubplus-hide-bg")},module.exports=myModule;

},{}],23:[function(require,module,exports){
"use strict";var myModule={};myModule.id="dubplus-video-only",myModule.moduleName="Hide Chat",myModule.description="Toggles hiding the chat box",myModule.category="User Interface",myModule.turnOn=function(){$("body").addClass("dubplus-video-only")},myModule.turnOff=function(){$("body").removeClass("dubplus-video-only")},module.exports=myModule;

},{}],24:[function(require,module,exports){
"use strict";var myModule={};myModule.id="dubplus-chat-only",myModule.moduleName="Hide Video",myModule.description="Toggles hiding the video box",myModule.category="User Interface",myModule.turnOn=function(){$("body").addClass("dubplus-chat-only")},myModule.turnOff=function(){$("body").removeClass("dubplus-chat-only")},module.exports=myModule;

},{}],25:[function(require,module,exports){
'use strict';module.exports=[require('./autovote.js'),require('./afk.js'),require('./emotes.js'),require('./autocomplete.js'),require('./customMentions.js'),require('./chatNotifications.js'),require('./pmNotifications.js'),require('./showDubsOnHover.js'),require('./downDubInChat.js'),require('./upDubInChat.js'),require('./grabsInChat.js'),require('./snow.js'),require('./rain.js'),require('./fullscreen.js'),require('./splitchat.js'),require('./hideChat.js'),require('./hideVideo.js'),require('./hideAvatars.js'),require('./hideBackground.js'),require('./showTimestamps.js'),require('./spacebarMute.js'),require('./warnOnNavigation.js'),require('./communityTheme.js'),require('./customCSS.js'),require('./customBackground.js')];

},{"./afk.js":8,"./autocomplete.js":9,"./autovote.js":10,"./chatNotifications.js":11,"./communityTheme.js":12,"./customBackground.js":13,"./customCSS.js":14,"./customMentions.js":15,"./downDubInChat.js":16,"./emotes.js":17,"./fullscreen.js":19,"./grabsInChat.js":20,"./hideAvatars.js":21,"./hideBackground.js":22,"./hideChat.js":23,"./hideVideo.js":24,"./pmNotifications.js":26,"./rain.js":27,"./showDubsOnHover.js":28,"./showTimestamps.js":29,"./snow.js":31,"./spacebarMute.js":32,"./splitchat.js":33,"./upDubInChat.js":34,"./warnOnNavigation.js":35}],26:[function(require,module,exports){
"use strict";var _notify=require("../utils/notify.js"),myModule={};myModule.id="dubplus_pm_notifications",myModule.moduleName="Notification on PM",myModule.description="Enable desktop notifications when a user receives a private message",myModule.category="General",myModule.pmNotify=function(a){var b=Dubtrack.session.get("_id");b===a.userid||(0,_notify.showNotification)({title:"You have a new PM",ignoreActiveTab:!0,callback:function callback(){$(".user-messages").click(),setTimeout(function(){$(".message-item[data-messageid=\""+a.messageid+"\"]").click()},500)},wait:1e4})},myModule.turnOn=function(){var a=this;(0,_notify.notifyCheckPermission)(function(b){!0===b?Dubtrack.Events.bind("realtime:new-message",a.pmNotify):a.toggleAndSave(a.id,!1)})},myModule.turnOff=function(){Dubtrack.Events.unbind("realtime:new-message",this.pmNotify)},module.exports=myModule;

},{"../utils/notify.js":40}],27:[function(require,module,exports){
"use strict";var rain={};rain.id="dubplus-rain",rain.moduleName="Rain",rain.description="Make it rain!",rain.category="General",rain.particles=[],rain.drops=[],rain.numbase=5,rain.numb=2,rain.width,rain.height=0,rain.controls={rain:2,alpha:1,color:200,opacity:1,saturation:100,lightness:50,back:0,multi:!1,speed:1},rain.turnOn=function(){$("body").prepend("<canvas id=\"dubPlusRainCanvas\" style=\"position : fixed; top : 0px; left : 0px; z-index: 100; pointer-events:none;\"></canvas>"),this.bindCanvas()},rain.turnOff=function(){$("#dubPlusRainCanvas").remove(),this.unbindCanvas()},rain.bindCanvas=function(){this.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}();var b=document.getElementById("dubPlusRainCanvas");if(b){var c=b.getContext("2d");this.width,this.height=0,window.onresize=function(){this.width=b.width=window.innerWidth,this.height=b.height=window.innerHeight},window.onresize(),this.particles,this.drops=[],this.numbase=5,this.numb=2;var d=this;(function e(){d.requestAnimFrame(e),d.update(),d.rendu(c)})()}},rain.buildRainParticle=function(a,b,c){for(c||(c=this.numb);c--;)this.particles.push({speedX:0.25*Math.random(),speedY:9*Math.random()+1,X:a,Y:b,alpha:1,color:"hsla("+this.controls.color+","+this.controls.saturation+"%, "+this.controls.lightness+"%,"+this.controls.opacity+")"})},rain.explosion=function(a,b,c,d){for(d||(d=this.numbase);d--;)this.drops.push({speedX:4*Math.random()-2,speedY:-4*Math.random(),X:a,Y:b,radius:0.65+Math.floor(1.6*Math.random()),alpha:1,color:c})},rain.rendu=function(a){!0==this.controls.multi&&(this.controls.color=360*Math.random()),a.save(),a.clearRect(0,0,width,height);for(var f,b=this.particles,c=this.drops,d=2*Math.PI,e=0;f=b[e];e++)a.globalAlpha=f.alpha,a.fillStyle=f.color,a.fillRect(f.X,f.Y,f.speedY/4,f.speedY);for(var g,e=0;g=c[e];e++)a.globalAlpha=g.alpha,a.fillStyle=g.color,a.beginPath(),a.arc(g.X,g.Y,g.radius,0,d),a.fill();a.strokeStyle="white",a.lineWidth=2,a.restore()},rain.update=function(){for(var d,a=this.particles,b=this.drops,c=0;d=a[c];c++)d.X+=d.speedX,d.Y+=d.speedY+5,d.Y>height-15&&(a.splice(c--,1),this.explosion(d.X,d.Y,d.color));for(var e,c=0;e=b[c];c++)e.X+=e.speedX,e.Y+=e.speedY,e.radius-=0.075,0<e.alpha?e.alpha-=5e-3:e.alpha=0,0>e.radius&&b.splice(c--,1);for(var c=this.controls.rain;c--;)this.buildRainParticle(Math.floor(Math.random()*width),-15)},rain.unbindCanvas=function(){this.requestAnimFrame=function(){}},module.exports=rain;

},{}],28:[function(require,module,exports){
'use strict';var _modcheck=require('../utils/modcheck.js'),_modcheck2=_interopRequireDefault(_modcheck);function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}var modal=require('../utils/modal.js'),dubshover={};dubshover.id='dubplus-dubs-hover',dubshover.moduleName='Show Dub info on Hover',dubshover.description='Show Dub info on Hover.',dubshover.category='General',dubshover.resetGrabs=function(){window.dubplus.dubs.grabs=[]},dubshover.grabInfoWarning=function(){this.warned&&(this.warned=!0,modal.create({title:'Grab Vote Info',content:'Please note that this feature is currently still in development. We are waiting on the ability to pull grab vote information from Dubtrack on load. Until then the only grabs you will be able to see are those you are present in the room for.'}))},dubshover.showDubsOnHover=function(){var a=this;this.resetDubs(),Dubtrack.Events.bind('realtime:room_playlist-dub',this.dubWatcher.bind(this)),Dubtrack.Events.bind('realtime:room_playlist-queue-update-grabs',this.grabWatcher.bind(this)),Dubtrack.Events.bind('realtime:user-leave',this.dubUserLeaveWatcher.bind(this)),Dubtrack.Events.bind('realtime:room_playlist-update',this.resetDubs.bind(this)),Dubtrack.Events.bind('realtime:room_playlist-update',this.resetGrabs.bind(this));var b=$('.dubup').first().parent('li'),c=$('.dubdown').first().parent('li'),d=$('.add-to-playlist-button').first().parent('li');$(b).addClass('dubplus-updubs-hover'),$(c).addClass('dubplus-downdubs-hover'),$(d).addClass('dubplus-grabs-hover'),$(b).click(function(f){$('#dubplus-updubs-container').remove();var g=f.clientX,h=f.clientY;if(!g||!h||isNaN(g)||isNaN(h))return $('#dubplus-downdubs-container').remove();var j=document.elementFromPoint(g,h);($(j).hasClass('dubplus-updubs-hover')||0<$(j).parents('.dubplus-updubs-hover').length)&&setTimeout(function(){$(b).mouseenter()},250)}),$(c).click(function(f){$('#dubplus-downdubs-container').remove();var g=f.clientX,h=f.clientY;if(!g||!h||isNaN(g)||isNaN(h))return $('#dubplus-downdubs-container').remove();var j=document.elementFromPoint(g,h);($(j).hasClass('dubplus-downdubs-hover')||0<$(j).parents('.dubplus-downdubs-hover').length)&&setTimeout(function(){$(c).mouseenter()},250)}),$(d).click(function(f){$('#dubplus-grabs-container').remove();var g=f.clientX,h=f.clientY;if(!g||!h||isNaN(g)||isNaN(h))return $('#dubplus-grabs-container').remove();var j=document.elementFromPoint(g,h);($(j).hasClass('dubplus-grabs-hover')||0<$(j).parents('.dubplus-grabs-hover').length)&&setTimeout(function(){$(d).mouseenter()},250)}),$(b).mouseenter(function(f){var g=f.currentTarget;if(!(0<$('#dubplus-updubs-container').length)){var k,h=$(b).innerWidth()+$(c).innerWidth(),j=$('.dubup').hasClass('voted')?$('.dubup').css('background-color'):$('.dubup').find('.icon-arrow-up').css('color');0<window.dubplus.dubs.upDubs.length?(k='<ul id="dubinfo-preview" class="dubinfo-show dubplus-updubs-hover" style="border-color: '+j+'">',window.dubplus.dubs.upDubs.forEach(function(o){k+='<li class="preview-dubinfo-item users-previews dubplus-updubs-hover"><div class="dubinfo-image"><img src="https://api.dubtrack.fm/user/'+o.userid+'/image"></div><span class="dubinfo-text">@'+o.username+'</span></li>'}),k+='</ul>'):k='<div id="dubinfo-preview" class="dubinfo-show dubplus-updubs-hover dubplus-no-dubs" style="border-color: '+j+'">No updubs have been casted yet!</div>';var l=document.createElement('div');l.id='dubplus-updubs-container',l.className='dubinfo-show dubplus-updubs-hover',l.innerHTML=k,l.style.visibility='hidden',document.body.appendChild(l);var m=g.getBoundingClientRect(),n=document.body.getBoundingClientRect();l.style.visibility='',l.style.width=h+'px',l.style.top=m.top-150+'px',n.right-m.left>=h?l.style.left=m.left+'px':l.style.right=0,document.body.appendChild(l),$(g).addClass('dubplus-updubs-hover'),$(document.body).on('click','.preview-dubinfo-item',function(o){var p=$(o.currentTarget).find('.dubinfo-text')[0].innerHTML+' ';a.updateChatInputWithString(p)}),$('#dubinfo-preview').perfectScrollbar(),$('.dubplus-updubs-hover').mouseleave(function(o){var p=o.clientX,q=o.clientY;if(!p||!q||isNaN(p)||isNaN(q))return $('#dubplus-downdubs-container').remove();var r=document.elementFromPoint(p,q);$(r).hasClass('dubplus-updubs-hover')||$(r).hasClass('ps-scrollbar-y')||!(0>=$(r).parent('.dubplus-updubs-hover').length)||$('#dubplus-updubs-container').remove()})}}),$(c).mouseenter(function(f){var g=f.currentTarget;if(!(0<$('#dubplus-downdubs-container').length)){var k,h=$(b).innerWidth()+$(c).innerWidth(),j=$('.dubdown').hasClass('voted')?$('.dubdown').css('background-color'):$('.dubdown').find('.icon-arrow-down').css('color');(0,_modcheck2.default)(Dubtrack.session.id)?0<window.dubplus.dubs.downDubs.length?(k='<ul id="dubinfo-preview" class="dubinfo-show dubplus-downdubs-hover" style="border-color: '+j+'">',window.dubplus.dubs.downDubs.forEach(function(o){k+='<li class="preview-dubinfo-item users-previews dubplus-downdubs-hover"><div class="dubinfo-image"><img src="https://api.dubtrack.fm/user/'+o.userid+'/image"></div><span class="dubinfo-text">@'+o.username+'</span></li>'}),k+='</ul>'):k='<div id="dubinfo-preview" class="dubinfo-show dubplus-downdubs-hover dubplus-no-dubs" style="border-color: '+j+'">No downdubs have been casted yet!</div>':k='<div id="dubinfo-preview" class="dubinfo-show dubplus-downdubs-hover dubplus-downdubs-unauthorized" style="border-color: '+j+'">You must be at least a mod to view downdubs!</div>';var l=document.createElement('div');l.id='dubplus-downdubs-container',l.className='dubinfo-show dubplus-downdubs-hover',l.innerHTML=k,l.style.visibility='hidden',document.body.appendChild(l);var m=g.getBoundingClientRect(),n=document.body.getBoundingClientRect();l.style.visibility='',l.style.width=h+'px',l.style.top=m.top-150+'px',n.right-m.left>=h?l.style.left=m.left+'px':l.style.right=0,document.body.appendChild(l),$(g).addClass('dubplus-downdubs-hover'),$(document.body).on('click','.preview-dubinfo-item',function(o){var p=$(o.currentTarget).find('.dubinfo-text')[0].innerHTML+' ';this.updateChatInputWithString(p)}),$('#dubinfo-preview').perfectScrollbar(),$('.dubplus-downdubs-hover').mouseleave(function(o){var p=o.clientX,q=o.clientY;if(!p||!q||isNaN(p)||isNaN(q))return $('#dubplus-downdubs-container').remove();var r=document.elementFromPoint(p,q);$(r).hasClass('dubplus-downdubs-hover')||$(r).hasClass('ps-scrollbar-y')||!(0>=$(r).parent('.dubplus-downdubs-hover').length)||$('#dubplus-downdubs-container').remove()})}}),$(d).mouseenter(function(f){var g=f.currentTarget;if(!(0<$('#dubplus-grabs-container').length)){var k,h=$(b).innerWidth()+$(d).innerWidth(),j=$('.add-to-playlist-button').hasClass('grabbed')?$('.add-to-playlist-button').css('background-color'):$('.add-to-playlist-button').find('.icon-heart').css('color');0<window.dubplus.dubs.grabs.length?(k='<ul id="dubinfo-preview" class="dubinfo-show dubplus-grabs-hover" style="border-color: '+j+'">',window.dubplus.dubs.grabs.forEach(function(o){k+='<li class="preview-dubinfo-item users-previews dubplus-grabs-hover"><div class="dubinfo-image"><img src="https://api.dubtrack.fm/user/'+o.userid+'/image"></div><span class="dubinfo-text">@'+o.username+'</span></li>'}),k+='</ul>'):k='<div id="dubinfo-preview" class="dubinfo-show dubplus-grabs-hover dubplus-no-grabs" style="border-color: '+j+'">This song hasn\'t been grabbed yet!</div>';var l=document.createElement('div');l.id='dubplus-grabs-container',l.className='dubinfo-show dubplus-grabs-hover',l.innerHTML=k,l.style.visibility='hidden',document.body.appendChild(l);var m=g.getBoundingClientRect(),n=document.body.getBoundingClientRect();l.style.visibility='',l.style.width=h+'px',l.style.top=m.top-150+'px',n.right-m.left>=h?l.style.left=m.left+'px':l.style.right=0,document.body.appendChild(l),$(g).addClass('dubplus-grabs-hover'),$(document.body).on('click','.preview-dubinfo-item',function(o){var p=$(o.currentTarget).find('.dubinfo-text')[0].innerHTML+' ';this.updateChatInputWithString(p)}),$('#dubinfo-preview').perfectScrollbar(),$('.dubplus-grabs-hover').mouseleave(function(o){var p=o.clientX,q=o.clientY;if(!p||!q||isNaN(p)||isNaN(q))return $('#dubplus-grabs-container').remove();var r=document.elementFromPoint(p,q);$(r).hasClass('dubplus-grabs-hover')||$(r).hasClass('ps-scrollbar-y')||!(0>=$(r).parent('.dubplus-grabs-hover').length)||$('#dubplus-grabs-container').remove()})}})},dubshover.stopDubsOnHover=function(){Dubtrack.Events.unbind('realtime:room_playlist-dub',this.dubWatcher),Dubtrack.Events.unbind('realtime:room_playlist-queue-update-grabs',this.grabWatcher),Dubtrack.Events.unbind('realtime:user-leave',this.dubUserLeaveWatcher),Dubtrack.Events.unbind('realtime:room_playlist-update',this.resetDubs),Dubtrack.Events.unbind('realtime:room_playlist-update',this.resetGrabs)},dubshover.dubUserLeaveWatcher=function(a){0<$.grep(window.dubplus.dubs.upDubs,function(b){return b.userid===a.user._id}).length&&$.each(window.dubplus.dubs.upDubs,function(b){if(window.dubplus.dubs.upDubs[b].userid===a.user._id)return window.dubplus.dubs.upDubs.splice(b,1),!1}),0<$.grep(window.dubplus.dubs.downDubs,function(b){return b.userid===a.user._id}).length&&$.each(window.dubplus.dubs.downDubs,function(b){if(window.dubplus.dubs.downDubs[b].userid===a.user._id)return window.dubplus.dubs.downDubs.splice(b,1),!1}),0<$.grep(window.dubplus.dubs.grabs,function(b){return b.userid===a.user._id}).length&&$.each(window.dubplus.dubs.grabs,function(b){if(window.dubplus.dubs.grabs[b].userid===a.user._id)return window.dubplus.dubs.grabs.splice(b,1),!1})},dubshover.grabWatcher=function(a){0>=$.grep(window.dubplus.dubs.grabs,function(b){return b.userid===a.user._id}).length&&window.dubplus.dubs.grabs.push({userid:a.user._id,username:a.user.username})},dubshover.updateChatInputWithString=function(a){$('#chat-txt-message').val(a).focus()},dubshover.deleteChatMessageClientSide=function(a){$(a).parent('li')[0].remove()},dubshover.dubWatcher=function(a){'updub'===a.dubtype?(0>=$.grep(window.dubplus.dubs.upDubs,function(c){return c.userid===a.user._id}).length&&window.dubplus.dubs.upDubs.push({userid:a.user._id,username:a.user.username}),0<$.grep(window.dubplus.dubs.downDubs,function(c){return c.userid===a.user._id}).length&&$.each(window.dubplus.dubs.downDubs,function(c){if(window.dubplus.dubs.downDubs[c].userid===a.user._id)return window.dubplus.dubs.downDubs.splice(c,1),!1})):'downdub'===a.dubtype&&(0>=$.grep(window.dubplus.dubs.downDubs,function(c){return c.userid===a.user._id}).length&&(0,_modcheck2.default)(Dubtrack.session.id)&&window.dubplus.dubs.downDubs.push({userid:a.user._id,username:a.user.username}),0<$.grep(window.dubplus.dubs.upDubs,function(c){return c.userid===a.user._id}).length&&$.each(window.dubplus.dubs.upDubs,function(c){if(window.dubplus.dubs.upDubs[c].userid===a.user._id)return window.dubplus.dubs.upDubs.splice(c,1),!1}));var b=new Date-new Date(Dubtrack.room.player.activeSong.attributes.song.played);1e3>b||(window.dubplus.dubs.upDubs.length===Dubtrack.room.player.activeSong.attributes.song.updubs?(0,_modcheck2.default)(Dubtrack.session.id)&&window.dubplus.dubs.downDubs.length!==Dubtrack.room.player.activeSong.attributes.song.downdubs&&this.resetDubs():this.resetDubs())},dubshover.resetDubs=function(){window.dubplus.dubs.upDubs=[],window.dubplus.dubs.downDubs=[];var a='https://api.dubtrack.fm/room/'+Dubtrack.room.model.id+'/playlist/active/dubs';$.getJSON(a,function(b){b.data.upDubs.forEach(function(c){if(!(0<$.grep(window.dubplus.dubs.upDubs,function(f){return f.userid===c.userid}).length)){var d;Dubtrack.room.users.collection.findWhere({userid:c.userid})&&Dubtrack.room.users.collection.findWhere({userid:c.userid}).attributes?d=Dubtrack.room.users.collection.findWhere({userid:c.userid}).attributes._user.username:$.getJSON('https://api.dubtrack.fm/user/'+c.userid,function(f){f&&f.userinfo&&(d=f.userinfo.username)}),d&&window.dubplus.dubs.upDubs.push({userid:c.userid,username:d})}}),(0,_modcheck2.default)(Dubtrack.session.id)&&b.data.downDubs.forEach(function(c){if(!(0<$.grep(window.dubplus.dubs.downDubs,function(f){return f.userid===c.userid}).length)){var d;Dubtrack.room.users.collection.findWhere({userid:c.userid})&&Dubtrack.room.users.collection.findWhere({userid:c.userid}).attributes?d=Dubtrack.room.users.collection.findWhere({userid:c.userid}).attributes._user.username:$.getJSON('https://api.dubtrack.fm/user/'+c.userid,function(f){d=f.userinfo.username}),window.dubplus.dubs.downDubs.push({userid:c.userid,username:Dubtrack.room.users.collection.findWhere({userid:c.userid}).attributes._user.username})}})})},dubshover.init=function(){window.dubplus.dubs={upDubs:[],downDubs:[],grabs:[]}},dubshover.turnOn=function(){this.grabInfoWarning(),this.showDubsOnHover()},dubshover.turnOff=function(){this.stopDubsOnHover()},module.exports=dubshover;

},{"../utils/modal.js":38,"../utils/modcheck.js":39}],29:[function(require,module,exports){
"use strict";var myModule={};myModule.id="dubplus-show-timestamp",myModule.moduleName="Show Timestamps",myModule.description="Toggle always showing chat message timestamps.",myModule.category="User Interface",myModule.turnOn=function(){$("body").addClass("dubplus-show-timestamp")},myModule.turnOff=function(){$("body").removeClass("dubplus-show-timestamp")},module.exports=myModule;

},{}],30:[function(require,module,exports){
'use strict';Object.defineProperty(exports,'__esModule',{value:!0}),exports.default=function(){$('.player_sharing').append('<span class="icon-mute snooze_btn"></span>'),$('body').on('mouseover','.snooze_btn',snooze_tooltip),$('body').on('mouseout','.snooze_btn',hide_snooze_tooltip),$('body').on('click','.snooze_btn',snooze)};var snooze_tooltip=function(){$(this).append('<div class="snooze_tooltip" style="position: absolute;font: 1rem/1.5 proxima-nova,sans-serif;display: block;left: -33px;cursor: pointer;border-radius: 1.5rem;padding: 8px 16px;background: #fff;font-weight: 700;font-size: 13.6px;text-transform: uppercase;color: #000;opacity: .8;text-align: center;z-index: 9;">Mute current song</div>')},hide_snooze_tooltip=function(){$('.snooze_tooltip').remove()},eventUtils={currentVol:50,snoozed:!1},eventSongAdvance=function(a){if(2>a.startTime)return eventUtils.snoozed&&(Dubtrack.room.player.setVolume(eventUtils.currentVol),eventUtils.snoozed=!1),!0},snooze=function(){!eventUtils.snoozed&&2<Dubtrack.room.player.player_volume_level?(eventUtils.currentVol=Dubtrack.room.player.player_volume_level,Dubtrack.room.player.setVolume(0),eventUtils.snoozed=!0,Dubtrack.Events.bind('realtime:room_playlist-update',eventSongAdvance)):eventUtils.snoozed&&(Dubtrack.room.player.setVolume(eventUtils.currentVol),eventUtils.snoozed=!1)};

},{}],31:[function(require,module,exports){
"use strict";module.exports={id:"dubplus-snow",moduleName:"Snow",description:"Make it snow!",category:"General",doSnow:function doSnow(){$(document).snowfall({round:!0,shadow:!0,flakeCount:50,minSize:1,maxSize:5,minSpeed:5,maxSpeed:5})},turnOn:function turnOn(){var a=this;$.snowfall?this.doSnow():$.getScript("https://rawgit.com/loktar00/JQuery-Snowfall/master/src/snowfall.jquery.js").done(function(){a.doSnow()}).fail(function(b,c,d){console.error("Could not load snowfall jquery plugin",d)})},turnOff:function turnOff(){$(document).snowfall("clear")}};

},{}],32:[function(require,module,exports){
"use strict";var myModule={};myModule.id="dubplus-spacebar-mute",myModule.moduleName="Spacebar Mute",myModule.description="Turn on/off the ability to mute current song with the spacebar.",myModule.category="Settings",myModule.turnOn=function(){$(document).bind("keypress.key32",function(a){var b=a.target.tagName.toLowerCase();32===a.which&&"input"!==b&&"textarea"!==b&&$("#main_player .player_sharing .player-controller-container .mute").click()})},myModule.turnOff=function(){$(document).unbind("keypress.key32")},module.exports=myModule;

},{}],33:[function(require,module,exports){
"use strict";var myModule={};myModule.id="dubplus-split-chat",myModule.moduleName="Split Chat",myModule.description="Toggle Split Chat UI enhancement",myModule.category="User Interface",myModule.turnOn=function(){$("body").addClass("dubplus-split-chat")},myModule.go=function(){$("body").removeClass("dubplus-split-chat")},module.exports=myModule;

},{}],34:[function(require,module,exports){
"use strict";var myModule={};myModule.id="dubplus-updubs",myModule.moduleName="Updubs in Chat",myModule.description="Toggle showing updubs in the chat box",myModule.category="General",myModule.updubWatcher=function(a){var b=Dubtrack.session.get("username"),c=Dubtrack.room.users.collection.findWhere({userid:Dubtrack.room.player.activeSong.attributes.song.userid}).attributes._user.username;if(b===c&&"updub"===a.dubtype){var d="\n      <li class=\"dubplus-chat-system dubplus-chat-system-updub\">\n        <div class=\"chatDelete\" onclick=\"dubplus.deleteChatMessageClientSide(this)\">\n          <span class=\"icon-close\"></span>\n        </div>\n        <div class=\"text\">\n          @"+a.user.username+" has updubbed your song "+Dubtrack.room.player.activeSong.attributes.songInfo.name+"\n        </div>\n      </li>";$("ul.chat-main").append(d)}},myModule.turnOn=function(){Dubtrack.Events.bind("realtime:room_playlist-dub",this.updubWatcher),"function"!=typeof window.dubplus.deleteChatMessageClientSide&&(window.dubplus.deleteChatMessageClientSide=function(a){$(a).parent("li")[0].remove()})},myModule.turnOff=function(){Dubtrack.Events.unbind("realtime:room_playlist-dub",this.updubWatcher)},module.exports=myModule;

},{}],35:[function(require,module,exports){
"use strict";var myModule={id:"warn_redirect",moduleName:"Warn On Navigation",description:"Warns you when accidentally clicking on a link that takes you out of dubtrack.",category:"Settings"};function unloader(a){var b="";return a.returnValue=b,b}myModule.turnOn=function(){window.addEventListener("beforeunload",unloader)},myModule.turnOff=function(){window.removeEventListener("beforeunload",unloader)},module.exports=myModule;

},{}],36:[function(require,module,exports){
(function (TIME_STAMP){
'use strict';var settings=require('../lib/settings.js'),load=function(a,b){if(a){var c=settings.srcRoot+a;$('head').append('<link '+('class="'+b+'"'||'')+' rel="stylesheet" type="text/css" href="'+c+'?'+TIME_STAMP+'">')}},loadExternal=function(a,b){if(a){$('head').append('<link '+('class="'+b+'"'||'')+' rel="stylesheet" type="text/css" href="'+a+'">')}};module.exports={load:load,loadExternal:loadExternal};

}).call(this,'1488045122317')
},{"../lib/settings.js":7}],37:[function(require,module,exports){
'use strict';var GetJSON=function(a,b,c){function d(g,h){var i=new XMLHttpRequest;if(i.open('GET',g),c)for(var j in c)c.hasOwnProperty(j)&&i.setRequestHeader(j,c[j]);i.send(),i.onload=function(){var k=i.responseText;'function'==typeof h&&h(k),e&&window.dispatchEvent(e)}}var e=b?new Event(b):null;return{done:function done(g){new d(a,g)}}};module.exports=GetJSON;

},{}],38:[function(require,module,exports){
'use strict';function makeButtons(a){var b='';return a?(b+='<button id="dp-modal-cancel">cancel</button>',b+='<button id="dp-modal-confirm">okay</button>'):b+='<button id="dp-modal-cancel">close</button>',b}var create=function(a){var c=$.extend({},{title:'Dub+',content:'',value:'',placeholder:null,maxlength:999,confirmCallback:null},a),d='';c.placeholder&&(d='<textarea placeholder="'+c.placeholder+'" maxlength="'+c.maxlength+'">',d+=c.value,d+='</textarea>');var f=['<div class="dp-modal">','<aside class="container">','<div class="title">','<h1>'+c.title+'</h1>','</div>','<div class="content">','<p>'+c.content+'</p>',d,'</div>','<div class="dp-modal-buttons">',makeButtons(c.confirmCallback),'</div>','</aside>','</div>'].join('');$('body').append(f),'function'==typeof c.confirmCallback&&$('#dp-modal-confirm').one('click',function(){c.confirmCallback(),$('.dp-modal').remove()}),$('#dp-modal-cancel').one('click',function(){$('.dp-modal').remove()}),$(document).one('keyup',function(g){13===g.keyCode&&'function'==typeof c.confirmCallback&&(c.confirmCallback(),$('.dp-modal').remove()),27===g.keyCode&&$('.dp-modal').remove()})},close=function(){$('.dp-modal').remove()};module.exports={create:create,close:close};

},{}],39:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=function(a){return Dubtrack.helpers.isDubtrackAdmin(a)||Dubtrack.room.users.getIfOwner(a)||Dubtrack.room.users.getIfManager(a)||Dubtrack.room.users.getIfMod(a)};

},{}],40:[function(require,module,exports){
'use strict';Object.defineProperty(exports,'__esModule',{value:!0}),exports.notifyCheckPermission=notifyCheckPermission,exports.showNotification=showNotification;var modal=require('../utils/modal.js'),isActiveTab=!0;window.onfocus=function(){isActiveTab=!0},window.onblur=function(){isActiveTab=!1};var onDenyDismiss=function(){modal.create({title:'Desktop Notifications',content:'You have dismissed or chosen to deny the request to allow desktop notifications. Reset this choice by clearing your cache for the site.'})};function notifyCheckPermission(a){var b='function'==typeof a?a:function(){};return'Notification'in window?'granted'===Notification.permission?b(!0):'denied'===Notification.permission?(onDenyDismiss(),b(!1)):void Notification.requestPermission().then(function(c){return'denied'===c||'default'===c?(onDenyDismiss(),void b(!1)):void b(!0)}):(modal.create({title:'Desktop Notifications',content:'Sorry this browser does not support desktop notifications.  Please use the latest version of Chrome or FireFox'}),b(!1))}function showNotification(a){var c=$.extend({},{title:'New Message',content:'',ignoreActiveTab:!1,callback:null,wait:5e3},a);if(!0!=isActiveTab||c.ignoreActiveTab){var d={body:c.content,icon:'https://res.cloudinary.com/hhberclba/image/upload/c_lpad,h_100,w_100/v1400351432/dubtrack_new_logo_fvpxa6.png'},e=new Notification(c.title,d);e.onclick=function(){window.focus(),'function'==typeof c.callback&&c.callback(),e.close()},setTimeout(e.close.bind(e),c.wait)}}

},{"../utils/modal.js":38}],41:[function(require,module,exports){
'use strict';var settings=require('../lib/settings.js'),saveOption=function(a,b,c){settings[a][b]=c,localStorage.setItem('dubplusUserSettings',JSON.stringify(settings))},getAllOptions=function(){var a=localStorage.dubplusUserSettings;return a?JSON.parse(a):settings},toggle=function(a,b){var c=$(a);c.length&&(!0===b?c.addClass('dubplus-switch-on'):c.removeClass('dubplus-switch-on'))},toggleAndSave=function(a,b){return toggle('#'+a,b),saveOption('options',a,b)};module.exports={toggle:toggle,toggleAndSave:toggleAndSave,getAllOptions:getAllOptions,saveOption:saveOption};

},{"../lib/settings.js":7}],42:[function(require,module,exports){
'use strict';Object.defineProperty(exports,'__esModule',{value:!0}),exports.default=preload;var settings=require('../lib/settings.js');function preload(){var a=['font-family: \'Trebuchet MS\', Helvetica, sans-serif','z-index: 2147483647','color: white','position: fixed','top: 69px','right: 13px','background: #222','padding: 10px','line-height: 1','-webkit-box-shadow: 0px 0px 5px 0px rgba(0,0,0,0.75)','-moz-box-shadow: 0px 0px 5px 0px rgba(0,0,0,0.75)','box-shadow: 0px 0px 5px 0px rgba(0,0,0,0.75)','border-radius: 5px','overflow: hidden','width: 230px'].join(';'),b=['float:left','width: 26px','margin-right:5px'].join(';'),c=['display: table-cell','width: 10000px','padding-top:5px'].join(';'),d='\n    <div class="dubplus-waiting" style="'+a+'">\n      <div style="'+b+'">\n        <img src="'+settings.srcRoot+'/images/dubplus.svg" alt="DubPlus icon">\n      </div>\n      <span style="'+c+'">\n        Waiting for Dubtrack...\n      </span>\n    </div>\n  ';$('body').prepend(d)}

},{"../lib/settings.js":7}],43:[function(require,module,exports){
'use strict';Object.defineProperty(exports,'__esModule',{value:!0});function deepCheck(a,b){for(var c=a.split('.'),d=c.length,e=b||window,f=0;f<d;f++){if('undefined'==typeof e[c[f]])return!1;e=e[c[f]]}return!0}function arrayDeepCheck(a,b){for(var c=a.length,d=b||window,e=0;e<c;e++)if(!deepCheck(a[e],d))return console.log(a[e],'is not found yet'),!1;return!0}function WaitFor(a,b){if('string'!=typeof a&&!Array.isArray(a))return void console.warn('WaitFor: invalid first argument');var d=function _cb(){},e=function _failCB(){},f=Array.isArray(a)?arrayDeepCheck:deepCheck,g=$.extend({},{interval:500,seconds:5},b),h=0,j=1e3*g.seconds/g.interval,k=function check(){h++;var n=f(a);return n?d():h<j?void window.setTimeout(k,g.interval):e()};return{then:function then(n){return'function'==typeof n&&(d=n),window.setTimeout(k,g.interval),this},fail:function fail(n){return'function'==typeof n&&(e=n),this}}}exports.default=WaitFor;

},{}]},{},[1]);
